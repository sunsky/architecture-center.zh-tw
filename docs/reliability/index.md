---
title: 設計可靠的 Azure 應用程式
description: 使 Azure 應用程式可靠且高度可用的簡介
author: MikeWasson
ms.date: 04/10/2019
ms.topic: article
ms.service: architecture-center
ms.subservice: cloud-design-principles
ms.custom: ''
ms.openlocfilehash: 16c1daeed9b1d79f33051eb69571f1574bf9be4d
ms.sourcegitcommit: 579c39ff4b776704ead17a006bf24cd4cdc65edd
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/17/2019
ms.locfileid: "59644003"
---
# <a name="designing-reliable-azure-applications"></a><span data-ttu-id="339e9-103">設計可靠的 Azure 應用程式</span><span class="sxs-lookup"><span data-stu-id="339e9-103">Designing reliable Azure applications</span></span>

<span data-ttu-id="339e9-104">在雲端中建置可靠的應用程式不同於傳統應用程式的開發。</span><span class="sxs-lookup"><span data-stu-id="339e9-104">Building a reliable application in the cloud is different from traditional application development.</span></span> <span data-ttu-id="339e9-105">儘管您在過去可能已購買更高階的硬體來相應增加，但在雲端環境中，您應進行相應放大而不是相應增加。</span><span class="sxs-lookup"><span data-stu-id="339e9-105">While historically you may have purchased higher-end hardware to scale up, in a cloud environment you scale out instead of up.</span></span> <span data-ttu-id="339e9-106">此目標不是試著完全避免失敗，而是將單一故障元件的影響降至最低。</span><span class="sxs-lookup"><span data-stu-id="339e9-106">Instead of trying to prevent failures altogether, the goal is to minimize the effects of a single failing component.</span></span>

<span data-ttu-id="339e9-107">可靠的應用程式應具備：</span><span class="sxs-lookup"><span data-stu-id="339e9-107">Reliable applications are:</span></span>

- <span data-ttu-id="339e9-108">從失敗中順利**復原**的能力，而且在完整復原之前，這些應用程式能在停機時間最短和資料遺失最少的情況下繼續運作。</span><span class="sxs-lookup"><span data-stu-id="339e9-108">**Resilient** and recover gracefully from failures, and they continue to function with minimal downtime and data loss before full recovery.</span></span>
- <span data-ttu-id="339e9-109">**高可用性 (HA)**，可依據設計訴求在健全狀態下執行，並且沒有重大的停機時間。</span><span class="sxs-lookup"><span data-stu-id="339e9-109">**Highly available (HA)** and run as designed in a healthy state with no significant downtime.</span></span>

<span data-ttu-id="339e9-110">了解這些項目如何一起運作及如何影響成本，都是建置可靠應用程式的要素。</span><span class="sxs-lookup"><span data-stu-id="339e9-110">Understanding how these elements work together &mdash; and how they affect cost &mdash; is essential to building a reliable application.</span></span> <span data-ttu-id="339e9-111">這可協助您判斷可接受的停機時間是多久、您業務的潛在成本有多少，以及在復原期間有哪些功能是必要的。</span><span class="sxs-lookup"><span data-stu-id="339e9-111">It can help you determine how much downtime is acceptable, the potential cost to your business, and which functions are necessary during a recovery.</span></span>

<span data-ttu-id="339e9-112">本文會提供簡短概觀，講述如何將可靠性建置到 Azure 應用程式設計程序的每個步驟中。</span><span class="sxs-lookup"><span data-stu-id="339e9-112">This article provides a brief overview of building reliability into each step of the Azure application design process.</span></span> <span data-ttu-id="339e9-113">每一節都包含深入文章的連結，說明如何將可靠性整合至程序中的特定步驟。</span><span class="sxs-lookup"><span data-stu-id="339e9-113">Each section includes a link to an in-depth article on how to integrate reliability into that specific step in the process.</span></span> <span data-ttu-id="339e9-114">如果您想知道個別 Azure 服務的可靠性考量，請檢閱[特定 Azure 服務的復原檢查清單](../checklist/resiliency-per-service.md)。</span><span class="sxs-lookup"><span data-stu-id="339e9-114">If you're looking for reliability considerations for individual Azure services, review the [Resiliency checklist for specific Azure services](../checklist/resiliency-per-service.md).</span></span>

## <a name="build-for-reliability"></a><span data-ttu-id="339e9-115">針對可靠性進行建置</span><span class="sxs-lookup"><span data-stu-id="339e9-115">Build for reliability</span></span>

<span data-ttu-id="339e9-116">本節將描述建置可靠 Azure 應用程式的六個步驟。</span><span class="sxs-lookup"><span data-stu-id="339e9-116">This section describes six steps for building a reliable Azure application.</span></span> <span data-ttu-id="339e9-117">每個步驟都會連結至進一步定義程序和詞彙的區段。</span><span class="sxs-lookup"><span data-stu-id="339e9-117">Each step links to a section that further defines the process and terms.</span></span>

1. [<span data-ttu-id="339e9-118">**定義需求。**</span><span class="sxs-lookup"><span data-stu-id="339e9-118">**Define requirements.**</span></span>](#define-requirements) <span data-ttu-id="339e9-119">根據細分的工作負載和業務需求，開發可用性和復原需求。</span><span class="sxs-lookup"><span data-stu-id="339e9-119">Develop availability and recovery requirements based on decomposed workloads and business needs.</span></span>
1. [<span data-ttu-id="339e9-120">**使用建構式最佳做法。**</span><span class="sxs-lookup"><span data-stu-id="339e9-120">**Use architectural best practices.**</span></span>](#use-architectural-best-practices) <span data-ttu-id="339e9-121">遵循經過證實的作法、識別架構中可能的失敗點，以及決定應用程式如何回應失敗。</span><span class="sxs-lookup"><span data-stu-id="339e9-121">Follow proven practices, identify possible failure points in the architecture, and determine how the application will respond to failure.</span></span>
1. [<span data-ttu-id="339e9-122">**透過模擬及強制容錯移轉進行測試。**</span><span class="sxs-lookup"><span data-stu-id="339e9-122">**Test with simulations and forced failovers.**</span></span>](#test-with-simulations-and-forced-failovers) <span data-ttu-id="339e9-123">模擬錯誤、觸發強制容錯移轉及測試偵測，並從這些失敗中復原。</span><span class="sxs-lookup"><span data-stu-id="339e9-123">Simulate faults, trigger forced failovers, and test detection and recovery from these failures.</span></span>
1. [<span data-ttu-id="339e9-124">**持續部署應用程式。**</span><span class="sxs-lookup"><span data-stu-id="339e9-124">**Deploy the application consistently.**</span></span>](#deploy-the-application-consistently) <span data-ttu-id="339e9-125">使用可靠且重複的程序發行至生產環境。</span><span class="sxs-lookup"><span data-stu-id="339e9-125">Release to production using reliable and repeatable processes.</span></span>
1. [<span data-ttu-id="339e9-126">**監視應用程式健康情況。**</span><span class="sxs-lookup"><span data-stu-id="339e9-126">**Monitor application health.**</span></span>](#monitor-application-health) <span data-ttu-id="339e9-127">偵測失敗、監視潛在問題的指標，以及評估應用程式的健康情況。</span><span class="sxs-lookup"><span data-stu-id="339e9-127">Detect failures, monitor indicators of potential failures, and gauge the health of your applications.</span></span>
1. [<span data-ttu-id="339e9-128">**回應失敗和災害。**</span><span class="sxs-lookup"><span data-stu-id="339e9-128">**Respond to failures and disasters.**</span></span>](#respond-to-failures-and-disasters) <span data-ttu-id="339e9-129">識別發生失敗的時間，並依據已建立的策略來決定處理方式。</span><span class="sxs-lookup"><span data-stu-id="339e9-129">Identify when a failure occurs, and determine how to address it based on established strategies.</span></span>

## <a name="define-requirements"></a><span data-ttu-id="339e9-130">定義需求</span><span class="sxs-lookup"><span data-stu-id="339e9-130">Define requirements</span></span>

<span data-ttu-id="339e9-131">識別您的業務需求，並建置可靠性計劃來因應這些需求。</span><span class="sxs-lookup"><span data-stu-id="339e9-131">Identify your business needs, and build your reliability plan to address them.</span></span> <span data-ttu-id="339e9-132">請考慮下列：</span><span class="sxs-lookup"><span data-stu-id="339e9-132">Consider the following:</span></span>

- <span data-ttu-id="339e9-133">**識別工作負載和使用方式。**</span><span class="sxs-lookup"><span data-stu-id="339e9-133">**Identify workloads and usage.**</span></span> <span data-ttu-id="339e9-134">「工作負載」是指不同的功能或工作，可根據商務邏輯和資料儲存體需求，以邏輯方式與其他工作區隔。</span><span class="sxs-lookup"><span data-stu-id="339e9-134">A *workload* is a distinct capability or task that is logically separated from other tasks, in terms of business logic and data storage requirements.</span></span> <span data-ttu-id="339e9-135">每個工作負載在可用性、延展性、資料一致性和災害復原方面，都有不同的需求。</span><span class="sxs-lookup"><span data-stu-id="339e9-135">Each workload has different requirements for availability, scalability, data consistency, and disaster recovery.</span></span>
- <span data-ttu-id="339e9-136">**使用模式的規劃。**</span><span class="sxs-lookup"><span data-stu-id="339e9-136">**Plan for usage patterns.**</span></span> <span data-ttu-id="339e9-137">「使用模式」在需求中也扮演重要角色。</span><span class="sxs-lookup"><span data-stu-id="339e9-137">*Usage patterns* also play a role in requirements.</span></span> <span data-ttu-id="339e9-138">用來識別重要和非重要期間的需求差異。</span><span class="sxs-lookup"><span data-stu-id="339e9-138">Identify differences in requirements during critical and non-critical periods.</span></span> <span data-ttu-id="339e9-139">例如，報稅應用程式不能在報稅期限的期間失敗。</span><span class="sxs-lookup"><span data-stu-id="339e9-139">For example, a tax-filing application can't fail during a filing deadline.</span></span> <span data-ttu-id="339e9-140">若要確保執行時間不中斷，應在數個區域間規劃備援，以因應其中一個區域失敗的狀況。</span><span class="sxs-lookup"><span data-stu-id="339e9-140">To ensure uptime, plan redundancy across several regions in case one fails.</span></span> <span data-ttu-id="339e9-141">相反地，若要在非重要期間降低成本，您可以在單一區域中執行應用程式。</span><span class="sxs-lookup"><span data-stu-id="339e9-141">Conversely, to minimize costs during non-critical periods, you can run your application in a single region.</span></span>
- <span data-ttu-id="339e9-142">**建立可用性計量&mdash; 平均復原時間 (MTTR) 和平均失敗時間 (MTBF)。**</span><span class="sxs-lookup"><span data-stu-id="339e9-142">**Establish availability metrics &mdash; *mean time to recovery* (MTTR) and *mean time between failures* (MTBF).**</span></span> <span data-ttu-id="339e9-143">MTTR 是失敗後還原元件所需的平均時間。</span><span class="sxs-lookup"><span data-stu-id="339e9-143">MTTR is the average time it takes to restore a component after a failure.</span></span> <span data-ttu-id="339e9-144">MTBF 現在是合理預期元件可在兩次中斷之間持續執行的時間。</span><span class="sxs-lookup"><span data-stu-id="339e9-144">MTBF is now long a component can reasonably expect to last between outages.</span></span> <span data-ttu-id="339e9-145">您可以使用這些量值來決定要新增備援的區域，以及決定客戶的服務等級協定 (SLA)。</span><span class="sxs-lookup"><span data-stu-id="339e9-145">Use these measures to determine where to add redundancy and to determine service-level agreements (SLAs) for customers.</span></span>  
- <span data-ttu-id="339e9-146">**建立復原計量&mdash; 復原時間目標和復原點目標 (RPO)。**</span><span class="sxs-lookup"><span data-stu-id="339e9-146">**Establish recovery metrics &mdash; recovery time objective and recovery point objective (RPO).**</span></span> <span data-ttu-id="339e9-147">RTO 是應用程式在事件發生之後可能無法使用的最大可接受時間。</span><span class="sxs-lookup"><span data-stu-id="339e9-147">*RTO* is the maximum acceptable time an application can be unavailable after an incident.</span></span> <span data-ttu-id="339e9-148">RPO 是在災害期間可接受的最大資料遺失時間長度。</span><span class="sxs-lookup"><span data-stu-id="339e9-148">*RPO* is the maximum duration of data loss that is acceptable during a disaster.</span></span> <span data-ttu-id="339e9-149">若要衍生這些值，請進行風險評估，並確定您了解組織發生停機或資料遺失時的風險與成本。</span><span class="sxs-lookup"><span data-stu-id="339e9-149">To derive these values, conduct a risk assessment and make sure you understand the cost and risk of downtime or data loss in your organization.</span></span>
    > [!NOTE]
    > <span data-ttu-id="339e9-150">針對「任何」具可用性設定的元件，如果其 MTTR 超過系統 RTO，則系統中的失敗可能會導致無法接受的業務中斷。</span><span class="sxs-lookup"><span data-stu-id="339e9-150">If the MTTR of *any* critical component in a highly available setup exceeds the system RTO, a failure in the system might cause an unacceptable business disruption.</span></span> <span data-ttu-id="339e9-151">也就是，您無法在定義的 RTO 內還原系統。</span><span class="sxs-lookup"><span data-stu-id="339e9-151">That is, you can't restore the system within the defined RTO.</span></span>
- <span data-ttu-id="339e9-152">**決定工作負載的可用性目標。**</span><span class="sxs-lookup"><span data-stu-id="339e9-152">**Determine workload availability targets.**</span></span> <span data-ttu-id="339e9-153">若要確保應用程式架構符合您的業務需求，請定義每個工作負載的目標 SLA。</span><span class="sxs-lookup"><span data-stu-id="339e9-153">To ensure that application architecture meets your business requirements, define target SLAs for each workload.</span></span> <span data-ttu-id="339e9-154">除了應用程式相依性之外，還需包含符合可用性需求的成本與複雜度。</span><span class="sxs-lookup"><span data-stu-id="339e9-154">Account for the cost and complexity of meeting availability requirements, in addition to application dependencies.</span></span>
- <span data-ttu-id="339e9-155">**了解服務等級協定。**</span><span class="sxs-lookup"><span data-stu-id="339e9-155">**Understand service-level agreements.**</span></span> <span data-ttu-id="339e9-156">在 Azure 中，SLA 會描述 Microsoft 對執行時間與連線能力的承諾。</span><span class="sxs-lookup"><span data-stu-id="339e9-156">In Azure, the SLA describes the Microsoft commitments for uptime and connectivity.</span></span> <span data-ttu-id="339e9-157">如果特定服務的 SLA 是 99.95%，則您可以預期 99.95% 的時間皆可提供服務。</span><span class="sxs-lookup"><span data-stu-id="339e9-157">If the SLA for a particular service is 99.9 percent, you should expect the service to be available 99.9 percent of the time.</span></span>  

    <span data-ttu-id="339e9-158">為您方案中的每個工作負載定義您自己的目標 SLA，即可判斷架構是否符合業務需求。</span><span class="sxs-lookup"><span data-stu-id="339e9-158">Define your own target SLAs for each workload in your solution, so you can determine whether the architecture meets the business requirements.</span></span> <span data-ttu-id="339e9-159">例如，如果工作負載需要 99.99% 的執行時間，但需依附 99.9 % SLA 的服務，則該服務就不能是系統中的單一失敗點。</span><span class="sxs-lookup"><span data-stu-id="339e9-159">For example, if a workload requires 99.99 percent uptime but depends on a service with a 99.9 percent SLA, that service can't be a single point of failure in the system.</span></span>

<span data-ttu-id="339e9-160">若要深入了解如何開發可靠應用程式的需求，請參閱[開發可復原 Azure 應用程式的需求](./requirements.md)。</span><span class="sxs-lookup"><span data-stu-id="339e9-160">For more information about developing requirements for reliable applications, see [Developing requirements for resilient Azure applications](./requirements.md).</span></span>

## <a name="use-architectural-best-practices"></a><span data-ttu-id="339e9-161">使用建構式最佳做法</span><span class="sxs-lookup"><span data-stu-id="339e9-161">Use architectural best practices</span></span>

<span data-ttu-id="339e9-162">在建構階段上，專注於實作符合您業務需求的做法、識別失敗點，以及最小化失敗的範圍。</span><span class="sxs-lookup"><span data-stu-id="339e9-162">During the architectural phase, focus on implementing practices that meet your business requirements, identify failure points, and minimize the scope of failures.</span></span>

- <span data-ttu-id="339e9-163">**執行失敗模式分析 (FMA)。**</span><span class="sxs-lookup"><span data-stu-id="339e9-163">**Perform a failure mode analysis (FMA).**</span></span> <span data-ttu-id="339e9-164">FMA 會在設計階段早期將復原能力內建到應用程式。</span><span class="sxs-lookup"><span data-stu-id="339e9-164">FMA builds resiliency into an application early in the design stage.</span></span> <span data-ttu-id="339e9-165">這可協助您識別應用程式可能會遇到的失敗、每一個失敗的潛在影響，以及可能的復原策略。</span><span class="sxs-lookup"><span data-stu-id="339e9-165">It helps you identify the types of failures your application might experience, the potential effects of each, and possible recovery strategies.</span></span>
- <span data-ttu-id="339e9-166">**建立備援計劃。**</span><span class="sxs-lookup"><span data-stu-id="339e9-166">**Create a redundancy plan.**</span></span> <span data-ttu-id="339e9-167">每個工作負載所需的備援層級皆取決於您的業務需求，以及影響應用程式整體成本的因素。</span><span class="sxs-lookup"><span data-stu-id="339e9-167">The level of redundancy required for each workload depends on your business needs and factors into the overall cost of your application.</span></span> 
- <span data-ttu-id="339e9-168">**延展性設計。**</span><span class="sxs-lookup"><span data-stu-id="339e9-168">**Design for scalability.**</span></span> <span data-ttu-id="339e9-169">雲端應用程式必須能根據使用量變化進行調整。</span><span class="sxs-lookup"><span data-stu-id="339e9-169">A cloud application must be able to scale to accommodate changes in usage.</span></span> <span data-ttu-id="339e9-170">一開始使用獨立的元件，並盡可能將應用程式設定為自動回應負載變更。</span><span class="sxs-lookup"><span data-stu-id="339e9-170">Begin with discrete components, and design the application to respond automatically to load changes whenever possible.</span></span> <span data-ttu-id="339e9-171">設計時應考慮到調整限制，以便未來可輕鬆地進行延展。</span><span class="sxs-lookup"><span data-stu-id="339e9-171">Keep scaling limits in mind during design so you can expand easily in the future.</span></span>
- <span data-ttu-id="339e9-172">**訂用帳戶和服務需求的規劃。**</span><span class="sxs-lookup"><span data-stu-id="339e9-172">**Plan for subscription and service requirements.**</span></span> <span data-ttu-id="339e9-173">您可能需要額外的訂用帳戶來佈建足以符合您業務需求的資源，像是用於儲存體、連線和輸送量等等的資源。</span><span class="sxs-lookup"><span data-stu-id="339e9-173">You might need additional subscriptions to provision enough resources to meet your business requirements for storage, connections, throughput, and more.</span></span> 
- <span data-ttu-id="339e9-174">**使用負載平衡功能來分配要求。**</span><span class="sxs-lookup"><span data-stu-id="339e9-174">**Use load-balancing to distribute requests.**</span></span> <span data-ttu-id="339e9-175">負載平衡功能可藉由從循環中移除狀況不良的執行個體，將應用程式的要求分配至狀況良好的服務執行個體。</span><span class="sxs-lookup"><span data-stu-id="339e9-175">Load-balancing distributes your application's requests to healthy service instances by removing unhealthy instances from rotation.</span></span>
- <span data-ttu-id="339e9-176">**實作復原策略。**</span><span class="sxs-lookup"><span data-stu-id="339e9-176">**Implement resiliency strategies.**</span></span> <span data-ttu-id="339e9-177">*復原*是系統從失敗中復原並繼續運作的能力。</span><span class="sxs-lookup"><span data-stu-id="339e9-177">*Resiliency* is the ability of a system to recover from failures and continue to function.</span></span> <span data-ttu-id="339e9-178">實作[復原設計模式](../patterns/category/resiliency.md)，例如在可能的情況下隔離重要資源、使用補償交易及執行非同步作業。</span><span class="sxs-lookup"><span data-stu-id="339e9-178">Implement [resiliency design patterns](../patterns/category/resiliency.md), such as isolating critical resources, using compensating transactions, and performing asynchronous operations whenever possible.</span></span>
- <span data-ttu-id="339e9-179">**將可用性需求建置到設計中。**</span><span class="sxs-lookup"><span data-stu-id="339e9-179">**Build availability requirements into your design.**</span></span> <span data-ttu-id="339e9-180">「可用性」是系統正常運作並執行作業的時間比例。</span><span class="sxs-lookup"><span data-stu-id="339e9-180">*Availability* is the proportion of time your system is functional and working.</span></span> <span data-ttu-id="339e9-181">採取步驟來確保應用程式可用性符合您的服務等級協定。</span><span class="sxs-lookup"><span data-stu-id="339e9-181">Take steps to ensure that application availability conforms to your service-level agreement.</span></span> <span data-ttu-id="339e9-182">例如，避免單一失敗點、根據服務等級目標來細分工作負載，以及對大量使用者進行節流。</span><span class="sxs-lookup"><span data-stu-id="339e9-182">For example, avoid single points of failure, decompose workloads by service-level objective, and throttle high-volume users.</span></span>
- <span data-ttu-id="339e9-183">**管理資料。**</span><span class="sxs-lookup"><span data-stu-id="339e9-183">**Manage your data.**</span></span> <span data-ttu-id="339e9-184">如何儲存、備份和複寫資料相當重要。</span><span class="sxs-lookup"><span data-stu-id="339e9-184">How you store, back up, and replicate data is critical.</span></span>

  - <span data-ttu-id="339e9-185">**選擇您應用程式資料適用的複寫方法。**</span><span class="sxs-lookup"><span data-stu-id="339e9-185">**Choose replication methods for your application data.**</span></span> <span data-ttu-id="339e9-186">應用程式資料會儲存在各種資料存放區，而且可能有不同的可用性需求。</span><span class="sxs-lookup"><span data-stu-id="339e9-186">Your application data is stored in various data stores and might have different availability requirements.</span></span> <span data-ttu-id="339e9-187">評估每種資料存放區類型的複寫方法和位置，以確保其符合您的需求。</span><span class="sxs-lookup"><span data-stu-id="339e9-187">Evaluate the replication methods and locations for each type of data store to ensure that they satisfy your requirements.</span></span>
  - <span data-ttu-id="339e9-188">**記載和測試您的容錯移轉和容錯回復程序。**</span><span class="sxs-lookup"><span data-stu-id="339e9-188">**Document and test your failover and failback processes.**</span></span> <span data-ttu-id="339e9-189">清楚記載容錯移轉到新資料存放區的指示，並定期進行測試，以確定這些指示正確且易於遵循。</span><span class="sxs-lookup"><span data-stu-id="339e9-189">Clearly document instructions to fail over to a new data store, and test them regularly to make sure they are accurate and easy to follow.</span></span>
  - <span data-ttu-id="339e9-190">**保護您的資料。**</span><span class="sxs-lookup"><span data-stu-id="339e9-190">**Protect your data.**</span></span> <span data-ttu-id="339e9-191">定期備份和驗證資料，並確定沒有單一使用者帳戶可存取生產和備份資料。</span><span class="sxs-lookup"><span data-stu-id="339e9-191">Back up and validate data regularly, and make sure no single user account has access to both production and backup data.</span></span>
  - <span data-ttu-id="339e9-192">**資料復原的規劃。**</span><span class="sxs-lookup"><span data-stu-id="339e9-192">**Plan for data recovery.**</span></span> <span data-ttu-id="339e9-193">確定您為資料復原時間提供的備份和複寫策略符合服務層級需求。</span><span class="sxs-lookup"><span data-stu-id="339e9-193">Make sure that your backup and replication strategy provides for data recovery times that meet your service-level requirements.</span></span> <span data-ttu-id="339e9-194">需可處理您應用程式使用的所有資料類型，包括參考資料和資料庫。</span><span class="sxs-lookup"><span data-stu-id="339e9-194">Account for all types of data your application uses, including reference data and databases.</span></span>

<span data-ttu-id="339e9-195">如需如何建構可靠應用程式的詳細資訊，請參閱[建構 Azure 應用程式的復原能力和可用性](./architect.md)。</span><span class="sxs-lookup"><span data-stu-id="339e9-195">For more information about architecting reliable applications, see [Architecting Azure applications for resiliency and availability](./architect.md).</span></span>

## <a name="test-with-simulations-and-forced-failovers"></a><span data-ttu-id="339e9-196">透過模擬及強制容錯移轉進行測試</span><span class="sxs-lookup"><span data-stu-id="339e9-196">Test with simulations and forced failovers</span></span>

<span data-ttu-id="339e9-197">若要測試可靠性，必須評估端對端工作負載在失敗情況下的執行方式，而這只會間歇性發生。</span><span class="sxs-lookup"><span data-stu-id="339e9-197">Testing for reliability requires measuring how the end-to-end workload performs under failure conditions that only occur intermittently.</span></span>

- <span data-ttu-id="339e9-198">**藉由觸發或模擬實際失敗情形來測試常見的失敗案例。**</span><span class="sxs-lookup"><span data-stu-id="339e9-198">**Test for common failure scenarios by triggering actual failures or by simulating them.**</span></span> <span data-ttu-id="339e9-199">使用錯誤插入式測試來測試常見案例 (包括失敗的組合) 和復原時間。</span><span class="sxs-lookup"><span data-stu-id="339e9-199">Use fault injection testing to test common scenarios (including combinations of failures) and recovery time.</span></span>
- <span data-ttu-id="339e9-200">**識別只在負載下發生的失敗。**</span><span class="sxs-lookup"><span data-stu-id="339e9-200">**Identify failures that occur only under load.**</span></span> <span data-ttu-id="339e9-201">使用生產資料或盡可能最接近生產資料的綜合資料，針對尖峰負載進行測試，以查看應用程式在實際狀況下的行為。</span><span class="sxs-lookup"><span data-stu-id="339e9-201">Test for peak load, using production data or synthetic data that is as close to production data as possible, to see how the application behaves under real-world conditions.</span></span>
- <span data-ttu-id="339e9-202">**執行災害復原演練。**</span><span class="sxs-lookup"><span data-stu-id="339e9-202">**Run disaster recovery drills.**</span></span> <span data-ttu-id="339e9-203">制定災害復原計劃，並定期測試以確保其正常運作。</span><span class="sxs-lookup"><span data-stu-id="339e9-203">Have a disaster recovery plan in place, and test it periodically to make sure it works.</span></span>
- <span data-ttu-id="339e9-204">**執行容錯移轉和容錯回復測試。**</span><span class="sxs-lookup"><span data-stu-id="339e9-204">**Perform failover and failback testing.**</span></span> <span data-ttu-id="339e9-205">確保您應用程式的相依服務以正確的順序容錯移轉及容錯回復。</span><span class="sxs-lookup"><span data-stu-id="339e9-205">Ensure that your application's dependent services fail over and fail back in the correct order.</span></span>
- <span data-ttu-id="339e9-206">**執行模擬測試。**</span><span class="sxs-lookup"><span data-stu-id="339e9-206">**Run simulation tests.**</span></span> <span data-ttu-id="339e9-207">測試現實生活案例可以彰顯必須解決的問題。</span><span class="sxs-lookup"><span data-stu-id="339e9-207">Testing real-life scenarios can highlight issues that need to be addressed.</span></span> <span data-ttu-id="339e9-208">這些案例必須可控制，而且不會干擾到業務。</span><span class="sxs-lookup"><span data-stu-id="339e9-208">Scenarios should be controllable and non-disruptive to the business.</span></span> <span data-ttu-id="339e9-209">將模擬測試計劃告知管理部門。</span><span class="sxs-lookup"><span data-stu-id="339e9-209">Inform management of simulation testing plans.</span></span>
- <span data-ttu-id="339e9-210">**測試健康情況探查。**</span><span class="sxs-lookup"><span data-stu-id="339e9-210">**Test health probes.**</span></span> <span data-ttu-id="339e9-211">為負載平衡器和流量管理員設定健康情況探查，以檢查重要的系統元件。</span><span class="sxs-lookup"><span data-stu-id="339e9-211">Configure health probes for load balancers and traffic managers to check critical system components.</span></span> <span data-ttu-id="339e9-212">進行測試，以確保這些元件可適當地回應。</span><span class="sxs-lookup"><span data-stu-id="339e9-212">Test them to make sure that they respond appropriately.</span></span>
- <span data-ttu-id="339e9-213">**測試監視系統。**</span><span class="sxs-lookup"><span data-stu-id="339e9-213">**Test monitoring systems.**</span></span> <span data-ttu-id="339e9-214">確保監視系統能夠確實回報重要資訊及精確的資料，以協助找出潛在的問題。</span><span class="sxs-lookup"><span data-stu-id="339e9-214">Be sure that monitoring systems are reliably reporting critical information and accurate data to help identify potential failures.</span></span>
- <span data-ttu-id="339e9-215">**在測試案例中包含第三方服務。**</span><span class="sxs-lookup"><span data-stu-id="339e9-215">**Include third-party services in test scenarios.**</span></span> <span data-ttu-id="339e9-216">除了測試復原能力外，也測試因為第三方服務中斷導致的失敗點。</span><span class="sxs-lookup"><span data-stu-id="339e9-216">Test possible points of failure due to third-party service disruption, in addition to recovery.</span></span>

<span data-ttu-id="339e9-217">測試是反覆的程序。</span><span class="sxs-lookup"><span data-stu-id="339e9-217">Testing is an iterative process.</span></span> <span data-ttu-id="339e9-218">測試應用程式、測量結果、分析及解決任何失敗，並重複此程序。</span><span class="sxs-lookup"><span data-stu-id="339e9-218">Test the application, measure the outcome, analyze and address any failures, and repeat the process.</span></span>

<span data-ttu-id="339e9-219">如需有關測試應用程式可靠性的詳細資訊，請參閱[測試 Azure 應用程式的復原能力和可用性](./testing.md)。</span><span class="sxs-lookup"><span data-stu-id="339e9-219">For more information about testing for application reliability, see [Testing Azure applications for resiliency and availability](./testing.md).</span></span>

## <a name="deploy-the-application-consistently"></a><span data-ttu-id="339e9-220">持續部署應用程式</span><span class="sxs-lookup"><span data-stu-id="339e9-220">Deploy the application consistently</span></span>

<span data-ttu-id="339e9-221">「部署」包括佈建 Azure 資源、部署應用程式的程式碼，以及套用組態集。</span><span class="sxs-lookup"><span data-stu-id="339e9-221">*Deployment* includes provisioning Azure resources, deploying application code, and applying configuration settings.</span></span> <span data-ttu-id="339e9-222">更新可能需要這三個工作或這些工作的子集。</span><span class="sxs-lookup"><span data-stu-id="339e9-222">An update may involve all three tasks or a subset of them.</span></span>

<span data-ttu-id="339e9-223">一旦應用程式部署到生產環境後，更新就會成為可能的錯誤來源。</span><span class="sxs-lookup"><span data-stu-id="339e9-223">After an application is deployed to production, updates are a possible source of errors.</span></span> <span data-ttu-id="339e9-224">針對可預測且可重複的部署程序，將其錯誤發生率降至最低。</span><span class="sxs-lookup"><span data-stu-id="339e9-224">Minimize errors with predictable and repeatable deployment processes.</span></span>

- <span data-ttu-id="339e9-225">**自動執行應用程式的部署程序。**</span><span class="sxs-lookup"><span data-stu-id="339e9-225">**Automate your application deployment process.**</span></span> <span data-ttu-id="339e9-226">盡可能自動化多個程序。</span><span class="sxs-lookup"><span data-stu-id="339e9-226">Automate as many processes as possible.</span></span>
- <span data-ttu-id="339e9-227">**設計您的發行程序，以最大化可用性。**</span><span class="sxs-lookup"><span data-stu-id="339e9-227">**Design your release process to maximize availability.**</span></span> <span data-ttu-id="339e9-228">如果您的發行程序要求服務在部署期間離線，您的應用程式將無法使用，直到服務重新上線為止。</span><span class="sxs-lookup"><span data-stu-id="339e9-228">If your release process requires services to go offline during deployment, your application is unavailable until they come back online.</span></span> <span data-ttu-id="339e9-229">充分運用平台的預備和實際執行功能。</span><span class="sxs-lookup"><span data-stu-id="339e9-229">Take advantage of platform staging and production features.</span></span> <span data-ttu-id="339e9-230">使用藍綠部署或 Canary 版本來部署更新，以便在發生失敗時，您可以快速復原更新。</span><span class="sxs-lookup"><span data-stu-id="339e9-230">Use blue-green or canary releases to deploy updates, so if a failure occurs, you can quickly roll back the update.</span></span>
- <span data-ttu-id="339e9-231">**具備部署回復計劃。**</span><span class="sxs-lookup"><span data-stu-id="339e9-231">**Have a rollback plan for deployment.**</span></span> <span data-ttu-id="339e9-232">設計復原程序，以在部署失敗時，回到上一個已知良好的版本並將停機時間縮到最短。</span><span class="sxs-lookup"><span data-stu-id="339e9-232">Design a rollback process to return to a last known good version and to minimize downtime if a deployment fails.</span></span>
- <span data-ttu-id="339e9-233">**記錄和稽核部署。**</span><span class="sxs-lookup"><span data-stu-id="339e9-233">**Log and audit deployments.**</span></span> <span data-ttu-id="339e9-234">如果您使用分段部署技術，您的應用程式會有一個以上的版本在生產環境中執行。</span><span class="sxs-lookup"><span data-stu-id="339e9-234">If you use staged deployment techniques, more than one version of your application is running in production.</span></span> <span data-ttu-id="339e9-235">實作強固的記錄策略，儘可能擷取較多的版本特有資訊。</span><span class="sxs-lookup"><span data-stu-id="339e9-235">Implement a robust logging strategy to capture as much version-specific information as possible.</span></span>
- <span data-ttu-id="339e9-236">**記載應用程式發行程序。**</span><span class="sxs-lookup"><span data-stu-id="339e9-236">**Document the application release process.**</span></span> <span data-ttu-id="339e9-237">明確定義和記載您的發行程序，並確保它可供整個營運小組使用。</span><span class="sxs-lookup"><span data-stu-id="339e9-237">Clearly define and document your release process, and ensure that it's available to the entire operations team.</span></span>

<span data-ttu-id="339e9-238">如需有關應用程式可靠性及部署的詳細資訊，請參閱[部署 Azure 應用程式的復原能力和可用性](./deploy.md)。</span><span class="sxs-lookup"><span data-stu-id="339e9-238">For more information about application reliability and deployment, see [Deploying Azure applications for resiliency and availability](./deploy.md).</span></span>

## <a name="monitor-application-health"></a><span data-ttu-id="339e9-239">監視應用程式健康情況</span><span class="sxs-lookup"><span data-stu-id="339e9-239">Monitor application health</span></span>

<span data-ttu-id="339e9-240">在您應用程式中實作監視和警示的最佳做法，讓您可以偵測失敗並向操作人員發出警示，以進行修正。</span><span class="sxs-lookup"><span data-stu-id="339e9-240">Implement best practices for monitoring and alerts in your application so you can detect failures and alert an operator to fix them.</span></span>

- <span data-ttu-id="339e9-241">**實作健康情況探查並檢查功能。**</span><span class="sxs-lookup"><span data-stu-id="339e9-241">**Implement health probes and check functions.**</span></span> <span data-ttu-id="339e9-242">定期從應用程式外部執行探查，以識別低落的應用程式健康情況和效能。</span><span class="sxs-lookup"><span data-stu-id="339e9-242">Run them regularly from outside the application to identify degradation of application health and performance.</span></span>
- <span data-ttu-id="339e9-243">**檢查長時間執行的工作流程。**</span><span class="sxs-lookup"><span data-stu-id="339e9-243">**Check long-running workflows.**</span></span> <span data-ttu-id="339e9-244">及早攔截問題可以減少復原復整個工作流程或執行多個補償交易的需求。</span><span class="sxs-lookup"><span data-stu-id="339e9-244">Catching issues early can minimize the need to roll back the entire workflow or to execute multiple compensating transactions.</span></span>
- <span data-ttu-id="339e9-245">**維護應用程式記錄。**</span><span class="sxs-lookup"><span data-stu-id="339e9-245">**Maintain application logs.**</span></span>

  - <span data-ttu-id="339e9-246">記錄生產環境中和服務界限上的應用程式。</span><span class="sxs-lookup"><span data-stu-id="339e9-246">Log applications in production and at service boundaries.</span></span>
  - <span data-ttu-id="339e9-247">使用語意和非同步記錄。</span><span class="sxs-lookup"><span data-stu-id="339e9-247">Use semantic and asynchronous logging.</span></span>
  - <span data-ttu-id="339e9-248">將應用程式記錄檔與稽核記錄分開。</span><span class="sxs-lookup"><span data-stu-id="339e9-248">Separate application logs from audit logs.</span></span>

- <span data-ttu-id="339e9-249">**評估遠端呼叫統計資料，並與應用程式小組共用資料。**</span><span class="sxs-lookup"><span data-stu-id="339e9-249">**Measure remote call statistics, and share the data with the application team.**</span></span> <span data-ttu-id="339e9-250">若要讓作業小組可即時檢視應用程式的健康情況，可總結遠端呼叫計量，例如第 99 個和第 95 個百分位數中的延遲、輸送量和錯誤。</span><span class="sxs-lookup"><span data-stu-id="339e9-250">To give your operations team an instantaneous view into application health, summarize remote call metrics, such as latency, throughput, and errors in the 99 and 95 percentiles.</span></span> <span data-ttu-id="339e9-251">對計量執行統計分析，以發現在每個百分位數內發生的錯誤。</span><span class="sxs-lookup"><span data-stu-id="339e9-251">Perform statistical analysis on the metrics to uncover errors that occur within each percentile.</span></span>
- <span data-ttu-id="339e9-252">**追蹤一段適當時間範圍內的暫時性例外狀況和重試數目。**</span><span class="sxs-lookup"><span data-stu-id="339e9-252">**Track transient exceptions and retries over an appropriate time frame.**</span></span> <span data-ttu-id="339e9-253">例外狀況隨著時間遞增的趨勢，表示服務有問題而且可能失敗。</span><span class="sxs-lookup"><span data-stu-id="339e9-253">A trend of increasing exceptions over time indicates that the service is having an issue and may fail.</span></span>
- <span data-ttu-id="339e9-254">**設定預先警告系統。**</span><span class="sxs-lookup"><span data-stu-id="339e9-254">**Set up an early warning system.**</span></span> <span data-ttu-id="339e9-255">找出應用程式健康情況的關鍵效能指標 (KPI)，例如暫時性例外狀況和遠端呼叫延遲，並且為每個指標設定適當的閾值。</span><span class="sxs-lookup"><span data-stu-id="339e9-255">Identify the key performance indicators (KPIs) of an application's health, such as transient exceptions and remote call latency, and set appropriate threshold values for each of them.</span></span> <span data-ttu-id="339e9-256">達到臨界值時，傳送警示給營運小組。</span><span class="sxs-lookup"><span data-stu-id="339e9-256">Send an alert to operations when the threshold value is reached.</span></span>
- <span data-ttu-id="339e9-257">**在 Azure 訂用帳戶限制內運作。**</span><span class="sxs-lookup"><span data-stu-id="339e9-257">**Operate within Azure subscription limits.**</span></span> <span data-ttu-id="339e9-258">Azure 訂用帳戶對某些資源類型有所限制，例如資源群組、核心及儲存體帳戶的數目。</span><span class="sxs-lookup"><span data-stu-id="339e9-258">Azure subscriptions have limits on certain resource types, such as the number of resource groups, cores, and storage accounts.</span></span> <span data-ttu-id="339e9-259">監看您對資源類型的使用方式。</span><span class="sxs-lookup"><span data-stu-id="339e9-259">Watch your use of resource types.</span></span>
- <span data-ttu-id="339e9-260">**監視第三方服務。**</span><span class="sxs-lookup"><span data-stu-id="339e9-260">**Monitor third-party services.**</span></span> <span data-ttu-id="339e9-261">記錄您的叫用作業，並使用唯一識別碼將其與您應用程式的健康情況和診斷記錄建立關聯。</span><span class="sxs-lookup"><span data-stu-id="339e9-261">Log your invocations and correlate them with your application's health and diagnostic logging using a unique identifier.</span></span>
- <span data-ttu-id="339e9-262">**訓練多個操作人員來監視應用程式並執行手動復原步驟。**</span><span class="sxs-lookup"><span data-stu-id="339e9-262">**Train multiple operators to monitor the application and to perform manual recovery steps.**</span></span> <span data-ttu-id="339e9-263">確保至少都有一個經過訓練的操作人員在工作崗位上。</span><span class="sxs-lookup"><span data-stu-id="339e9-263">Make sure there is always at least one trained operator active.</span></span>

<span data-ttu-id="339e9-264">如需有關監視應用程式可靠性的詳細資訊，請參閱[監視 Azure 應用程式健康情況](./monitoring.md)。</span><span class="sxs-lookup"><span data-stu-id="339e9-264">For more information about monitoring for application reliability, see [Monitoring Azure application health](./monitoring.md).</span></span>

## <a name="respond-to-failures-and-disasters"></a><span data-ttu-id="339e9-265">回應失敗和災害</span><span class="sxs-lookup"><span data-stu-id="339e9-265">Respond to failures and disasters</span></span>

<span data-ttu-id="339e9-266">建立復原計劃，並確定其涵蓋資料還原、網路中斷、相依服務失敗和全區域服務中斷。</span><span class="sxs-lookup"><span data-stu-id="339e9-266">Create a recovery plan, and make sure that it covers data restoration, network outages, dependent service failures, and region-wide service disruptions.</span></span> <span data-ttu-id="339e9-267">在您的復原策略中，請考量到 VM、儲存體、資料庫和其他 Azure 平台服務。</span><span class="sxs-lookup"><span data-stu-id="339e9-267">Consider your VMs, storage, databases, and other Azure platform services in your recovery strategy.</span></span>

- <span data-ttu-id="339e9-268">**Azure 支援互動的規劃。**</span><span class="sxs-lookup"><span data-stu-id="339e9-268">**Plan for Azure support interactions.**</span></span> <span data-ttu-id="339e9-269">在產生需求之前，建立連絡 Azure 支援服務的程序。</span><span class="sxs-lookup"><span data-stu-id="339e9-269">Before the need arises, establish a process for contacting Azure support.</span></span>
- <span data-ttu-id="339e9-270">**記錄並測試災害復原計畫。**</span><span class="sxs-lookup"><span data-stu-id="339e9-270">**Document and test your disaster recovery plan.**</span></span> <span data-ttu-id="339e9-271">撰寫災害復原計劃，以反映應用程式失敗的業務影響。</span><span class="sxs-lookup"><span data-stu-id="339e9-271">Write a disaster recovery plan that reflects the business impact of application failures.</span></span> <span data-ttu-id="339e9-272">盡量自動化多個復原程序，並記錄任何手動步驟。</span><span class="sxs-lookup"><span data-stu-id="339e9-272">Automate the recovery process as much as possible, and document any manual steps.</span></span> <span data-ttu-id="339e9-273">定期測試您的災害復原程序來驗證和改善計劃。</span><span class="sxs-lookup"><span data-stu-id="339e9-273">Regularly test your disaster recovery process to validate and improve the plan.</span></span>
- <span data-ttu-id="339e9-274">**必要時進行手動容錯移轉。**</span><span class="sxs-lookup"><span data-stu-id="339e9-274">**Fail over manually when required.**</span></span> <span data-ttu-id="339e9-275">某些系統無法自動容錯移轉，而需要手動容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="339e9-275">Some systems can't fail over automatically and require a manual failover.</span></span> <span data-ttu-id="339e9-276">如果應用程式容錯移轉到次要區域，請執行作業整備測試。</span><span class="sxs-lookup"><span data-stu-id="339e9-276">If an application fails over to a secondary region, perform an operational readiness test.</span></span> <span data-ttu-id="339e9-277">確認主要區域狀況良好，且可再次接收流量後，才能執行容錯回復。</span><span class="sxs-lookup"><span data-stu-id="339e9-277">Verify that the primary region is healthy and ready to receive traffic again before failing back.</span></span> <span data-ttu-id="339e9-278">判斷效能變差的應用程式功能是哪一個，以及應用程式會如何將暫時性問題告知使用者。</span><span class="sxs-lookup"><span data-stu-id="339e9-278">Determine what the reduced application functionality is and how the app informs users of temporary problems.</span></span>
- <span data-ttu-id="339e9-279">**針對應用程式失敗做好準備。**</span><span class="sxs-lookup"><span data-stu-id="339e9-279">**Prepare for application failure.**</span></span> <span data-ttu-id="339e9-280">針對一系列的失敗 (包括自動處理的錯誤) 做好準備，像是導致功能變差的失敗，以及造成應用程式無法使用的失敗。</span><span class="sxs-lookup"><span data-stu-id="339e9-280">Prepare for a range of failures, including faults that are handled automatically, those that result in reduced functionality, and those that cause the application to become unavailable.</span></span> <span data-ttu-id="339e9-281">應用程式應將暫時性問題告知使用者。</span><span class="sxs-lookup"><span data-stu-id="339e9-281">The application should inform users of temporary issues.</span></span>
- <span data-ttu-id="339e9-282">**從資料損毀中復原。**</span><span class="sxs-lookup"><span data-stu-id="339e9-282">**Recover from data corruption.**</span></span> <span data-ttu-id="339e9-283">如果資料存放區中發生失敗，當存放區再次可用時，檢查是否有資料不一致的情況，特別是在已複寫資料時。</span><span class="sxs-lookup"><span data-stu-id="339e9-283">If a failure happens in a data store, check for data inconsistencies when the store becomes available again, especially if the data was replicated.</span></span> <span data-ttu-id="339e9-284">從備份還原損毀的資料。</span><span class="sxs-lookup"><span data-stu-id="339e9-284">Restore corrupt data from a backup.</span></span>
- <span data-ttu-id="339e9-285">**從網路中斷中復原。**</span><span class="sxs-lookup"><span data-stu-id="339e9-285">**Recover from a network outage.**</span></span> <span data-ttu-id="339e9-286">您可以使用快取資料，在本機執行效能變差的應用程式功能。</span><span class="sxs-lookup"><span data-stu-id="339e9-286">You might be able to use cached data to run locally with reduced application functionality.</span></span> <span data-ttu-id="339e9-287">如果沒有快取資料，請考慮讓應用程式停機或容錯移轉至另一個區域。</span><span class="sxs-lookup"><span data-stu-id="339e9-287">If not, consider application downtime or fail over to another region.</span></span> <span data-ttu-id="339e9-288">將資料儲存在替代位置，直到恢復連線為止。</span><span class="sxs-lookup"><span data-stu-id="339e9-288">Store your data in an alternate location until connectivity is restored.</span></span>
- <span data-ttu-id="339e9-289">**從相依服務失敗中復原。**</span><span class="sxs-lookup"><span data-stu-id="339e9-289">**Recover from a dependent service failure.**</span></span> <span data-ttu-id="339e9-290">判斷哪些功能仍然可用，以及應用程式應該如何回應。</span><span class="sxs-lookup"><span data-stu-id="339e9-290">Determine which functionality is still available and how the application should respond.</span></span>
- <span data-ttu-id="339e9-291">**從全區域服務中斷復原。**</span><span class="sxs-lookup"><span data-stu-id="339e9-291">**Recover from a region-wide service disruption.**</span></span> <span data-ttu-id="339e9-292">全區域服務中斷的情況並不常見，但您應具備解決此問題的策略，特別是針對重要的應用程式。</span><span class="sxs-lookup"><span data-stu-id="339e9-292">Region-wide service disruptions are uncommon, but you should have a strategy to address them, especially for critical applications.</span></span> <span data-ttu-id="339e9-293">您可以將應用程式重新部署到另一個區域或轉散發流量。</span><span class="sxs-lookup"><span data-stu-id="339e9-293">You might be able to redeploy the application to another region or redistribute traffic.</span></span>

<span data-ttu-id="339e9-294">如需有關如何回應失敗和災害復原的詳細資訊，請參閱 [Azure 應用程式的失敗和災害復原](./disaster-recovery.md)。</span><span class="sxs-lookup"><span data-stu-id="339e9-294">For more information about responding to failures and disaster recovery, see [Failure and disaster recovery for Azure applications](./disaster-recovery.md).</span></span>

## <a name="next-steps"></a><span data-ttu-id="339e9-295">後續步驟</span><span class="sxs-lookup"><span data-stu-id="339e9-295">Next steps</span></span>

> [!div class="nextstepaction"]
> [<span data-ttu-id="339e9-296">開發可復原應用程式的需求</span><span class="sxs-lookup"><span data-stu-id="339e9-296">Develop requirements for resilient applications</span></span>](./requirements.md)
