# <a name="choosing-a-compute-option-for-microservices"></a><span data-ttu-id="d516d-101">選擇計算選項適用於微服務</span><span class="sxs-lookup"><span data-stu-id="d516d-101">Choosing a compute option for microservices</span></span>

<span data-ttu-id="d516d-102">*計算*一詞是指您的應用程式執行所在運算資源的裝載模型。</span><span class="sxs-lookup"><span data-stu-id="d516d-102">The term *compute* refers to the hosting model for the computing resources that your application runs on.</span></span> <span data-ttu-id="d516d-103">應用在微服務架構方面，有兩種非常熱門的方法：</span><span class="sxs-lookup"><span data-stu-id="d516d-103">For a microservices architecture, two approaches are especially popular:</span></span>

- <span data-ttu-id="d516d-104">服務協調器，可管理專用節點 (VM) 上所執行的服務。</span><span class="sxs-lookup"><span data-stu-id="d516d-104">A service orchestrator that manages services running on dedicated nodes (VMs).</span></span>
- <span data-ttu-id="d516d-105">使用「函式即服務」(FaaS) 的無伺服器架構。</span><span class="sxs-lookup"><span data-stu-id="d516d-105">A serverless architecture using functions as a service (FaaS).</span></span>

<span data-ttu-id="d516d-106">雖然這兩種方法並不是唯一的選項，卻是已獲證實可行的微服務建置方法。</span><span class="sxs-lookup"><span data-stu-id="d516d-106">While these aren't the only options, they are both proven approaches to building microservices.</span></span> <span data-ttu-id="d516d-107">應用程式可同時包含這兩種方法。</span><span class="sxs-lookup"><span data-stu-id="d516d-107">An application might include both approaches.</span></span>

## <a name="service-orchestrators"></a><span data-ttu-id="d516d-108">服務協調器</span><span class="sxs-lookup"><span data-stu-id="d516d-108">Service orchestrators</span></span>

<span data-ttu-id="d516d-109">協調器負責處理與一組服務的部署及管理有關的工作。</span><span class="sxs-lookup"><span data-stu-id="d516d-109">An orchestrator handles tasks related to deploying and managing a set of services.</span></span> <span data-ttu-id="d516d-110">這些工作包括在節點上放置服務、監視服務的健康情況、重新啟動狀況不良的服務、在服務執行個體間負載平衡網路流量、服務探索、調整服務執行個體數目，以及套用組態更新。</span><span class="sxs-lookup"><span data-stu-id="d516d-110">These tasks include placing services on nodes, monitoring the health of services, restarting unhealthy services, load balancing network traffic across service instances, service discovery, scaling the number of instances of a service, and applying configuration updates.</span></span> <span data-ttu-id="d516d-111">熱門協調器包括 Kubernetes、Service Fabric、DC/OS 和 Docker Swarm。</span><span class="sxs-lookup"><span data-stu-id="d516d-111">Popular orchestrators include Kubernetes, Service Fabric, DC/OS, and Docker Swarm.</span></span>

<span data-ttu-id="d516d-112">在 Azure 平台上，請考慮下列選項：</span><span class="sxs-lookup"><span data-stu-id="d516d-112">On the Azure platform, consider the following options:</span></span>

- <span data-ttu-id="d516d-113">[Azure Kubernetes Service](/azure/aks/) (AKS) 是受控 Kubernetes 服務。</span><span class="sxs-lookup"><span data-stu-id="d516d-113">[Azure Kubernetes Service](/azure/aks/) (AKS) is a managed Kubernetes service.</span></span> <span data-ttu-id="d516d-114">AKS 會佈建 Kubernetes 並公開 Kubernetes API 端點，但會裝載和管理 Kubernetes 控制平面，以便執行自動升級、自動修補、自動調整和其他管理工作。</span><span class="sxs-lookup"><span data-stu-id="d516d-114">AKS provisions Kubernetes and exposes the Kubernetes API endpoints, but hosts and manages the Kubernetes control plane, performing automated upgrades, automated patching, autoscaling, and other management tasks.</span></span> <span data-ttu-id="d516d-115">您可以將 AKS 視為「Kubernetes API 即服務」。</span><span class="sxs-lookup"><span data-stu-id="d516d-115">You can think of AKS as being "Kubernetes APIs as a service."</span></span>

- <span data-ttu-id="d516d-116">[Service Fabric](/azure/service-fabric/) 是一個分散式系統平台，可讓您封裝、部署及管理微服務。</span><span class="sxs-lookup"><span data-stu-id="d516d-116">[Service Fabric](/azure/service-fabric/) is a distributed systems platform for packaging, deploying, and managing microservices.</span></span> <span data-ttu-id="d516d-117">您可以將微服務部署至 Service Fabric，以作為容器、二進位可執行檔或作為 [Reliable Services](/azure/service-fabric/service-fabric-reliable-services-introduction)。</span><span class="sxs-lookup"><span data-stu-id="d516d-117">Microservices can be deployed to Service Fabric as containers, as binary executables, or as [Reliable Services](/azure/service-fabric/service-fabric-reliable-services-introduction).</span></span> <span data-ttu-id="d516d-118">使用 Reliable Services 程式設計模型，服務便可直接使用 Service Fabric 程式設計 API 來查詢系統、回報健康情況、接收有關組態和程式碼變更的通知，並探索其他服務。</span><span class="sxs-lookup"><span data-stu-id="d516d-118">Using the Reliable Services programming model, services can directly use Service Fabric programming APIs to query the system, report health, receive notifications about configuration and code changes, and discover other services.</span></span> <span data-ttu-id="d516d-119">與 Service Fabric 的主要差異在於，其非常著重在使用 [Reliable Collections](/azure/service-fabric/service-fabric-reliable-services-reliable-collections) 來建置具狀態服務。</span><span class="sxs-lookup"><span data-stu-id="d516d-119">A key differentiation with Service Fabric is its strong focus on building stateful services using [Reliable Collections](/azure/service-fabric/service-fabric-reliable-services-reliable-collections).</span></span>

- <span data-ttu-id="d516d-120">其他選項，例如 Docker Enterprise Edition 和 Mesosphere DC/OS 可以在 Azure 上執行 IaaS 環境中。</span><span class="sxs-lookup"><span data-stu-id="d516d-120">Other options such as Docker Enterprise Edition and Mesosphere DC/OS can run in an IaaS environment on Azure.</span></span> <span data-ttu-id="d516d-121">您可以找到部署範本[Azure Marketplace](https://azuremarketplace.microsoft.com)。</span><span class="sxs-lookup"><span data-stu-id="d516d-121">You can find deployment templates on [Azure Marketplace](https://azuremarketplace.microsoft.com).</span></span>

## <a name="containers"></a><span data-ttu-id="d516d-122">容器</span><span class="sxs-lookup"><span data-stu-id="d516d-122">Containers</span></span>

<span data-ttu-id="d516d-123">有時候人們會將容器和微服務看作是一樣的東西。</span><span class="sxs-lookup"><span data-stu-id="d516d-123">Sometimes people talk about containers and microservices as if they were the same thing.</span></span> <span data-ttu-id="d516d-124">雖然事實並非如此 (不需要容器就能建置微服務)，但容器的確具有和微服務極其相關的一些優點，例如：</span><span class="sxs-lookup"><span data-stu-id="d516d-124">While that's not true &mdash; you don't need containers to build microservices &mdash; containers do have some benefits that are particularly relevant to microservices, such as:</span></span>

- <span data-ttu-id="d516d-125">**可攜性**。</span><span class="sxs-lookup"><span data-stu-id="d516d-125">**Portability**.</span></span> <span data-ttu-id="d516d-126">容器映像是不需要安裝程式庫或其他相依性就能執行的獨立套件。</span><span class="sxs-lookup"><span data-stu-id="d516d-126">A container image is a standalone package that runs without needing to install libraries or other dependencies.</span></span> <span data-ttu-id="d516d-127">這項特性使其部署作業變得簡單。</span><span class="sxs-lookup"><span data-stu-id="d516d-127">That makes them easy to deploy.</span></span> <span data-ttu-id="d516d-128">容器可以快速加以啟動和停止，因此您可以啟動新的執行個體，以處理更多負載或是從節點失敗中復原。</span><span class="sxs-lookup"><span data-stu-id="d516d-128">Containers can be started and stopped quickly, so you can spin up new instances to handle more load or to recover from node failures.</span></span>

- <span data-ttu-id="d516d-129">**密度**.</span><span class="sxs-lookup"><span data-stu-id="d516d-129">**Density**.</span></span> <span data-ttu-id="d516d-130">相較於執行虛擬機器，容器因為會共用作業系統資源，因此所需資源不多。</span><span class="sxs-lookup"><span data-stu-id="d516d-130">Containers are lightweight compared with running a virtual machine, because they share OS resources.</span></span> <span data-ttu-id="d516d-131">這項特性讓我們可以將多個容器封裝至單一節點，而這個能力在應用程式包含許多小型服務時會特別有用。</span><span class="sxs-lookup"><span data-stu-id="d516d-131">That makes it possible to pack multiple containers onto a single node, which is especially useful when the application consists of many small services.</span></span>

- <span data-ttu-id="d516d-132">**資源隔離**.</span><span class="sxs-lookup"><span data-stu-id="d516d-132">**Resource isolation**.</span></span> <span data-ttu-id="d516d-133">您可以限制容器可以使用的記憶體和 CPU 數量，這可協助確保失控程序不會耗盡主機資源。</span><span class="sxs-lookup"><span data-stu-id="d516d-133">You can limit the amount of memory and CPU that is available to a container, which can help to ensure that a runaway process doesn't exhaust the host resources.</span></span> <span data-ttu-id="d516d-134">如需詳細資訊，請參閱[隔艙模式](../../patterns/bulkhead.md)。</span><span class="sxs-lookup"><span data-stu-id="d516d-134">See the [Bulkhead pattern](../../patterns/bulkhead.md) for more information.</span></span>

## <a name="serverless-functions-as-a-service"></a><span data-ttu-id="d516d-135">無伺服器 (函式即服務)</span><span class="sxs-lookup"><span data-stu-id="d516d-135">Serverless (Functions as a Service)</span></span>

<span data-ttu-id="d516d-136">使用[無伺服器](https://azure.microsoft.com/solutions/serverless/)架構時，您不需管理 VM 或虛擬網路基礎結構。</span><span class="sxs-lookup"><span data-stu-id="d516d-136">With a [serverless](https://azure.microsoft.com/solutions/serverless/) architecture, you don't manage the VMs or the virtual network infrastructure.</span></span> <span data-ttu-id="d516d-137">相反地，您會部署程式碼，而主機服務則負責將該程式碼放到 VM 並加以執行。</span><span class="sxs-lookup"><span data-stu-id="d516d-137">Instead, you deploy code and the hosting service handles putting that code onto a VM and executing it.</span></span> <span data-ttu-id="d516d-138">這種方法往往會偏好使用以事件型觸發程序來進行協調的小型函式。</span><span class="sxs-lookup"><span data-stu-id="d516d-138">This approach tends to favor small granular functions that are coordinated using event-based triggers.</span></span> <span data-ttu-id="d516d-139">例如，放到佇列的訊息可能會觸發函式，以讀取佇列並處理訊息。</span><span class="sxs-lookup"><span data-stu-id="d516d-139">For example, a message being placed onto a queue might trigger a function that reads from the queue and processes the message.</span></span>

<span data-ttu-id="d516d-140">[Azure Functions](/azure/azure-functions/)是無伺服器計算服務，可支援各種函式觸發程序，包括 HTTP 要求、 服務匯流排佇列和事件中樞事件。</span><span class="sxs-lookup"><span data-stu-id="d516d-140">[Azure Functions](/azure/azure-functions/) is a serverless compute service that supports various function triggers, including HTTP requests, Service Bus queues, and Event Hubs events.</span></span> <span data-ttu-id="d516d-141">如需完整清單，請參閱 < [Azure Functions 觸發程序和繫結概念](/azure/azure-functions/functions-triggers-bindings)。</span><span class="sxs-lookup"><span data-stu-id="d516d-141">For a complete list, see [Azure Functions triggers and bindings concepts](/azure/azure-functions/functions-triggers-bindings).</span></span> <span data-ttu-id="d516d-142">也請考慮[Azure Event Grid](/azure/event-grid/)，這是在 Azure 中的受控的事件路由服務。</span><span class="sxs-lookup"><span data-stu-id="d516d-142">Also consider [Azure Event Grid](/azure/event-grid/), which is a managed event routing service in Azure.</span></span>

<!-- markdownlint-disable MD026 -->

## <a name="orchestrator-or-serverless"></a><span data-ttu-id="d516d-143">該選擇協調器還是無伺服器？</span><span class="sxs-lookup"><span data-stu-id="d516d-143">Orchestrator or serverless?</span></span>

<!-- markdownlint-enable MD026 -->

<span data-ttu-id="d516d-144">以下是在協調器方法與無伺服器方法之間做選擇時所要考慮的部分因素。</span><span class="sxs-lookup"><span data-stu-id="d516d-144">Here are some factors to consider when choosing between an orchestrator approach and a serverless approach.</span></span>

<span data-ttu-id="d516d-145">**管理性**。無伺服器應用程式管理容易，因為該平台會為您管理所有的計算資源。</span><span class="sxs-lookup"><span data-stu-id="d516d-145">**Manageability** A serverless application is easy to manage, because the platform manages all the of compute resources for you.</span></span> <span data-ttu-id="d516d-146">雖然協調器會抽走某些叢集管理和設定工作，但它不會完全掩蓋掉基礎 VM。</span><span class="sxs-lookup"><span data-stu-id="d516d-146">While an orchestrator abstracts some aspects of managing and configuring a cluster, it does not completely hide the underlying VMs.</span></span> <span data-ttu-id="d516d-147">使用協調器時，您必須考慮到負載平衡、CPU、記憶體使用量和網路等問題。</span><span class="sxs-lookup"><span data-stu-id="d516d-147">With an orchestrator, you will need to think about issues such as load balancing, CPU and memory usage, and networking.</span></span>

<span data-ttu-id="d516d-148">**彈性和控制**。</span><span class="sxs-lookup"><span data-stu-id="d516d-148">**Flexibility and control**.</span></span> <span data-ttu-id="d516d-149">協調器可讓您極大程度地控制服務和叢集的設定及管理功能。</span><span class="sxs-lookup"><span data-stu-id="d516d-149">An orchestrator gives you a great deal of control over configuring and managing your services and the cluster.</span></span> <span data-ttu-id="d516d-150">代價是複雜性會提高。</span><span class="sxs-lookup"><span data-stu-id="d516d-150">The tradeoff is additional complexity.</span></span> <span data-ttu-id="d516d-151">若使用無伺服器架構，您則要放棄某種程度的控制能力，因為這些詳細資料會被抽離。</span><span class="sxs-lookup"><span data-stu-id="d516d-151">With a serverless architecture, you give up some degree of control because these details are abstracted.</span></span>

<span data-ttu-id="d516d-152">**可攜性**。</span><span class="sxs-lookup"><span data-stu-id="d516d-152">**Portability**.</span></span> <span data-ttu-id="d516d-153">此處所列的所有協調器 (Kubernetes、DC/OS、Docker Swarm 和 Service Fabric) 可在內部部署環境執行，也可以在多個公用雲端中執行。</span><span class="sxs-lookup"><span data-stu-id="d516d-153">All of the orchestrators listed here (Kubernetes, DC/OS, Docker Swarm, and Service Fabric) can run on-premises or in multiple public clouds.</span></span>

<span data-ttu-id="d516d-154">**應用程式整合**.</span><span class="sxs-lookup"><span data-stu-id="d516d-154">**Application integration**.</span></span> <span data-ttu-id="d516d-155">使用無伺服器架構來建置複雜的應用程式並不是件容易的事。</span><span class="sxs-lookup"><span data-stu-id="d516d-155">It can be challenging to build a complex application using a serverless architecture.</span></span> <span data-ttu-id="d516d-156">在 Azure 中進行此作業的其中一個方法是使用 [Azure Logic Apps](/azure/logic-apps/) 來協調一組 Azure Functions。</span><span class="sxs-lookup"><span data-stu-id="d516d-156">One option in Azure is to use [Azure Logic Apps](/azure/logic-apps/) to coordinate a set of Azure Functions.</span></span> <span data-ttu-id="d516d-157">如需此方法的範例，請參閱[建立與 Azure Logic Apps 整合的函式](/azure/azure-functions/functions-twitter-email)。</span><span class="sxs-lookup"><span data-stu-id="d516d-157">For an example of this approach, see [Create a function that integrates with Azure Logic Apps](/azure/azure-functions/functions-twitter-email).</span></span>

<span data-ttu-id="d516d-158">**成本**。</span><span class="sxs-lookup"><span data-stu-id="d516d-158">**Cost**.</span></span> <span data-ttu-id="d516d-159">使用協調器時，您需要為叢集中正在執行的 VM 支付費用。</span><span class="sxs-lookup"><span data-stu-id="d516d-159">With an orchestrator, you pay for the VMs that are running in the cluster.</span></span> <span data-ttu-id="d516d-160">使用無伺服器應用程式時，則只需為實際耗用的計算資源支付費用。</span><span class="sxs-lookup"><span data-stu-id="d516d-160">With a serverless application, you pay only for the actual compute resources consumed.</span></span> <span data-ttu-id="d516d-161">在這兩種情況中，您都需要考量任何其他服務 (例如，儲存體、資料庫和傳訊服務) 的成本。</span><span class="sxs-lookup"><span data-stu-id="d516d-161">In both cases, you need to factor in the cost of any additional services, such as storage, databases, and messaging services.</span></span>

<span data-ttu-id="d516d-162">**延展性**。</span><span class="sxs-lookup"><span data-stu-id="d516d-162">**Scalability**.</span></span> <span data-ttu-id="d516d-163">Azure Functions 會根據內送事件數量自動進行調整，以符合需求。</span><span class="sxs-lookup"><span data-stu-id="d516d-163">Azure Functions scales automatically to meet demand, based on the number of incoming events.</span></span> <span data-ttu-id="d516d-164">使用協調器時，您可以透過增加叢集中執行的服務執行個體數目，來進行相應放大。</span><span class="sxs-lookup"><span data-stu-id="d516d-164">With an orchestrator, you can scale out by increasing the number of service instances running in the cluster.</span></span> <span data-ttu-id="d516d-165">您也可以透過對叢集新增額外的 VM 來進行調整。</span><span class="sxs-lookup"><span data-stu-id="d516d-165">You can also scale by adding additional VMs to the cluster.</span></span>

<span data-ttu-id="d516d-166">我們的參考實作主要是使用 Kubernetes，但我們也的確有對某項服務 (也就是遞送記錄服務) 使用 Azure Functions。</span><span class="sxs-lookup"><span data-stu-id="d516d-166">Our reference implementation primarily uses Kubernetes, but we did use Azure Functions for one service, namely the Delivery History service.</span></span> <span data-ttu-id="d516d-167">Azure Functions 非常適合用於此特定服務，因為它是事件驅動的工作負載。</span><span class="sxs-lookup"><span data-stu-id="d516d-167">Azure Functions was a good fit for this particular service, because it's is an event-driven workload.</span></span> <span data-ttu-id="d516d-168">藉由使用事件中樞觸發程序來叫用函式，服務所需的程式碼數量已降至最低。</span><span class="sxs-lookup"><span data-stu-id="d516d-168">By using an Event Hubs trigger to invoke the function, the service needed a minimal amount of code.</span></span> <span data-ttu-id="d516d-169">此外，遞送記錄服務並非主要工作流程的一部分，因此在 Kubernetes 叢集之外執行此服務並不會影響使用者所起始之作業的端對端延遲。</span><span class="sxs-lookup"><span data-stu-id="d516d-169">Also, the Delivery History service is not part of the main workflow, so running it outside of the Kubernetes cluster doesn't affect the end-to-end latency of user-initiated operations.</span></span>

## <a name="next-steps"></a><span data-ttu-id="d516d-170">後續步驟</span><span class="sxs-lookup"><span data-stu-id="d516d-170">Next steps</span></span>

> [!div class="nextstepaction"]
> [<span data-ttu-id="d516d-171">服務間通訊</span><span class="sxs-lookup"><span data-stu-id="d516d-171">Interservice communication</span></span>](./interservice-communication.md)
