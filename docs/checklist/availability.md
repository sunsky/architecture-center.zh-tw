---
title: 可用性檢查清單
description: 提供設計期間可用性考量指引的檢查清單。
author: dragon119
ms.date: 01/10/2018
ms.custom: checklist
ms.openlocfilehash: a09a8f77865bf127ae0a73e0da7e1d3fb8508826
ms.sourcegitcommit: fdcacbfdc77370532a4dde776c5d9b82227dff2d
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/24/2018
ms.locfileid: "49962886"
---
# <a name="availability-checklist"></a>可用性檢查清單

可用性是指系統可正常運作的時間比例，且是[軟體品質要素](../guide/pillars.md)的其中一項。 請使用此檢查清單，從可用性的觀點來檢閱您的應用程式架構。 

## <a name="application-design"></a>應用程式設計

**請避免單一失敗點。** 為避免單一失敗點影響可用性，應該將所有的元件、服務、資源和計算執行個體部署為多個執行個體。 這包括驗證機制。 將應用程式設計為可以設定使用多個執行個體，自動偵測失敗，並將要求重新導向至非失敗的執行個體 (平台並不會在其中自動執行此動作)。

**根據服務層級目標來分解工作負載。** 如果服務由重要和比較不重要的工作負載組成，請以不同的方式加以管理，並指定服務功能及執行個體數目，以符合其可用性需求。

**最小化和了解服務相依性。** 盡可能將使用過的不同服務數目降到最低，並確定您了解所有存在於系統中的功能和服務相依性。 這包括這些相依性的本質、失敗的影響，或整體應用程式上每個服務減少的效能。

**盡可能將工作和訊息設計成具有等冪性**。 若作業可以多次重複並產生相同的結果，則作業具有等冪性。 等冪性可以確保重複的要求不會造成問題。 訊息取用者與其執行的作業應該具有等冪性，這樣重複先前執行過的作業才不會使結果無效。 這可能表示偵測重複訊息，或是使用開放式的方法來處理衝突，以確保一致性。

**使用可實作重要交易之高可用性的訊息代理人。** 許多雲端應用程式會使用傳訊來起始以非同步方式執行的工作。 若要保證訊息的傳遞，傳訊系統應該提供高可用性。 [Azure 服務匯流排傳訊](/azure/service-bus-messaging)會實作「至少一次」語意。 這表示雖然在某些情況下可能會傳送複本，但張貼到佇列的訊息不會遺失。 如果訊息處理是等冪 (請參閱上一個項目)，重複傳遞應該不是問題。

**設計可依正常程序降級的應用程式。** 應用程式上的負載可能會超出其中一或多個組件的容量，而導致可用性降低和連線失敗。 縮放比例有助於減輕這點，但是它可能會到達資源可用性或成本等其他因素所加諸的限制。 應用程式達到資源限制時，應該採取適當的動作，將對於使用者的影響降到最低。 例如，在電子商務系統中，若訂單處理子系統處於疲勞狀態或失敗，可以暫時將其停用，同時允許其他功能 (例如瀏覽產品目錄) 繼續運作。 適當作法是延後對失敗子系統的要求，例如讓客戶可以提交訂單，但是將訂單儲存以供訂單子系統稍後再次可用時加以處理。

**適當處理急促高載事件。** 大部分的應用程式所需要處理的工作負載，會隨著時間而有所不同。 自動調整有助於處理負載，但是它可能需要一些時間，讓其他執行個體上線並處理要求。 防止突然和非預期的活動高載導致超出應用程式的處理能力：將應用程式設計為將要求加入其使用之服務的佇列，並在佇列接近完整容量時適當降級。 請確定有足夠的效能和容量可供非高載條件清空佇列和處理未完成的要求。 如需詳細資訊，請參閱 [佇列型負載調節模式](https://msdn.microsoft.com/library/dn589783.aspx)。

## <a name="deployment-and-maintenance"></a>部署和維護

**部署多個服務執行個體。** 如果您的應用程式相依於服務的單一執行個體，它會建立單一失敗點。 佈建多個執行個體，可改善復原能力和延展性。 對於 [Azure App Service](/azure/app-service/app-service-value-prop-what-is/)，選取可提供多個執行個體的 [App Service 方案](/azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview/)。 對於 Azure 雲端服務，設定您的每個角色以使用[多個執行個體](/azure/cloud-services/cloud-services-choose-me/#scaling-and-management)。 對於 [Azure 虛擬機器 (VM)](/azure/virtual-machines/virtual-machines-windows-about/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)，確保 VM 架構包含多個 VM，而且每個 VM 都包含在[可用性設定組][availability-sets]中。

**請考慮在多個區域中部署您的應用程式。** 如果您的應用程式已部署到單一區域，在少數情況下，整個區域會變得無法使用，您的應用程式也將無法使用。 您應用程式的 SLA 條款可能無法接受這種情況。 若是如此，請考慮在多個區域中部署您的應用程式及其服務。

**自動化和測試部署和維護工作**。 分散式應用程式由多個必須相互合作的部分所組成。 部署應該使用經過測試和實證的機制 (例如指令碼) 來加以自動化。 它們可以更新和驗證組態，並自動化部署程序。 使用 [Azure Resource Manager 範本](/azure/azure-resource-manager/resource-group-authoring-templates)來佈建 Azure 資源。 也請使用自動化技術來執行應用程式更新。 請務必完整測試所有程序，以確保錯誤不會造成其他停機情況。 所有的部署工具必須有適當的安全性限制，來保護已部署的應用程式。仔細定義和強制執行部署原則並將人為介入的需要降到最低。

**使用平台的暫存和實際執行功能。** 例如，Azure App Service 可支援[部署位置](/azure/app-service/web-sites-staged-publishing)，可讓您在切換到生產環境之前用以暫存部署。 Azure Service Fabric 可支援應用程式服務的[輪流升級](/azure/service-fabric/service-fabric-application-upgrade)。

**將虛擬機器 (VM) 放入可用性設定組中。** 若要將可用性最大化，請為每個虛擬機器角色建立多個執行個體，並將這些執行個體放在相同的可用性設定組中。 若您有多部虛擬機器扮演不同的角色 (例如不同的應用程式層)，請為每個虛擬機器角色建立一個可用性設定組。 例如，為 Web 層建立一個可用性設定組，並為資料層建立另一個可用性設定組。

## <a name="data-management"></a>資料管理

**Azure 儲存體中的異地複寫資料**。 Azure 儲存體中的資料會在資料中心內自動複製。 如需更高的可用性，請使用讀取權限異地備援儲存體 (-RAGRS)，它會將您的資料複寫到次要區域，並提供次要區域中資料的唯讀權限。 即使發生全面性區域中斷或災害，資料仍具持久性。 如需詳細資訊，請參閱 [Azure 儲存體複寫](/azure/storage/storage-redundancy)。

**異地複寫資料庫**。 Azure SQL Database 和 Cosmos DB 都支援異地複寫，可讓您在其他區域設定次要資料庫複本。 在資料中心中斷或在無法連線至主要資料庫的情況下，便可使用次要資料庫進行查詢和容錯移轉。 如需詳細資訊，請參閱[容錯移轉群組和主動式異地複寫](/azure/sql-database/sql-database-geo-replication-overview) (SQL Database) 和[如何使用 Azure Cosmos DB 全域散發資料](/azure/cosmos-db/distribute-data-globally)。

**使用開放式並行存取和最終一致性**。 透過鎖定 (封閉式並行存取) 封鎖資源存取權的交易可能會造成效能不佳，並且大幅降低可用性。 這些問題在分散式系統中可能會變得特別嚴重。 在許多情況下，謹慎的設計和技術 (例如資料分割) 可以將發生更新衝突的機會降至最低。 只有在資料被複寫，或從個別更新存放區讀取時，資料才會達到最終的一致。 但優點通常會遠遠超越對使用交易來確保立即一致性的可用性影響。

**使用定期備份和時間點還原**。 定期自動備份未保留在其他位置的資料，並確認您可以在失敗發生時，可靠地還原資料和應用程式本身。 請確保備份符合您的復原點目標 (RPO)。 資料複寫不是備份功能，因為人為錯誤或惡意作業都可能會損毀所有複本上的資料。 備份程序必須是安全的，才能保護傳輸和儲存體中的資料。 資料庫或部分的資料存放區通常可以使用交易紀錄檔復原至先前的時間點。 如需詳細資訊，請參閱[從資料損毀或意外刪除復原](../resiliency/recovery-data-corruption.md)

## <a name="errors-and-failures"></a>錯誤和失敗

**設定要求逾時。** 服務和資源可能會變成無法使用，導致要求失敗。 請確定您所套用的逾時都適用於每個服務或資源，以及存取它們的用戶端。 在某些情況下，您可能會允許用戶端的特定執行個體有較長的逾時，取決於用戶端所執行的內容和其他動作。 非常短的逾時可能會對具有大量延遲的服務及資源造成過多的重試作業。 如果大量的要求排入佇列，非常長的逾時可已造成封鎖，等待服務或資源回應。

**重試暫時性錯誤所造成的失敗作業。** 設計存取所有服務和資源的重試策略，因為它們原本不支援自動連線重試。 使用策略包含在重試之間增加的延遲，做為失敗增加的數目，以避免資源的多載，並允許它適當地復原並處理排入佇列的要求。 具有非常短的延遲的持續重試很可能會使問題惡化。 如需詳細資訊，請參閱[特定服務的重試指引](../best-practices/retry-service-specific.md)。

**實作斷路以避免連鎖性失敗。** 可能有一些情況中，暫時性或其他錯誤 (嚴重性範圍從部分的連線中斷到服務的完全失敗) 會花費比預期還長的時間才能返回正常狀態。 ，若服務非常忙碌，系統中某部分的失敗可能會導致連鎖性失敗，而造成許多作業在保存重要的系統資源 (例如記憶體、執行緒和資料庫連接) 時遭到封鎖。 應用程式不會持續重試不太可能成功的作業，而是應該快速接受作業已失敗，且適當地處理這項失敗。 請使用斷路器模式來拒絕在定義期間的特定作業要求。 如需詳細資訊，請參閱[斷路器模式](../patterns/circuit-breaker.md)。

**撰寫或切換回多個元件。** 設計應用程式來使用多個執行個體，而不影響作業和現有的連線。 使用多個執行個體並分散它們之間的要求，偵測並避免傳送要求給失敗的執行個體，藉以最大化可用性。

**切換回不同的服務或工作流程。** 例如，如果寫入至 SQL Database 失敗，請暫時將資料儲存在 Blob 儲存體或 Redis 快取中。 服務可供使用時，請提供重新執行寫入至 SQL Database 的功能。 在某些情況下，失敗的作業可能會有替代動作，允許應用程式繼續運作，甚至是當元件或服務失敗時也可繼續運作。 盡可能偵測失敗並將要求重新導向至其他可提供適當替代功能的服務，或者在主要服務離線時，備分或減少可維護核心作業的功能執行個體。

## <a name="monitoring-and-disaster-recovery"></a>監視和災害復原

**為可能的失敗和失敗事件提供豐富的檢測** 以將情況回報給操作人員。 為可能但尚未發生的失敗提供足夠的資料，以便作業人員判斷其原因，緩和情況，並確保系統仍然可用。 對於已經發生的失敗，應用程式應該將適當的錯誤訊息傳回給使用者，雖然功能減少了，但仍嘗試繼續執行。 在所有情況下，監視系統應該擷取完整的詳細資料，以便作業人員達成快速復原，並視需要讓設計人員和開發人員修改系統，以防止再次發生這個情況。

**實作檢查函數來監視系統健全狀況。** 應用程式的健全狀況和效能可能會在不同時間產生不明顯的降級，直到失敗為止。 實作探查或檢查定期從應用程式外部執行的函數。 這些檢查和測量整體應用程式、應用程式的個別部分、應用程式使用的個別服務、和個別元件的回應時間一樣簡單。 檢查函數可以執行程序，以確保它們會產生有效的結果、測量延遲及檢查可用性，並從系統中擷取資訊。

**定期測試所有容錯移轉和後援系統。** 系統與作業的變更可能會影響容錯移轉和後援函數，但是在主要系統失敗或負載過重之前可能都無法偵測到影響。 在執行階段中必須彌補即時問題之前加以測試。

**測試監視系統。** 自動化的容錯移轉和後援系統，以及使用儀表板手動進行系統健全狀況和效能視覺化，都取決於正常運作的監視和檢測。 如果這些項目失敗，遺漏重要資訊或回報不正確的資料，操作人員可能不知道系統是狀況不良還是失敗。

**追蹤長時間執行之工作流程的進度，並在失敗時重試。** 長時間執行的工作流程通常以多個步驟組成。 請確定每個步驟都是獨立且可以重試的，以將整個工作流程都必須回復的機會，或必須執行多個補償交易的機會降到最低。 藉由實作模式 (例如 [排程器代理程式監督員模式](../patterns/scheduler-agent-supervisor.md)) 監視並管理長時間執行之工作流程的進度。

**規劃災害復原。** 建立從可能影響系統可用性的任何類型失敗復原的可接受、經完整測試的方案。 選擇任何關鍵任務應用程式的多站台災害復原架構。 識別災害復原方案的特定擁有者，包括自動化和測試。 確保方案完善記載，並盡可能讓程序自動化。 為所有參考和交易資料建立備份策略，然後定期測試這些備份的還原。 訓練作業人員執行方案，並執行常態性災害模擬，以驗證並改善方案。

<!-- links -->
[availability-sets]:/azure/virtual-machines/virtual-machines-windows-manage-availability/
