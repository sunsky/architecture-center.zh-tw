# <a name="devops-checklist"></a>DevOps 檢查清單

DevOps 是一種整合，將開發、品質保證和 IT 營運整合至統一的文化特性和一組處理程序，以傳遞軟體。 使用此檢查清單作為起點，來評估您的 DevOps 文化特性和程序。

## <a name="culture"></a>文化特性

**確保業務跨組織和小組保持一致。** 組織內資源、目的、目標和優先順序的衝突對於作業成功是風險。 確保業務、開發和作業小組保持一致。

**確定整個小組了解軟體生命週期。** 您的小組必須了解應用程式的整體生命週期，以及應用程式目前在生命週期的哪個部分。 這有助於所有小組成員知道他們現在應該做什麼，以及未來應該規劃及準備什麼。

**減少週期時間。** 目的是將從構想到可用開發軟體所花費的時間降至最低。 限制個別版本的大小和範圍，以壓低測試負擔。 盡可能自動化建置、測試、設定和部署程序。 清除開發人員彼此之間和開發人員與作業之間通訊的任何障礙。 

**檢閱和改善處理程序。** 您的處理程序和程序，不論是自動化或是手動，都不是最後一個項目。 設定目前工作流程、程序和文件的定期檢閱，目標是持續改進。

**進行主動式規劃。** 針對失敗的主動式規劃。 讓處理程序就位以在問題發生時快速識別，呈報至修正小組成員以修正及確認解決。

**從失敗中學習。** 失敗在所難免，但是請務必從失敗中學習以避免重複這些失敗。 如果發生操作失敗，將問題分級、記錄原因和解決方案，並且共用從中汲取的經驗。 如果可能，請更新您的建置程序以在未來自動偵測這種失敗。

**針對速度和收集資料最佳化。** 每個規劃的改善都是假設。 盡可能使用最小的增量。 將新概念視為實驗。 檢測實驗，以便收集生產資料來評估其有效性。 準備好在假設錯誤時快速失敗。

**允許學習的時間。** 失敗和成功都提供了學習的良好機會。 前進到新的專案之前，允許足夠的時間來蒐集重要的課程，並確定這些課程會被您的小組吸收。 同時給予小組建置技術、實驗以及學習新工具和技術的時間。 

**記錄作業。** 記錄與您的產品程式碼相同品質等級的所有工具、處理程序和自動化工作。 記錄您支援之任何系統的目前設計和架構，以及復原處理程序和其他維護程序。 專注於您實際執行的步驟，而不是理論上的最佳處理程序。 定期檢閱並更新文件。 針對程式碼，請確定有意義的註解會包含在內，尤其是在公用 API 中，並且盡可能使用工具來自動產生程式碼文件。 

**共用知識。** 只有在人們知道其存在且找得到時，文件才有用。 請確定文件已經過組織且可輕易地探索。 有創意：使用牛皮紙袋 (非正式簡報)、影片或電子報來共用知識。

## <a name="development"></a>開發

**提供開發人員類似生產的環境。** 如果開發和測試環境不符合生產環境，就難以測試和診斷問題。 因此，讓開發和測試環境盡可能接近生產環境。 請確定測試資料與生產中使用的資料一致，即使它是範例資料且並非真正的生產資料 (基於隱私或相容性理由)。 計劃產生並匿名範例測試資料。

**確定所有授權的小組成員可以佈建基礎結構，以及部署應用程式。** 設定類似生產的資源和部署應用程式，應該不涉及複雜的手動工作或系統的詳細技術知識。 具備正確權限的任何人都應該能夠建立或部署類似生產的資源，而不需要作業小組。 

> 這項建議並非表示任何人都可以將即時更新推送到生產部署。 它是關於減少開發和 QA 小組的摩擦以建立類似生產的環境。

**檢測應用程式以深入解析。** 若要了解您的應用程式的健康情況，您必須知道它如何執行，以及它是否經歷任何錯誤或問題。 永遠納入檢測作為設計需求，並且從頭開始就將檢測建置到應用程式中。 檢測必須包含根本原因分析的事件記錄，也必須包含遙測和計量以監視應用程式的整體健康情況和使用方式。

**追蹤您的技術債務。** 在許多專案中，發行排程的優先順序某種程度上高於程式碼品質。 當發生這種情況時，請務必保持追蹤。 記錄任何捷徑或其他非最佳的實作，並且排程未來的時間以再次瀏覽這些問題。

**請考慮將更新直接推送到生產。** 若要減少整體發行週期時間，請考慮將測試完成的程式碼認可直接推送到生產。 使用[功能切換][feature-toggles]以控制要啟用哪些功能。 這可讓您快速地從開發移至發行，使用切換來啟用或停用功能。 當執行例如 [Canary 版本][canary-release]的測試時，切換也很有用，其中特定的功能會部署至生產環境的子集。

## <a name="testing"></a>測試

**自動化測試。** 手動測試軟體相當乏味且容易發生錯誤。 自動化一般測試工作，並將測試整合到您的建置程序。 自動化的測試可確保一致的測試涵蓋範圍和重現性。 整合式 UI 測試也應該由自動化工具執行。 Azure 提供開發與測試資源，可協助您設定和執行測試。 如需詳細資訊，請參閱[開發與測試][dev-test]。

**針對失敗的測試。** 如果系統無法連線到服務，它要如何回應？ 一旦服務再次可供使用，它是否可以復原？ 讓錯誤插入測試成為測試和預備環境上檢閱的標準部分。 當您的測試程序和做法成熟時，請考慮在生產環境中執行這些測試。 

**在生產環境中測試。** 發行程序不會隨著部署至生產環境而結束。 讓測試就位以確保已部署的程式碼如預期般運作。 對於不常更新的部署，將生產測試排程為定期維護。

**自動化效能測試以及早識別效能問題。** 嚴重效能問題的影響就像程式碼中的錯誤一樣嚴重。 雖然自動化功能測試可以防止應用程式錯誤，但是它們可能無法偵測效能問題。 為計量 (例如延遲、載入時間和資源使用方式) 定義可接受的效能目標。 在您的發行管線中包含自動化效能測試，以確定應用程式符合這些目標。

**執行容量測試。** 應用程式在測試條件下可能會正常運作，然後在生產環境中因為範圍或資源限制而發生問題。 一律定義最大預期容量和使用方式限制。 測試以確保應用程式可以處理這些限制，同時測試當超過這些限制時會發生什麼事。 容量測試應該定期執行。

初始發行之後，您應該在每次對生產環境程式碼進行更新時，執行效能和容量測試。 使用歷程記錄資料來微調測試，並判斷需要執行的測試類型。

**執行自動化安全性滲透測試。** 確保您的應用程式安全，與測試任何其他功能同等重要。 讓自動化滲透測試成為建置和部署程序的標準部分。 在已部署應用程式上排程定期安全性測試和弱點掃描，以監視開啟連接埠、端點和攻擊。 自動化的測試不會移除定期需要深入安全性檢閱的需求。

**執行自動化商務持續性測試。** 大規模商務持續性的開發測試，包括備份復原和容錯移轉。 設定自動化的程序，以定期執行這些測試。

## <a name="release"></a>版本

**自動化部署。** 自動化將應用程式部署至測試、預備及生產環境。 自動化可讓部署更快速且更可靠，並確保對任何支援環境的一致部署。 它會移除手動部署所造成之人為錯誤的風險。 它也可以輕鬆排程在方便的時間發行，以將可能停機的任何影響降至最低。

**使用持續整合。** 持續整合 (CI) 是以定期排程將所有開發人員程式碼合併到中央程式碼基底的做法，然後會自動執行標準建置和測試程序。 CI 可確保整個小組同時在程式碼基底上工作，而不會有衝突。 它也可確保能夠盡早找到程式碼缺失。 CI 程序最好應該在每次程式碼認可或簽入時執行。 至少應該每天執行一次。

> 請考慮採用[主幹型開發模型][trunk-based]。 在此模型中，開發人員會認可至單一分支 (主幹)。 有著認可永遠不中斷建置的需求。 此模型有助於 CI，因為所有功能工作都是在主幹中完成，當認可發生時任何合併衝突都會解決。

**考慮使用持續傳遞。** 持續傳遞 (CD) 是確保程式碼一律就緒準備部署的做法，方法是自動建置、測試程式碼，並且將其部署至類似生產的環境。 新增持續傳遞以建立完整的 CI/CD 管線，可協助您儘速偵測程式碼缺失，並且確保適當的已測試更新可以在很短的時間內發行。

> 持續部署是額外的處理程序，會自動採用通過 CI/CD 管線的任何更新，然後將它們部署到生產環境。 持續部署需要強固的自動測試和進階程序規劃，可能不適用於所有小組。

**進行小型增量變更。** 大型程式碼變更更有可能引入錯誤。 您應該盡可能保持小型變更。 這樣會限制每個變更的潛在影響，並且讓了解及偵錯任何問題更容易。

**控制變更的公開。** 確定您可以控制使用者何時能夠看見更新。 為使用者啟用功能時，請考慮使用功能切換來控制。

**實作發行管理策略來減少部署風險。** 將應用程式更新部署到生產環境永遠會伴隨著某些風險。 若要降低此風險，使用例如 [Canary 版本][canary-release]或[藍綠部署][blue-green]的策略，將更新部署至使用者的子集。 確認更新如預期般運作，然後將更新推出給系統其餘部分。

**記錄所有變更。** 次要更新和組態變更會是混淆和版本衝突的來源。 請務必保留任何變更的清楚記錄，無論多麼微小。 記錄變更的每個項目，包括套用的修補程式、原則變更和組態變更。 (不要在這些記錄中包括敏感性資料。 例如，記錄認證已更新、誰進行變更，但是不記錄更新的認證。)整個小組應該都可以看到變更的記錄。 

**自動化部署。** 自動化所有部署，讓系統就位以在推出期間偵測任何問題。 在更新於所有生產環境執行個體中取代它們之前，在生產環境中具備保留現有程式碼和資料的風險降低程序。 具備向前復原修正或向後復原變更的自動化方式。

**考慮讓基礎結構不可變。** 不可變的基礎結構是您在將基礎結構部署至生產環境之後不應該修改的準則。 否則，就可以進入已套用臨機操作變更的狀態，很難完全了解變更的內容。 不可變的基礎結構之運作方式是在任何新部署中取代整部伺服器。 這可讓程式碼和裝載環境進行測試和部署為區塊。 一旦部署，基礎結構元件不會修改，直到下一個建置和部署週期。 

## <a name="monitoring"></a>監視

**讓系統變成可觀察。** 作業小組應該一律對於系統或服務的健康情況和狀態有清楚的可見性。 設定外部健康情況端點以監視狀態，並且確認應用程式已編碼以檢測作業計量。 請使用通用且一致的結構描述，以便讓系統中的所有事件相互關聯。 [Azure 診斷][azure-diagnostics]和 [Application Insights][app-insights] 是追蹤 Azure 資源之健康情況和狀態的標準方法。 Microsoft [Operation Management Suite][oms] 也會提供雲端或混合式解決方案的集中式監視和管理。

**彙總記錄和計量並且將其相互關聯**。 適當檢測遙測系統會提供大量的未經處理效能資料和事件記錄。 請確定遙測和記錄資料經過處理，並且在短時間內相互關聯，讓作業人員一律擁有系統健康情況的最新概念。 以提供任何問題密切檢視的方式來組織及顯示資料，以便在事件彼此相關時能夠盡量清楚。

> 如需資料處理方式以及應該儲存多久的需求，請參閱公司的保留原則。 

**實作自動化的警示和通知。** 設定監視工具，例如 [Azure 監視器][azure-monitor]，以偵測會表示潛在或目前問題的模式或條件，然後將警示傳送給可以解決問題的小組成員。 微調警示以避免誤判。

**監視資產和資源是否到期。** 某些資源和資產，例如憑證，會在指定的一段時間之後到期。 請確定追蹤哪些資產到期、它們何時到期，以及哪些服務或功能相依於這些資產。 使用自動化的程序來監視這些資產。 在資產到期之前通知作業小組，如果到期威脅會中斷應用程式，則向上呈報。

## <a name="management"></a>管理

**自動化作業工作。** 手動處理重複的作業程序很容易發生錯誤。 盡可能自動化這些工作，以確保一致的執行和品質。 會實作自動化的程式碼應該在原始程式碼控制中建立版本。 如同任何其他程式碼，自動化工具必須進行測試。

**運用基礎結構即程式碼的方法來佈建。** 將佈建資源所需的手動設定數量降到最低。 相反地，使用指令碼和 [Azure Resource Manager][resource-manager] 範本。 在原始程式碼控制中保留指令碼和範本，就像您維護的任何其他程式碼一樣。 

**考慮使用容器。** 容器會提供用來部署應用程式的標準套件型介面。 使用容器，應用程式會使用獨立式套件 (包含任何軟體、相依性，以及執行應用程式所需的檔案) 進行部署，可大幅簡化部署程序。 

容器也會在應用程式與基礎作業系統之間建立抽象層，提供整個環境的一致性。 這個抽象層也可以從其他程序或在主機上執行的應用程式將容器隔離。 

**實作復原和自我修復。** 復原是應用程式從失敗中復原的能力。 復原的策略包括重試暫時性失敗，並且容錯移轉到次要執行個體或甚至是另一個區域。 如需詳細資訊，請參閱[為 Azure 設計復原應用程式][resiliency]。 檢測您的應用程式，讓問題可以立即回報，且您可以管理中斷或其他系統失敗。

**具備作業手冊。** 作業手冊或「Runbook」會記錄作業人員維護系統所需的程序和管理資訊。 也會記錄任何作業案例和風險降低計畫，可能會在服務失敗或其他中斷期間執行。 在開發程序期間建立這份文件，並在往後將它保持在最新狀態。 這是即時文件，應該要定期檢閱、測試及改進。 

共用的文件很重要。 促使小組成員參與及共用知識。 整個小組應該都能夠存取文件。 讓小組的每個人都能輕易地協助保持更新文件。

**記錄待命程序。** 請確定已記錄待命職責、排程及程序，並且與所有小組成員共用。 隨時將這項資訊保持在最新狀態。

**記錄協力廠商相依產品的呈核程序。** 如果您的應用程式相依於您無法直接控制的外部協力廠商服務，您必須有處理中斷的計劃。 為您的風險降低程序建立文件。 包含支援連絡人和呈核路徑。

**使用組態管理。** 組態變更應該已納入規劃、可讓作業看見，而且已記錄。 這可能會採用組態管理資料庫的形式，或組態即程式碼的方法。 應該定期稽核組態，以確保實際就位的是預期的內容。

**取得 Azure 支援方案並了解程序。** Azure 提供了許多[支援方案][azure-support-plans]。 針對您的需求判斷正確的方案，並確定整個小組知道如何使用它。 小組成員應該了解方案的詳細資料、支援程序的運作方式，以及如何使用 Azure 開啟支援票證。 如果您預期是高規格事件，Azure 支援人員可以協助您增加服務限制。 如需詳細資訊，請參閱 [Azure 支援常見問題集](https://azure.microsoft.com/en-us/support/faq/)。

**授與資源的存取權時請遵循最低權限原則。** 謹慎管理對資源的存取。 根據預設應拒絕存取，除非使用者明確獲得資源的存取權。 僅授與使用者完成其工作所需的存取權。 追蹤使用者權限，並執行定期的安全性稽核。

**使用角色型存取控制。** 將使用者帳戶和存取權指派給資源不應該是手動程序。 使用[角色型存取控制][ rbac] (RBAC) 根據 [Azure Active Directory][azure-ad] 身分識別和群組來授與存取權。 

**使用錯誤追蹤系統來追蹤問題。** 如果沒有追蹤問題的好方法，就很容易會遺失項目、重複工作，或產生額外的問題。 不要依賴非正式個人對個人通訊，來追蹤錯誤的狀態。 使用錯誤追蹤工具來記錄問題的相關詳細資料、指派資源以解決問題，以及提供進度和狀態的稽核記錄。 

**管理變更管理系統中的所有資源。** 您的 DevOps 程序的所有層面應該包含在管理和版本設定系統，以便輕鬆地追蹤和稽核變更。 這包括程式碼、基礎結構、組態、文件以及指令碼。 將這些類型的資源都視為整個測試/建置/檢閱程序的程式碼。 

**使用檢查清單。** 建立作業檢查清單以確保遵循處理程序。 通常會在大型手冊中遺漏某些項目，遵循檢查清單可以強制注意可能會被忽略的細節。 維護檢查清單，並持續尋找自動化工作並簡化處理程序的方式。

如需 DevOps 的詳細資訊，請參閱 Visual Studio 網站上的 [DevOps 是什麼？][what-is-devops]。

<!-- links -->

[app-insights]: /azure/application-insights/
[azure-ad]: https://azure.microsoft.com/services/active-directory/
[azure-diagnostics]: /azure/monitoring-and-diagnostics/azure-diagnostics
[azure-monitor]: /azure/monitoring-and-diagnostics/monitoring-overview
[azure-support-plans]: https://azure.microsoft.com/support/plans/
[blue-green]: https://martinfowler.com/bliki/BlueGreenDeployment.html
[canary-release]:https://martinfowler.com/bliki/CanaryRelease.html
[dev-test]: https://azure.microsoft.com/solutions/dev-test/
[feature-toggles]: https://www.martinfowler.com/articles/feature-toggles.html
[oms]: https://www.microsoft.com/cloud-platform/operations-management-suite
[rbac]: /azure/active-directory/role-based-access-control-what-is
[resiliency]: ../resiliency/index.md
[resource-manager]: /azure/azure-resource-manager/
[trunk-based]: https://trunkbaseddevelopment.com/
[what-is-devops]: https://www.visualstudio.com/learn/what-is-devops/
