---
title: 定義復原 Azure 應用程式的需求
description: 收集 Azure 應用程式的可用性和恢復功能需求的概觀
author: MikeWasson
ms.date: 04/10/2019
ms.topic: article
ms.service: architecture-center
ms.subservice: cloud-design-principles
ms.openlocfilehash: 2af2ce4200c285abfda1395862d21efc3c17e577
ms.sourcegitcommit: 579c39ff4b776704ead17a006bf24cd4cdc65edd
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/17/2019
ms.locfileid: "59646511"
---
# <a name="developing-requirements-for-resilient-azure-applications"></a>開發復原 Azure 應用程式的需求

建置*恢復*（從失敗復原） 及*可用性*（執行中而不需顯著停機的狀況良好狀態） 到您的應用程式開始收集需求。 比方說，多少停機時間是可接受？ 可能的停機時間費用業務是多少？ 客戶的可用性需求為何？ 您投資，讓您的應用程式高可用性多少？ 什麼是成本與風險？

## <a name="identify-distinct-workloads"></a>識別不同的工作負載

雲端解決方案通常包含多個應用程式*工作負載*。 工作負載是不同的功能或以邏輯方式分開根據商務邏輯和資料儲存體需求的其他工作的工作。 例如，電子商務應用程式可能會有下列的工作負載：

- 瀏覽及搜尋產品類別目錄。
- 建立並追蹤訂單。
- 檢視建議。

每個工作負載都有不同的可用性、 延展性、 資料一致性和災害復原的需求。 每個工作負載的風險與成本之間的平衡，讓您的商務決策。

服務等級目標，也分解工作負載。 如果服務包含的重要和比較不重要的工作負載，就會以不同的方式加以管理，並指定以符合其可用性需求所需的執行個體數目的服務功能。

## <a name="plan-for-usage-patterns"></a>使用模式的計劃

在重大和非重大的期間，找出需求的差異。 必須使用系統時，是否有某些重要的期間？ 例如，報稅應用程式不能在歸檔期限期間失敗，以及影片串流服務不應該延遲期間的即時事件。 在這些情況下，權衡成本與風險。

- 若要確保穩定性，並符合服務等級協定 (Sla) 中重要的期間，規劃備援跨數個區域一個失敗時，即使其成本較高。
- 相反地，如果非關鍵期間，您可以執行應用程式將成本降至最低的單一區域中。
- 在某些情況下，您可以使用新式無伺服器技術，具有以使用量為基礎的計費，以避免額外的費用。

## <a name="establish-availability-and-recovery-metrics"></a>建立可用性和復原的計量

建立兩個集合的需求程序的一部分的度量的基準線數目。 第一組可協助您決定加入雲端服務中的冗餘的 where 和哪些要為客戶提供 Sla。 第二個設定可協助您規劃災害復原。

### <a name="availability-metrics"></a>可用性度量

使用這些量值來規劃備援並判斷客戶的 Sla。

- **若要復原 (MTTR) 的平均時間**是平均所需的時間在失敗後還原元件。
- **失敗 (MTBF) 之間的平均時間**是長時間元件可以合理預期能夠關閉間的最後一個。

### <a name="recovery-metrics"></a>復原計量

藉由執行風險評定，來衍生這些值，並確定您了解成本和停機時間和資料遺失的風險。 這些是系統的非功能性需求，而且應該依照商務需求。

- **復原時間目標 (RTO)** 是事件之後無法使用應用程式的最大可接受時間。
- **復原點目標 (RPO)** 是在災害期間可接受資料遺失的最大時間長度。

如果 MTTR 值*任何*高度可用的安裝程式中的重要元件超出系統 RTO，系統中的失敗可能會導致無法接受的業務中斷。 也就是說，您無法還原的系統定義的 RTO 內。

## <a name="determine-workload-availability-targets"></a>判斷工作負載的可用性目標

因此您可以判斷架構是否符合商務需求，請在 您的解決方案中定義您自己的每個工作負載的目標 Sla。

### <a name="consider-cost-and-complexity"></a>請考慮成本和複雜度

其他的一切，更高的可用性最好。 但您尋求更多的九，成本和複雜度增加。 99.99%的執行時間會轉譯為大約五分鐘內的每個月的總停機時間。 是否值得額外的複雜性和成本來達到五個九？ 答案需視商務需求而定。

以下是定義 SLA 時的一些其他考量：

- 若要達到四個九 （99.99%)，您不能依賴手動介入來從失敗中復原。 應用程式必須是自我診斷及自我修復。
- 超過四個九，其難以速度不夠快偵測到中斷狀況，以符合 SLA。
- 請思考您 SLA 測量根據的時間間隔。 間隔越小，容錯度就更緊密。 它沒有任何意義，來定義以每小時或每日執行時間 SLA。
- 考慮 MTBF 和 MTTR 量值。 愈高您的 SLA，越不常服務可以移往下，並必須在復原服務更快。
- 取得合約從您的客戶每一份您的應用程式的可用性目標並加以記錄。 否則，您的設計可能不符合客戶的期望。

### <a name="identify-dependencies"></a>識別相依性

執行相依性對應來識別內部和外部相依性的練習。 範例包括安全性或身分識別，例如 Active Directory 中或第三方服務，例如付款提供者相關的相依性，或電子郵件訊息的服務。

請特別注意外部相依性，可能會是單一失敗點，或是造成瓶頸。 如果工作負載需要 99.99%執行時間，但具有 99.9 %sla 的服務而定，該服務無法在系統中是單一失敗點。 一個補救是指萬一服務失敗，有一個後援的路徑。 或者，採取其他措施從該服務中的失敗中復原。

下表顯示各種 SLA 層級的潛在累計停機時間。

| **SLA** | **每週停機時間** | **每月停機時間** | **每年停機時間** |
|---------|-----------------------|------------------------|-----------------------|
| 99%     | 1.68 小時            | 7.2 小時              | 3.65 天             |
| 99.9%   | 10.1 分鐘          | 43.2 分鐘           | 8.76 小時            |
| 99.95%  | 5 分鐘             | 21.6 分鐘           | 4.38 小時            |
| 99.99%  | 1.01 分鐘          | 4.32 分鐘           | 52.56 分鐘         |
| 99.999% | 6 秒             | 25.9 秒           | 5.26 分鐘          |

## <a name="understand-service-level-agreements"></a>了解服務等級協定

在 Azure 中，[服務等級協定](https://azure.microsoft.com/en-us/support/legal/sla/)說明 Microsoft 的承諾，對執行時間與連線能力。 如果特定服務的 SLA 是 99.9%，您應該預期 99.9%的時間是可用的服務。 不同的服務有不同的 Sla。

Azure SLA 也包括如果不符合 SLA，以及特定的定義，取得服務退費的佈建*可用性*針對每個服務。 SLA 的這個部分會作為強制執行原則。

### <a name="composite-slas"></a>複合 SLA

*複合 Sla*牽涉到多個服務支援的應用程式，各有不同層級的可用性。 例如，請考慮將寫入至 Azure SQL Database 的 App Service web 應用程式。 在撰寫本文時，這些 Azure 服務都有下列 SLA：

- App Service web 應用程式 = 99.95%
- SQL Database = 99.99%

您預期這個應用程式的停機時間最長是多久？ 如果其中一項服務失敗，整個應用程式就會失敗。 每個服務失敗的機率是各自獨立，因此這個應用程式的複合 SLA 是 99.95%× 99.99%= 99.94%。 這低於個別的 Sla，這不令人驚訝，因為仰賴多個服務的應用程式有更多潛在的失敗點。

您可以建立獨立的後援路徑來改善複合 SLA。 例如，如果 SQL 資料庫無法使用，將交易放入佇列以供稍後處理。

![複合 SLA](_images/composite-sla.png)

透過這個設計，即使在無法連線到資料庫的情況下，應用程式還是可以使用。 不過，如果資料庫與佇列同時失敗，它就會失敗。 預期的同時失敗百分比是時間的 0.0001 × 0.001，，因此這個合併路徑的複合 SLA 是時間的：

- 資料庫*或*佇列 = 1.0 − (0.0001 × 0.001) = 99.99999%

複合 SLA 總計是：

- Web 應用程式*並*(資料庫*或是*佇列) = 99.95%× 99.99999%= \~99.95%

都會有這種方法的優缺點。 應用程式邏輯是更複雜，您需支付佇列，，您必須考量資料一致性問題。

### <a name="slas-for-multiregion-deployments"></a>多區域部署的 Sla

*多區域部署的 Sla*涉及部署多個區域中的應用程式，並使用 Azure 流量管理員容錯移轉，如果應用程式無法在一個區域中的高可用性技術。

多區域部署的複合 SLA 的計算方式如下：

- *N*是一個區域中部署的應用程式的複合 SLA。
- *R*是應用程式部署所在的區域數目。

應用程式無法同時在所有區域中的預期的機率為 ((1 − N) \^ R)。 比方說，如果單一區域的 SLA 是 99.95%:

- 兩個區域的合併的 SLA = (1 − （1 − 0.9995） \^ 2) = 99.999975%
- 四個區域的合併的 SLA = (1 − （1 − 0.9995） \^ 4) = 99.999999%

[Traffic Manager SLA](https://azure.microsoft.com/en-us/support/legal/sla/traffic-manager/v1_0/)也是一項因素。 容錯移轉並非瞬間完成，在主動-被動組態中，這可能會導致容錯移轉期間的停機時間。 請參閱[流量管理員端點監視和容錯移轉](/azure/traffic-manager/traffic-manager-monitoring)。

## <a name="next-steps"></a>後續步驟

> [!div class="nextstepaction"]
> [架構設計人員的恢復功能和可用性](./architect.md)
