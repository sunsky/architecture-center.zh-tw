---
title: 可用性檢查清單
titleSuffix: Azure Design Review Framework
description: 提供設計期間可用性考量指引的檢查清單。
author: dragon119
ms.date: 11/26/2018
ms.topic: checklist
ms.service: architecture-center
ms.subservice: cloud-design-principles
ms.custom: checklist
ms.openlocfilehash: 2e0c337cb0a5f343ae3dd94ae209d01f063cab35
ms.sourcegitcommit: 1b50810208354577b00e89e5c031b774b02736e2
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/23/2019
ms.locfileid: "54483576"
---
# <a name="availability-checklist"></a><span data-ttu-id="b8db9-103">可用性檢查清單</span><span class="sxs-lookup"><span data-stu-id="b8db9-103">Availability checklist</span></span>

<span data-ttu-id="b8db9-104">可用性是指系統可正常運作的時間比例，且是[軟體品質要素](../guide/pillars.md)的其中一項。</span><span class="sxs-lookup"><span data-stu-id="b8db9-104">Availability is the proportion of time that a system is functional and working, and is one of the [pillars of software quality](../guide/pillars.md).</span></span> <span data-ttu-id="b8db9-105">請使用此檢查清單，從可用性的觀點來檢閱您的應用程式架構。</span><span class="sxs-lookup"><span data-stu-id="b8db9-105">Use this checklist to review your application architecture from an availability standpoint.</span></span>

## <a name="application-design"></a><span data-ttu-id="b8db9-106">應用程式設計</span><span class="sxs-lookup"><span data-stu-id="b8db9-106">Application design</span></span>

<span data-ttu-id="b8db9-107">**請避免單一失敗點。**</span><span class="sxs-lookup"><span data-stu-id="b8db9-107">**Avoid any single point of failure.**</span></span> <span data-ttu-id="b8db9-108"> 為避免單一失敗點影響可用性，應該將所有的元件、服務、資源和計算執行個體部署為多個執行個體。</span><span class="sxs-lookup"><span data-stu-id="b8db9-108">All components, services, resources, and compute instances should be deployed as multiple instances to prevent a single point of failure from affecting availability.</span></span> <span data-ttu-id="b8db9-109">這包括驗證機制。</span><span class="sxs-lookup"><span data-stu-id="b8db9-109">This includes authentication mechanisms.</span></span> <span data-ttu-id="b8db9-110">將應用程式設計為可以設定使用多個執行個體，自動偵測失敗，並將要求重新導向至非失敗的執行個體 (平台並不會在其中自動執行此動作)。</span><span class="sxs-lookup"><span data-stu-id="b8db9-110">Design the application to be configurable to use multiple instances, and to automatically detect failures and redirect requests to non-failed instances where the platform does not do this automatically.</span></span>

<span data-ttu-id="b8db9-111">**根據服務層級目標來分解工作負載。**</span><span class="sxs-lookup"><span data-stu-id="b8db9-111">**Decompose workloads by service-level objective.**</span></span> <span data-ttu-id="b8db9-112"> 如果服務由重要和比較不重要的工作負載組成，請以不同的方式加以管理，並指定服務功能及執行個體數目，以符合其可用性需求。</span><span class="sxs-lookup"><span data-stu-id="b8db9-112">If a service is composed of critical and less-critical workloads, manage them differently and specify the service features and number of instances to meet their availability requirements.</span></span>

<span data-ttu-id="b8db9-113">**最小化和了解服務相依性。**</span><span class="sxs-lookup"><span data-stu-id="b8db9-113">**Minimize and understand service dependencies.**</span></span> <span data-ttu-id="b8db9-114"> 盡可能將使用過的不同服務數目降到最低，並確定您了解所有存在於系統中的功能和服務相依性。</span><span class="sxs-lookup"><span data-stu-id="b8db9-114">Minimize the number of different services used where possible, and ensure you understand all of the feature and service dependencies that exist in the system.</span></span> <span data-ttu-id="b8db9-115">這包括這些相依性的本質、失敗的影響，或整體應用程式上每個服務減少的效能。</span><span class="sxs-lookup"><span data-stu-id="b8db9-115">This includes the nature of these dependencies, and the impact of failure or reduced performance in each one on the overall application.</span></span>

<span data-ttu-id="b8db9-116">**盡可能將工作和訊息設計成具有等冪性**。</span><span class="sxs-lookup"><span data-stu-id="b8db9-116">**Design tasks and messages to be idempotent where possible**.</span></span> <span data-ttu-id="b8db9-117">若作業可以多次重複並產生相同的結果，則作業具有等冪性。</span><span class="sxs-lookup"><span data-stu-id="b8db9-117">An operation is idempotent if it can be repeated multiple times and produce the same result.</span></span> <span data-ttu-id="b8db9-118">等冪性可以確保重複的要求不會造成問題。</span><span class="sxs-lookup"><span data-stu-id="b8db9-118">Idempotency can ensure that duplicated requests don't cause problems.</span></span> <span data-ttu-id="b8db9-119">訊息取用者與其執行的作業應該具有等冪性，這樣重複先前執行過的作業才不會使結果無效。</span><span class="sxs-lookup"><span data-stu-id="b8db9-119">Message consumers and the operations they carry out should be idempotent so that repeating a previously executed operation does not render the results invalid.</span></span> <span data-ttu-id="b8db9-120">這可能表示偵測重複訊息，或是使用開放式的方法來處理衝突，以確保一致性。</span><span class="sxs-lookup"><span data-stu-id="b8db9-120">This may mean detecting duplicated messages, or ensuring consistency by using an optimistic approach to handling conflicts.</span></span>

<span data-ttu-id="b8db9-121">**使用可實作重要交易之高可用性的訊息代理人。**</span><span class="sxs-lookup"><span data-stu-id="b8db9-121">**Use a message broker that implements high availability for critical transactions.**</span></span> <span data-ttu-id="b8db9-122">許多雲端應用程式會使用傳訊來起始以非同步方式執行的工作。</span><span class="sxs-lookup"><span data-stu-id="b8db9-122">Many cloud applications use messaging to initiate tasks that are performed asynchronously.</span></span> <span data-ttu-id="b8db9-123">若要保證訊息的傳遞，傳訊系統應該提供高可用性。</span><span class="sxs-lookup"><span data-stu-id="b8db9-123">To guarantee delivery of messages, the messaging system should provide high availability.</span></span> <span data-ttu-id="b8db9-124">[Azure 服務匯流排傳訊](/azure/service-bus-messaging)會實作「至少一次」語意。</span><span class="sxs-lookup"><span data-stu-id="b8db9-124">[Azure Service Bus Messaging](/azure/service-bus-messaging) implements *at least once* semantics.</span></span> <span data-ttu-id="b8db9-125">這表示雖然在某些情況下可能會傳送複本，但張貼到佇列的訊息不會遺失。</span><span class="sxs-lookup"><span data-stu-id="b8db9-125">This means that a message posted to a queue will not be lost, although duplicate copies may be delivered under certain circumstances.</span></span> <span data-ttu-id="b8db9-126">如果訊息處理是等冪 (請參閱上一個項目)，重複傳遞應該不是問題。</span><span class="sxs-lookup"><span data-stu-id="b8db9-126">If message processing is idempotent (see the previous item), repeated delivery should not be a problem.</span></span>

<span data-ttu-id="b8db9-127">**設計可依正常程序降級的應用程式。**</span><span class="sxs-lookup"><span data-stu-id="b8db9-127">**Design applications to gracefully degrade.**</span></span> <span data-ttu-id="b8db9-128">應用程式上的負載可能會超出其中一或多個組件的容量，而導致可用性降低和連線失敗。</span><span class="sxs-lookup"><span data-stu-id="b8db9-128">The load on an application may exceed the capacity of one or more parts, causing reduced availability and failed connections.</span></span> <span data-ttu-id="b8db9-129">縮放比例有助於減輕這點，但是它可能會到達資源可用性或成本等其他因素所加諸的限制。</span><span class="sxs-lookup"><span data-stu-id="b8db9-129">Scaling can help to alleviate this, but it may reach a limit imposed by other factors, such as resource availability or cost.</span></span> <span data-ttu-id="b8db9-130">應用程式達到資源限制時，應該採取適當的動作，將對於使用者的影響降到最低。</span><span class="sxs-lookup"><span data-stu-id="b8db9-130">When an application reaches a resource limit, it should take appropriate action to minimize the impact for the user.</span></span> <span data-ttu-id="b8db9-131">例如，在電子商務系統中，若訂單處理子系統處於疲勞狀態或失敗，可以暫時將其停用，同時允許其他功能 (例如瀏覽產品目錄) 繼續運作。</span><span class="sxs-lookup"><span data-stu-id="b8db9-131">For example, in an ecommerce system, if the order-processing subsystem is under strain or fails, it can be temporarily disabled while allowing other functionality, such as browsing the product catalog.</span></span> <span data-ttu-id="b8db9-132">適當作法是延後對失敗子系統的要求，例如讓客戶可以提交訂單，但是將訂單儲存以供訂單子系統稍後再次可用時加以處理。</span><span class="sxs-lookup"><span data-stu-id="b8db9-132">It might be appropriate to postpone requests to a failing subsystem, for example still enabling customers to submit orders but saving them for later processing, when the orders subsystem is available again.</span></span>

<span data-ttu-id="b8db9-133">**適當處理急促高載事件。**</span><span class="sxs-lookup"><span data-stu-id="b8db9-133">**Gracefully handle rapid burst events.**</span></span> <span data-ttu-id="b8db9-134">大部分的應用程式所需要處理的工作負載，會隨著時間而有所不同。</span><span class="sxs-lookup"><span data-stu-id="b8db9-134">Most applications need to handle varying workloads over time.</span></span> <span data-ttu-id="b8db9-135">自動調整有助於處理負載，但是它可能需要一些時間，讓其他執行個體上線並處理要求。</span><span class="sxs-lookup"><span data-stu-id="b8db9-135">Auto-scaling can help to handle the load, but it may take some time for additional instances to come online and handle requests.</span></span> <span data-ttu-id="b8db9-136">防止突然和非預期的活動高載導致超出應用程式的處理能力：將應用程式設計為將要求加入其使用之服務的佇列，並在佇列接近完整容量時適當降級。</span><span class="sxs-lookup"><span data-stu-id="b8db9-136">Prevent sudden and unexpected bursts of activity from overwhelming the application: design it to queue requests to the services it uses and degrade gracefully when queues are near to full capacity.</span></span> <span data-ttu-id="b8db9-137">請確定有足夠的效能和容量可供非高載條件清空佇列和處理未完成的要求。</span><span class="sxs-lookup"><span data-stu-id="b8db9-137">Ensure that there is sufficient performance and capacity available under non-burst conditions to drain the queues and handle outstanding requests.</span></span> <span data-ttu-id="b8db9-138">如需詳細資訊，請參閱[佇列型負載調節模式](../patterns/queue-based-load-leveling.md)。</span><span class="sxs-lookup"><span data-stu-id="b8db9-138">For more information, see the [Queue-Based Load Leveling pattern](../patterns/queue-based-load-leveling.md).</span></span>

## <a name="deployment-and-maintenance"></a><span data-ttu-id="b8db9-139">部署和維護</span><span class="sxs-lookup"><span data-stu-id="b8db9-139">Deployment and maintenance</span></span>

<span data-ttu-id="b8db9-140">**部署多個服務執行個體。**</span><span class="sxs-lookup"><span data-stu-id="b8db9-140">**Deploy multiple instances of services.**</span></span> <span data-ttu-id="b8db9-141">如果您的應用程式相依於服務的單一執行個體，它會建立單一失敗點。</span><span class="sxs-lookup"><span data-stu-id="b8db9-141">If your application depends on a single instance of a service, it creates a single point of failure.</span></span> <span data-ttu-id="b8db9-142">佈建多個執行個體，可改善復原能力和延展性。</span><span class="sxs-lookup"><span data-stu-id="b8db9-142">Provisioning multiple instances improves both resiliency and scalability.</span></span> <span data-ttu-id="b8db9-143">對於 [Azure App Service](/azure/app-service/app-service-value-prop-what-is/)，選取可提供多個執行個體的 [App Service 方案](/azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview/)。</span><span class="sxs-lookup"><span data-stu-id="b8db9-143">For [Azure App Service](/azure/app-service/app-service-value-prop-what-is/), select an [App Service Plan](/azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview/) that offers multiple instances.</span></span> <span data-ttu-id="b8db9-144">對於 Azure 雲端服務，設定您的每個角色以使用[多個執行個體](/azure/cloud-services/cloud-services-choose-me/#scaling-and-management)。</span><span class="sxs-lookup"><span data-stu-id="b8db9-144">For Azure Cloud Services, configure each of your roles to use [multiple instances](/azure/cloud-services/cloud-services-choose-me/#scaling-and-management).</span></span> <span data-ttu-id="b8db9-145">對於 [Azure 虛擬機器 (VM)](/azure/virtual-machines/virtual-machines-windows-about/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)，確保 VM 架構包含多個 VM，而且每個 VM 都包含在[可用性設定組][availability-sets]中。</span><span class="sxs-lookup"><span data-stu-id="b8db9-145">For [Azure Virtual Machines (VMs)](/azure/virtual-machines/virtual-machines-windows-about/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json), ensure that your VM architecture includes more than one VM and that each VM is included in an [availability set][availability-sets].</span></span>

<span data-ttu-id="b8db9-146">**請考慮在多個區域中部署您的應用程式。**</span><span class="sxs-lookup"><span data-stu-id="b8db9-146">**Consider deploying your application across multiple regions.**</span></span> <span data-ttu-id="b8db9-147">如果您的應用程式已部署到單一區域，在少數情況下，整個區域會變得無法使用，您的應用程式也將無法使用。</span><span class="sxs-lookup"><span data-stu-id="b8db9-147">If your application is deployed to a single region, in the rare event the entire region becomes unavailable, your application will also be unavailable.</span></span> <span data-ttu-id="b8db9-148">您應用程式的 SLA 條款可能無法接受這種情況。</span><span class="sxs-lookup"><span data-stu-id="b8db9-148">This may be unacceptable under the terms of your application's SLA.</span></span> <span data-ttu-id="b8db9-149">若是如此，請考慮在多個區域中部署您的應用程式及其服務。</span><span class="sxs-lookup"><span data-stu-id="b8db9-149">If so, consider deploying your application and its services across multiple regions.</span></span>

<span data-ttu-id="b8db9-150">**自動化和測試部署和維護工作**。</span><span class="sxs-lookup"><span data-stu-id="b8db9-150">**Automate and test deployment and maintenance tasks.**</span></span> <span data-ttu-id="b8db9-151">分散式應用程式由多個必須相互合作的部分所組成。</span><span class="sxs-lookup"><span data-stu-id="b8db9-151">Distributed applications consist of multiple parts that must work together.</span></span> <span data-ttu-id="b8db9-152">部署應該使用經過測試和實證的機制 (例如指令碼) 來加以自動化。</span><span class="sxs-lookup"><span data-stu-id="b8db9-152">Deployment should be automated, using tested and proven mechanisms such as scripts.</span></span> <span data-ttu-id="b8db9-153">它們可以更新和驗證組態，並自動化部署程序。</span><span class="sxs-lookup"><span data-stu-id="b8db9-153">These can update and validate configuration, and automate the deployment process.</span></span> <span data-ttu-id="b8db9-154">使用 [Azure Resource Manager 範本](/azure/azure-resource-manager/resource-group-authoring-templates)來佈建 Azure 資源。</span><span class="sxs-lookup"><span data-stu-id="b8db9-154">Use [Azure Resource Manager templates](/azure/azure-resource-manager/resource-group-authoring-templates) to provision Azure resource.</span></span> <span data-ttu-id="b8db9-155">也請使用自動化技術來執行應用程式更新。</span><span class="sxs-lookup"><span data-stu-id="b8db9-155">Also use automated techniques to perform application updates.</span></span> <span data-ttu-id="b8db9-156">請務必完整測試所有程序，以確保錯誤不會造成其他停機情況。</span><span class="sxs-lookup"><span data-stu-id="b8db9-156">It is vital to test all of these processes fully to ensure that errors do not cause additional downtime.</span></span> <span data-ttu-id="b8db9-157">所有的部署工具必須有適當的安全性限制，來保護已部署的應用程式。仔細定義和強制執行部署原則並將人為介入的需要降到最低。</span><span class="sxs-lookup"><span data-stu-id="b8db9-157">All deployment tools must have suitable security restrictions to protect the deployed application; define and enforce deployment policies carefully and minimize the need for human intervention.</span></span>

<span data-ttu-id="b8db9-158">**使用平台的暫存和實際執行功能。**</span><span class="sxs-lookup"><span data-stu-id="b8db9-158">**Use staging and production features of the platform.**.</span></span> <span data-ttu-id="b8db9-159">例如，Azure App Service 可支援[部署位置](/azure/app-service/web-sites-staged-publishing)，可讓您在切換到生產環境之前用以暫存部署。</span><span class="sxs-lookup"><span data-stu-id="b8db9-159">For example, Azure App Service supports [deployment slots](/azure/app-service/web-sites-staged-publishing), which you can use to stage a deployment before swapping it to production.</span></span> <span data-ttu-id="b8db9-160">Azure Service Fabric 可支援應用程式服務的[輪流升級](/azure/service-fabric/service-fabric-application-upgrade)。</span><span class="sxs-lookup"><span data-stu-id="b8db9-160">Azure Service Fabric supports [rolling upgrades](/azure/service-fabric/service-fabric-application-upgrade) to application services.</span></span>

<span data-ttu-id="b8db9-161">**將虛擬機器 (VM) 放入可用性設定組中。**</span><span class="sxs-lookup"><span data-stu-id="b8db9-161">**Place virtual machines (VMs) in an availability set.**</span></span> <span data-ttu-id="b8db9-162">若要將可用性最大化，請為每個虛擬機器角色建立多個執行個體，並將這些執行個體放在相同的可用性設定組中。</span><span class="sxs-lookup"><span data-stu-id="b8db9-162">To maximize availability, create multiple instances of each VM role and place these instances in the same availability set.</span></span> <span data-ttu-id="b8db9-163">若您有多部虛擬機器扮演不同的角色 (例如不同的應用程式層)，請為每個虛擬機器角色建立一個可用性設定組。</span><span class="sxs-lookup"><span data-stu-id="b8db9-163">If you have multiple VMs that serve different roles, such as different application tiers, create an availability set for each VM role.</span></span> <span data-ttu-id="b8db9-164">例如，為 Web 層建立一個可用性設定組，並為資料層建立另一個可用性設定組。</span><span class="sxs-lookup"><span data-stu-id="b8db9-164">For example, create an availability set for the web tier and another for the data tier.</span></span>

<span data-ttu-id="b8db9-165">**使用 Azure Site Recovery 複寫 VM。**</span><span class="sxs-lookup"><span data-stu-id="b8db9-165">**Replicate VMs using Azure Site Recovery.**</span></span> <span data-ttu-id="b8db9-166">若要達到最大的可用性，請使用 [Site Recovery][site-recovery] 將您所有的虛擬機器複寫至另一個 Azure 區域。</span><span class="sxs-lookup"><span data-stu-id="b8db9-166">To maximize availability, replicate all your virtual machines into another Azure region using [Site Recovery][site-recovery].</span></span> <span data-ttu-id="b8db9-167">請確實在應用程式的各層之間複寫所有 VM。</span><span class="sxs-lookup"><span data-stu-id="b8db9-167">Ensure that all the VMs across all the tiers of your application are replicated.</span></span> <span data-ttu-id="b8db9-168">如果來源區域發生中斷狀況，您可以在幾分鐘內將 VM 容錯移轉至其他區域。</span><span class="sxs-lookup"><span data-stu-id="b8db9-168">If there is a disruption in the source region, you can fail over the VMs into the other region within minutes.</span></span>

## <a name="data-management"></a><span data-ttu-id="b8db9-169">資料管理</span><span class="sxs-lookup"><span data-stu-id="b8db9-169">Data management</span></span>

<span data-ttu-id="b8db9-170">**Azure 儲存體中的異地複寫資料**。</span><span class="sxs-lookup"><span data-stu-id="b8db9-170">**Geo-replicate data in Azure Storage**.</span></span> <span data-ttu-id="b8db9-171">Azure 儲存體中的資料會在資料中心內自動複製。</span><span class="sxs-lookup"><span data-stu-id="b8db9-171">Data in Azure Storage is automatically replicated within in a datacenter.</span></span> <span data-ttu-id="b8db9-172">如需更高的可用性，請使用讀取權限異地備援儲存體 (-RAGRS)，它會將您的資料複寫到次要區域，並提供次要區域中資料的唯讀權限。</span><span class="sxs-lookup"><span data-stu-id="b8db9-172">For even higher availability, use Read-access geo-redundant storage (-RAGRS), which replicates your data to a secondary region and provides read-only access to the data in the secondary location.</span></span> <span data-ttu-id="b8db9-173">即使發生全面性區域中斷或災害，資料仍具持久性。</span><span class="sxs-lookup"><span data-stu-id="b8db9-173">The data is durable even in the case of a complete regional outage or a disaster.</span></span> <span data-ttu-id="b8db9-174">如需詳細資訊，請參閱 [Azure 儲存體複寫](/azure/storage/storage-redundancy)。</span><span class="sxs-lookup"><span data-stu-id="b8db9-174">For more information, see [Azure Storage replication](/azure/storage/storage-redundancy).</span></span>

<span data-ttu-id="b8db9-175">**異地複寫資料庫**。</span><span class="sxs-lookup"><span data-stu-id="b8db9-175">**Geo-replicate databases**.</span></span> <span data-ttu-id="b8db9-176">Azure SQL Database 和 Cosmos DB 都支援異地複寫，可讓您在其他區域設定次要資料庫複本。</span><span class="sxs-lookup"><span data-stu-id="b8db9-176">Azure SQL Database and Cosmos DB both support geo-replication, which enables you to configure secondary database replicas in other regions.</span></span> <span data-ttu-id="b8db9-177">在資料中心中斷或在無法連線至主要資料庫的情況下，便可使用次要資料庫進行查詢和容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="b8db9-177">Secondary databases are available for querying and for failover in the case of a data center outage or the inability to connect to the primary database.</span></span> <span data-ttu-id="b8db9-178">如需詳細資訊，請參閱[容錯移轉群組和主動式異地複寫](/azure/sql-database/sql-database-geo-replication-overview) (SQL Database) 和[如何使用 Azure Cosmos DB 全域散發資料](/azure/cosmos-db/distribute-data-globally)。</span><span class="sxs-lookup"><span data-stu-id="b8db9-178">For more information, see [Failover groups and active geo-replication](/azure/sql-database/sql-database-geo-replication-overview) (SQL Database) and [How to distribute data globally with Azure Cosmos DB](/azure/cosmos-db/distribute-data-globally).</span></span>

<span data-ttu-id="b8db9-179">**使用開放式並行存取和最終一致性**。</span><span class="sxs-lookup"><span data-stu-id="b8db9-179">**Use optimistic concurrency and eventual consistency**.</span></span> <span data-ttu-id="b8db9-180">透過鎖定 (封閉式並行存取) 封鎖資源存取權的交易可能會造成效能不佳，並且大幅降低可用性。</span><span class="sxs-lookup"><span data-stu-id="b8db9-180">Transactions that block access to resources through locking (pessimistic concurrency) can cause poor performance and considerably reduce availability.</span></span> <span data-ttu-id="b8db9-181">這些問題在分散式系統中可能會變得特別嚴重。</span><span class="sxs-lookup"><span data-stu-id="b8db9-181">These problems can become especially acute in distributed systems.</span></span> <span data-ttu-id="b8db9-182">在許多情況下，謹慎的設計和技術 (例如資料分割) 可以將發生更新衝突的機會降至最低。</span><span class="sxs-lookup"><span data-stu-id="b8db9-182">In many cases, careful design and techniques such as partitioning can minimize the chances of conflicting updates occurring.</span></span> <span data-ttu-id="b8db9-183">只有在資料被複寫，或從個別更新存放區讀取時，資料才會達到最終的一致。</span><span class="sxs-lookup"><span data-stu-id="b8db9-183">Where data is replicated, or is read from a separately updated store, the data will only be eventually consistent.</span></span> <span data-ttu-id="b8db9-184">但優點通常會遠遠超越對使用交易來確保立即一致性的可用性影響。</span><span class="sxs-lookup"><span data-stu-id="b8db9-184">But the advantages usually far outweigh the impact on availability of using transactions to ensure immediate consistency.</span></span>

<span data-ttu-id="b8db9-185">**使用定期備份和時間點還原**。</span><span class="sxs-lookup"><span data-stu-id="b8db9-185">**Use periodic backup and point-in-time restore**.</span></span> <span data-ttu-id="b8db9-186">定期自動備份未保留在其他位置的資料，並確認您可以在失敗發生時，可靠地還原資料和應用程式本身。</span><span class="sxs-lookup"><span data-stu-id="b8db9-186">Regularly and automatically back up data that is not preserved elsewhere, and verify you can reliably restore both the data and the application itself should a failure occur.</span></span> <span data-ttu-id="b8db9-187">請確保備份符合您的復原點目標 (RPO)。</span><span class="sxs-lookup"><span data-stu-id="b8db9-187">Ensure that backups meet your Recovery Point Objective (RPO).</span></span> <span data-ttu-id="b8db9-188">資料複寫不是備份功能，因為人為錯誤或惡意作業都可能會損毀所有複本上的資料。</span><span class="sxs-lookup"><span data-stu-id="b8db9-188">Data replication is not a backup feature, because human error or malicious operations can corrupt data across all the replicas.</span></span> <span data-ttu-id="b8db9-189">備份程序必須是安全的，才能保護傳輸和儲存體中的資料。</span><span class="sxs-lookup"><span data-stu-id="b8db9-189">The backup process must be secure to protect the data in transit and in storage.</span></span> <span data-ttu-id="b8db9-190">資料庫或部分的資料存放區通常可以使用交易紀錄檔復原至先前的時間點。</span><span class="sxs-lookup"><span data-stu-id="b8db9-190">Databases or parts of a data store can usually be recovered to a previous point in time by using transaction logs.</span></span> <span data-ttu-id="b8db9-191">如需詳細資訊，請參閱[從資料損毀或意外刪除復原](../resiliency/recovery-data-corruption.md)</span><span class="sxs-lookup"><span data-stu-id="b8db9-191">For more information, see [Recover from data corruption or accidental deletion](../resiliency/recovery-data-corruption.md)</span></span>

<span data-ttu-id="b8db9-192">**使用 Azure Site Recovery 複寫 VM 磁碟。**</span><span class="sxs-lookup"><span data-stu-id="b8db9-192">**Replicate VM disks using Azure Site Recovery.**</span></span> <span data-ttu-id="b8db9-193">使用 [Site Recovery][site-recovery] 複寫 Azure VM 時，所有 VM 磁碟會持續以非同步方式複寫至目標區域。</span><span class="sxs-lookup"><span data-stu-id="b8db9-193">When you replicate Azure VMs using [Site Recovery][site-recovery], all the VM disks are continuously replicated to the target region asynchronously.</span></span> <span data-ttu-id="b8db9-194">每隔幾分鐘就會建立一次復原點。</span><span class="sxs-lookup"><span data-stu-id="b8db9-194">The recovery points are created every few minutes.</span></span> <span data-ttu-id="b8db9-195">據此，您將獲得以分鐘為單位的 RPO。</span><span class="sxs-lookup"><span data-stu-id="b8db9-195">This gives you an RPO in the order of minutes.</span></span>

## <a name="errors-and-failures"></a><span data-ttu-id="b8db9-196">錯誤和失敗</span><span class="sxs-lookup"><span data-stu-id="b8db9-196">Errors and failures</span></span>

<span data-ttu-id="b8db9-197">**設定要求逾時。**</span><span class="sxs-lookup"><span data-stu-id="b8db9-197">**Configure request timeouts.**</span></span> <span data-ttu-id="b8db9-198"> 服務和資源可能會變成無法使用，導致要求失敗。</span><span class="sxs-lookup"><span data-stu-id="b8db9-198">Services and resources may become unavailable, causing requests to fail.</span></span> <span data-ttu-id="b8db9-199">請確定您所套用的逾時都適用於每個服務或資源，以及存取它們的用戶端。</span><span class="sxs-lookup"><span data-stu-id="b8db9-199">Ensure that the timeouts you apply are appropriate for each service or resource as well as the client that is accessing them.</span></span> <span data-ttu-id="b8db9-200">在某些情況下，您可能會允許用戶端的特定執行個體有較長的逾時，取決於用戶端所執行的內容和其他動作。</span><span class="sxs-lookup"><span data-stu-id="b8db9-200">In some cases, you might allow a longer timeout for a particular instance of a client, depending on the context and other actions that the client is performing.</span></span> <span data-ttu-id="b8db9-201">非常短的逾時可能會對具有大量延遲的服務及資源造成過多的重試作業。</span><span class="sxs-lookup"><span data-stu-id="b8db9-201">Very short timeouts may cause excessive retry operations for services and resources that have considerable latency.</span></span> <span data-ttu-id="b8db9-202">如果大量的要求排入佇列，非常長的逾時可已造成封鎖，等待服務或資源回應。</span><span class="sxs-lookup"><span data-stu-id="b8db9-202">Very long timeouts can cause blocking if a large number of requests are queued, waiting for a service or resource to respond.</span></span>

<span data-ttu-id="b8db9-203">**重試暫時性錯誤所造成的失敗作業。**</span><span class="sxs-lookup"><span data-stu-id="b8db9-203">**Retry failed operations caused by transient faults.**</span></span> <span data-ttu-id="b8db9-204"> 設計存取所有服務和資源的重試策略，因為它們原本不支援自動連線重試。</span><span class="sxs-lookup"><span data-stu-id="b8db9-204">Design a retry strategy for access to all services and resources where they do not inherently support automatic connection retry.</span></span> <span data-ttu-id="b8db9-205">使用策略包含在重試之間增加的延遲，做為失敗增加的數目，以避免資源的多載，並允許它適當地復原並處理排入佇列的要求。</span><span class="sxs-lookup"><span data-stu-id="b8db9-205">Use a strategy that includes an increasing delay between retries as the number of failures increases, to prevent overloading of the resource and to allow it to gracefully recover and handle queued requests.</span></span> <span data-ttu-id="b8db9-206">具有非常短的延遲的持續重試很可能會使問題惡化。</span><span class="sxs-lookup"><span data-stu-id="b8db9-206">Continual retries with very short delays are likely to exacerbate the problem.</span></span> <span data-ttu-id="b8db9-207">如需詳細資訊，請參閱[特定服務的重試指引](../best-practices/retry-service-specific.md)。</span><span class="sxs-lookup"><span data-stu-id="b8db9-207">For more information, see [Retry guidance for specific services](../best-practices/retry-service-specific.md).</span></span>

<span data-ttu-id="b8db9-208">**實作斷路以避免連鎖性失敗。**</span><span class="sxs-lookup"><span data-stu-id="b8db9-208">**Implement circuit breaking to avoid cascading failures.**</span></span> <span data-ttu-id="b8db9-209">可能有一些情況中，暫時性或其他錯誤 (嚴重性範圍從部分的連線中斷到服務的完全失敗) 會花費比預期還長的時間才能返回正常狀態。</span><span class="sxs-lookup"><span data-stu-id="b8db9-209">There may be situations in which transient or other faults, ranging in severity from a partial loss of connectivity to the complete failure of a service, take much longer than expected to return to normal.</span></span> <span data-ttu-id="b8db9-210">，若服務非常忙碌，系統中某部分的失敗可能會導致連鎖性失敗，而造成許多作業在保存重要的系統資源 (例如記憶體、執行緒和資料庫連接) 時遭到封鎖。</span><span class="sxs-lookup"><span data-stu-id="b8db9-210">, if a service is very busy, failure in one part of the system may lead to cascading failures, and result in many operations becoming blocked while holding onto critical system resources such as memory, threads, and database connections.</span></span> <span data-ttu-id="b8db9-211">應用程式不會持續重試不太可能成功的作業，而是應該快速接受作業已失敗，且適當地處理這項失敗。</span><span class="sxs-lookup"><span data-stu-id="b8db9-211">Instead of continually retrying an operation that is unlikely to succeed, the application should quickly accept that the operation has failed, and gracefully handle this failure.</span></span> <span data-ttu-id="b8db9-212">請使用斷路器模式來拒絕在定義期間的特定作業要求。</span><span class="sxs-lookup"><span data-stu-id="b8db9-212">Use the Circuit Breaker pattern to reject requests for specific operations for defined periods.</span></span> <span data-ttu-id="b8db9-213">如需詳細資訊，請參閱[斷路器模式](../patterns/circuit-breaker.md)。</span><span class="sxs-lookup"><span data-stu-id="b8db9-213">For more information, see the [Circuit Breaker pattern](../patterns/circuit-breaker.md).</span></span>

<span data-ttu-id="b8db9-214">**撰寫或切換回多個元件。**</span><span class="sxs-lookup"><span data-stu-id="b8db9-214">**Compose or fall back to multiple components.**</span></span> <span data-ttu-id="b8db9-215">設計應用程式來使用多個執行個體，而不影響作業和現有的連線。</span><span class="sxs-lookup"><span data-stu-id="b8db9-215">Design applications to use multiple instances without affecting operation and existing connections where possible.</span></span> <span data-ttu-id="b8db9-216">使用多個執行個體並分散它們之間的要求，偵測並避免傳送要求給失敗的執行個體，藉以最大化可用性。</span><span class="sxs-lookup"><span data-stu-id="b8db9-216">Use multiple instances and distribute requests between them, and detect and avoid sending requests to failed instances, in order to maximize availability.</span></span>

<span data-ttu-id="b8db9-217">**切換回不同的服務或工作流程。**</span><span class="sxs-lookup"><span data-stu-id="b8db9-217">**Fall back to a different service or workflow.**</span></span> <span data-ttu-id="b8db9-218">例如，如果寫入至 SQL Database 失敗，請暫時將資料儲存在 Blob 儲存體或 Redis 快取中。</span><span class="sxs-lookup"><span data-stu-id="b8db9-218">For example, if writing to SQL Database fails, temporarily store data in blob storage or Redis Cache.</span></span> <span data-ttu-id="b8db9-219">服務可供使用時，請提供重新執行寫入至 SQL Database 的功能。</span><span class="sxs-lookup"><span data-stu-id="b8db9-219">Provide a way to replay the writes to SQL Database when the service becomes available.</span></span> <span data-ttu-id="b8db9-220">在某些情況下，失敗的作業可能會有替代動作，允許應用程式繼續運作，甚至是當元件或服務失敗時也可繼續運作。</span><span class="sxs-lookup"><span data-stu-id="b8db9-220">In some cases, a failed operation may have an alternative action that allows the application to continue to work even when a component or service fails.</span></span> <span data-ttu-id="b8db9-221">盡可能偵測失敗並將要求重新導向至其他可提供適當替代功能的服務，或者在主要服務離線時，備分或減少可維護核心作業的功能執行個體。</span><span class="sxs-lookup"><span data-stu-id="b8db9-221">If possible, detect failures and redirect requests to other services that can offer a suitable alternative functionality, or to back up or reduced functionality instances that can maintain core operations while the primary service is offline.</span></span>

## <a name="monitoring-and-disaster-recovery"></a><span data-ttu-id="b8db9-222">監視和災害復原</span><span class="sxs-lookup"><span data-stu-id="b8db9-222">Monitoring and disaster recovery</span></span>

<span data-ttu-id="b8db9-223">**為可能的失敗和失敗事件提供豐富的檢測** 以將情況回報給操作人員。</span><span class="sxs-lookup"><span data-stu-id="b8db9-223">**Provide rich instrumentation for likely failures and failure events** to report the situation to operations staff.</span></span> <span data-ttu-id="b8db9-224">為可能但尚未發生的失敗提供足夠的資料，以便作業人員判斷其原因，緩和情況，並確保系統仍然可用。</span><span class="sxs-lookup"><span data-stu-id="b8db9-224">For failures that are likely but have not yet occurred, provide sufficient data to enable operations staff to determine the cause, mitigate the situation, and ensure that the system remains available.</span></span> <span data-ttu-id="b8db9-225">對於已經發生的失敗，應用程式應該將適當的錯誤訊息傳回給使用者，雖然功能減少了，但仍嘗試繼續執行。</span><span class="sxs-lookup"><span data-stu-id="b8db9-225">For failures that have already occurred, the application should return an appropriate error message to the user but attempt to continue running, albeit with reduced functionality.</span></span> <span data-ttu-id="b8db9-226">在所有情況下，監視系統應該擷取完整的詳細資料，以便作業人員達成快速復原，並視需要讓設計人員和開發人員修改系統，以防止再次發生這個情況。</span><span class="sxs-lookup"><span data-stu-id="b8db9-226">In all cases, the monitoring system should capture comprehensive details to enable operations staff to effect a quick recovery, and if necessary, for designers and developers to modify the system to prevent the situation from arising again.</span></span>

<span data-ttu-id="b8db9-227">**實作檢查函數來監視系統健全狀況。**</span><span class="sxs-lookup"><span data-stu-id="b8db9-227">**Monitor system health by implementing checking functions.**</span></span> <span data-ttu-id="b8db9-228"> 應用程式的健全狀況和效能可能會在不同時間產生不明顯的降級，直到失敗為止。</span><span class="sxs-lookup"><span data-stu-id="b8db9-228">The health and performance of an application can degrade over time, without being noticeable until it fails.</span></span> <span data-ttu-id="b8db9-229">實作探查或檢查定期從應用程式外部執行的函數。</span><span class="sxs-lookup"><span data-stu-id="b8db9-229">Implement probes or check functions that are executed regularly from outside the application.</span></span> <span data-ttu-id="b8db9-230">這些檢查和測量整體應用程式、應用程式的個別部分、應用程式使用的個別服務、和個別元件的回應時間一樣簡單。</span><span class="sxs-lookup"><span data-stu-id="b8db9-230">These checks can be as simple as measuring response time for the application as a whole, for individual parts of the application, for individual services that the application uses, or for individual components.</span></span> <span data-ttu-id="b8db9-231">檢查函數可以執行程序，以確保它們會產生有效的結果、測量延遲及檢查可用性，並從系統中擷取資訊。</span><span class="sxs-lookup"><span data-stu-id="b8db9-231">Check functions can execute processes to ensure they produce valid results, measure latency and check availability, and extract information from the system.</span></span>

<span data-ttu-id="b8db9-232">**定期測試所有容錯移轉和後援系統。**</span><span class="sxs-lookup"><span data-stu-id="b8db9-232">**Regularly test all failover and fallback systems.**</span></span> <span data-ttu-id="b8db9-233">系統與作業的變更可能會影響容錯移轉和後援函數，但是在主要系統失敗或負載過重之前可能都無法偵測到影響。</span><span class="sxs-lookup"><span data-stu-id="b8db9-233">Changes to systems and operations may affect failover and fallback functions, but the impact may not be detected until the main system fails or becomes overloaded.</span></span> <span data-ttu-id="b8db9-234">在執行階段中必須彌補即時問題之前加以測試。</span><span class="sxs-lookup"><span data-stu-id="b8db9-234">Test it before it is required to compensate for a live problem at runtime.</span></span> <span data-ttu-id="b8db9-235">如果您使用 [Azure Site Recovery][site-recovery] 來複寫 VM，請定期進行測試容錯移轉，以執行災害復原演練。</span><span class="sxs-lookup"><span data-stu-id="b8db9-235">If you are using [Azure Site Recovery][site-recovery] to replicate VMs, run disaster recovery drills periodically by doing a test failover.</span></span> <span data-ttu-id="b8db9-236">如需詳細資訊，請參閱[執行 Azure 的災害復原演練][site-recovery-test]。</span><span class="sxs-lookup"><span data-stu-id="b8db9-236">For more information, see [Run a disaster recovery drill to Azure][site-recovery-test].</span></span>

<span data-ttu-id="b8db9-237">**測試監視系統。**</span><span class="sxs-lookup"><span data-stu-id="b8db9-237">**Test the monitoring systems.**</span></span> <span data-ttu-id="b8db9-238"> 自動化的容錯移轉和後援系統，以及使用儀表板手動進行系統健全狀況和效能視覺化，都取決於正常運作的監視和檢測。</span><span class="sxs-lookup"><span data-stu-id="b8db9-238">Automated failover and fallback systems, and manual visualization of system health and performance by using dashboards, all depend on monitoring and instrumentation functioning correctly.</span></span> <span data-ttu-id="b8db9-239">如果這些項目失敗，遺漏重要資訊或回報不正確的資料，操作人員可能不知道系統是狀況不良還是失敗。</span><span class="sxs-lookup"><span data-stu-id="b8db9-239">If these elements fail, miss critical information, or report inaccurate data, an operator might not realize that the system is unhealthy or failing.</span></span>

<span data-ttu-id="b8db9-240">**追蹤長時間執行之工作流程的進度，並在失敗時重試。**</span><span class="sxs-lookup"><span data-stu-id="b8db9-240">**Track the progress of long-running workflows and retry on failure.**</span></span> <span data-ttu-id="b8db9-241">長時間執行的工作流程通常以多個步驟組成。</span><span class="sxs-lookup"><span data-stu-id="b8db9-241">Long-running workflows are often composed of multiple steps.</span></span> <span data-ttu-id="b8db9-242">請確定每個步驟都是獨立且可以重試的，以將整個工作流程都必須回復的機會，或必須執行多個補償交易的機會降到最低。</span><span class="sxs-lookup"><span data-stu-id="b8db9-242">Ensure that each step is independent and can be retried to minimize the chance that the entire workflow will need to be rolled back, or that multiple compensating transactions need to be executed.</span></span> <span data-ttu-id="b8db9-243">藉由實作模式 (例如 [排程器代理程式監督員模式](../patterns/scheduler-agent-supervisor.md)) 監視並管理長時間執行之工作流程的進度。</span><span class="sxs-lookup"><span data-stu-id="b8db9-243">Monitor and manage the progress of long-running workflows by implementing a pattern such as [Scheduler Agent Supervisor pattern](../patterns/scheduler-agent-supervisor.md).</span></span>

<span data-ttu-id="b8db9-244">**規劃災害復原。**</span><span class="sxs-lookup"><span data-stu-id="b8db9-244">**Plan for disaster recovery.**</span></span> <span data-ttu-id="b8db9-245">建立從可能影響系統可用性的任何類型失敗復原的可接受、經完整測試的方案。</span><span class="sxs-lookup"><span data-stu-id="b8db9-245">Create an accepted, fully-tested plan for recovery from any type of failure that may affect system availability.</span></span> <span data-ttu-id="b8db9-246">選擇任何關鍵任務應用程式的多站台災害復原架構。</span><span class="sxs-lookup"><span data-stu-id="b8db9-246">Choose a multi-site disaster recovery architecture for any mission-critical applications.</span></span> <span data-ttu-id="b8db9-247">識別災害復原方案的特定擁有者，包括自動化和測試。</span><span class="sxs-lookup"><span data-stu-id="b8db9-247">Identify a specific owner of the disaster recovery plan, including automation and testing.</span></span> <span data-ttu-id="b8db9-248">確保方案完善記載，並盡可能讓程序自動化。</span><span class="sxs-lookup"><span data-stu-id="b8db9-248">Ensure the plan is well-documented, and automate the process as much as possible.</span></span> <span data-ttu-id="b8db9-249">為所有參考和交易資料建立備份策略，然後定期測試這些備份的還原。</span><span class="sxs-lookup"><span data-stu-id="b8db9-249">Establish a backup strategy for all reference and transactional data, and test the restoration of these backups regularly.</span></span> <span data-ttu-id="b8db9-250">訓練作業人員執行方案，並執行常態性災害模擬，以驗證並改善方案。</span><span class="sxs-lookup"><span data-stu-id="b8db9-250">Train operations staff to execute the plan, and perform regular disaster simulations to validate and improve the plan.</span></span> <span data-ttu-id="b8db9-251">如果您使用 [Azure Site Recovery][site-recovery] 來複寫 VM，請建立完全自動化的復原方案，以在數分鐘內容錯移轉整個應用程式。</span><span class="sxs-lookup"><span data-stu-id="b8db9-251">If you are using [Azure Site Recovery][site-recovery] to replicate VMs, create a fully automated recovery plan to failover the entire application within minutes.</span></span>

<!-- links -->
[availability-sets]:/azure/virtual-machines/virtual-machines-windows-manage-availability/
[site-recovery]: /azure/site-recovery/
[site-recovery-test]: /azure/site-recovery/site-recovery-test-failover-to-azure
