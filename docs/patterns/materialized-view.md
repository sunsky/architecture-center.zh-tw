---
title: 具體化檢視模式
titleSuffix: Cloud Design Patterns
description: 當資料格式對必要的查詢作業而言不理想時，對一或多個資料存放區中的資料產生預先填入的檢視。
keywords: 設計模式
author: dragon119
ms.date: 06/23/2017
ms.topic: design-pattern
ms.service: architecture-center
ms.subservice: cloud-fundamentals
ms.custom: seodec18
ms.openlocfilehash: 638c4cacfba3f170fdf1c967d783d60c8c6c6b6f
ms.sourcegitcommit: 1b50810208354577b00e89e5c031b774b02736e2
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/23/2019
ms.locfileid: "54481243"
---
# <a name="materialized-view-pattern"></a><span data-ttu-id="a6a3d-104">具體化檢視模式</span><span class="sxs-lookup"><span data-stu-id="a6a3d-104">Materialized View pattern</span></span>

[!INCLUDE [header](../_includes/header.md)]

<span data-ttu-id="a6a3d-105">當資料格式對必要的查詢作業而言不理想時，對一或多個資料存放區中的資料產生預先填入的檢視。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-105">Generate prepopulated views over the data in one or more data stores when the data isn't ideally formatted for required query operations.</span></span> <span data-ttu-id="a6a3d-106">這可以協助支援人員有效進行查詢和資料擷取，並改善應用程式效能。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-106">This can help support efficient querying and data extraction, and improve application performance.</span></span>

## <a name="context-and-problem"></a><span data-ttu-id="a6a3d-107">內容和問題</span><span class="sxs-lookup"><span data-stu-id="a6a3d-107">Context and problem</span></span>

<span data-ttu-id="a6a3d-108">儲存資料時，開發人員和資料管理員的優先順序通常專注於資料儲存的方式，而不是讀取資料的方式。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-108">When storing data, the priority for developers and data administrators is often focused on how the data is stored, as opposed to how it's read.</span></span> <span data-ttu-id="a6a3d-109">所選儲存體格式通常與資料的格式、管理資料大小和資料完整性的需求，以及使用中存放區的類型密切相關。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-109">The chosen storage format is usually closely related to the format of the data, requirements for managing data size and data integrity, and the kind of store in use.</span></span> <span data-ttu-id="a6a3d-110">比方說，使用 NoSQL 文件存放區時，資料通常呈現為一系列的彙總，每一個都會包含該實體的所有資訊。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-110">For example, when using NoSQL document store, the data is often represented as a series of aggregates, each containing all of the information for that entity.</span></span>

<span data-ttu-id="a6a3d-111">不過，這對查詢會有負面影響。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-111">However, this can have a negative effect on queries.</span></span> <span data-ttu-id="a6a3d-112">如果查詢只需要來自某些實體的資料子集，例如：數個客戶的訂單摘要 (而不需要訂單的所有詳細資料)，它必須擷取相關實體的所有資料，才能取得所需的資訊。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-112">When a query only needs a subset of the data from some entities, such as a summary of orders for several customers without all of the order details, it must extract all of the data for the relevant entities in order to obtain the required information.</span></span>

## <a name="solution"></a><span data-ttu-id="a6a3d-113">解決方法</span><span class="sxs-lookup"><span data-stu-id="a6a3d-113">Solution</span></span>

<span data-ttu-id="a6a3d-114">為了支援有效率的查詢，一般會預先產生將資料以適合所需結果集的格式具體化的檢視。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-114">To support efficient querying, a common solution is to generate, in advance, a view that materializes the data in a format suited to the required results set.</span></span> <span data-ttu-id="a6a3d-115">具體化檢視模式描述在下列環境中產生預先填入的資料檢視：當來源資料格式不適合查詢時、要產生合適的查詢很困難時，或是由於資料或資料存放區的本質查詢效能不佳時。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-115">The Materialized View pattern describes generating prepopulated views of data in environments where the source data isn't in a suitable format for querying, where generating a suitable query is difficult, or where query performance is poor due to the nature of the data or the data store.</span></span>

<span data-ttu-id="a6a3d-116">這些只包含查詢所需資料的具體化檢視，可讓應用程式快速取得所需的資訊。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-116">These materialized views, which only contain data required by a query, allow applications to quickly obtain the information they need.</span></span> <span data-ttu-id="a6a3d-117">為了聯結資料表或結合資料實體，具體化檢視可以包含目前計算的資料行或資料項目的值、結合值或對資料項目執行轉換的結果，以及指定為查詢一部分的值。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-117">In addition to joining tables or combining data entities, materialized views can include the current values of calculated columns or data items, the results of combining values or executing transformations on the data items, and values specified as part of the query.</span></span> <span data-ttu-id="a6a3d-118">具體化檢視甚至可以只為單一查詢最佳化。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-118">A materialized view can even be optimized for just a single query.</span></span>

<span data-ttu-id="a6a3d-119">重點是，具體化檢視和它所包含的資料完全可處置，因為資料完全可以從來源資料存放區重建。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-119">A key point is that a materialized view and the data it contains is completely disposable because it can be entirely rebuilt from the source data stores.</span></span> <span data-ttu-id="a6a3d-120">具體化檢視絕不會直接由應用程式更新，因此它是特製的快取。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-120">A materialized view is never updated directly by an application, and so it's a specialized cache.</span></span>

<span data-ttu-id="a6a3d-121">當檢視的來源資料變更時，必須更新檢視，以包含新的資訊。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-121">When the source data for the view changes, the view must be updated to include the new information.</span></span> <span data-ttu-id="a6a3d-122">您可以將此動作排程為自動發生，或是在系統偵測到對原始資料的變更時發生。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-122">You can schedule this to happen automatically, or when the system detects a change to the original data.</span></span> <span data-ttu-id="a6a3d-123">在某些情況下可能需要手動重新產生檢視。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-123">In some cases it might be necessary to regenerate the view manually.</span></span> <span data-ttu-id="a6a3d-124">此圖顯示如何使用具體化檢視模式的範例。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-124">The figure shows an example of how the Materialized View pattern might be used.</span></span>

![圖 1 顯示如何使用具體化檢視模式的範例](./_images/materialized-view-pattern-diagram.png)

## <a name="issues-and-considerations"></a><span data-ttu-id="a6a3d-126">問題和考量</span><span class="sxs-lookup"><span data-stu-id="a6a3d-126">Issues and considerations</span></span>

<span data-ttu-id="a6a3d-127">當您決定如何實作此模式時，請考慮下列幾點：</span><span class="sxs-lookup"><span data-stu-id="a6a3d-127">Consider the following points when deciding how to implement this pattern:</span></span>

<span data-ttu-id="a6a3d-128">如何及何時會更新檢視。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-128">How and when the view will be updated.</span></span> <span data-ttu-id="a6a3d-129">在理想情況下，它會重新產生以回應指出對來源資料變更的事件，不過，如果來源資料快速變更，這可能會導致過多的額外負荷。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-129">Ideally it'll regenerate in response to an event indicating a change to the source data, although this can lead to excessive overhead if the source data changes rapidly.</span></span> <span data-ttu-id="a6a3d-130">或者，請考慮使用排程的工作、外部觸發程序或手動動作來重新產生檢視。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-130">Alternatively, consider using a scheduled task, an external trigger, or a manual action to regenerate the view.</span></span>

<span data-ttu-id="a6a3d-131">在某些系統上，例如使用事件來源模式來維護僅修改資料的事件存放區時，具體化檢視即為必要。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-131">In some systems, such as when using the Event Sourcing pattern to maintain a store of only the events that modified the data, materialized views are necessary.</span></span> <span data-ttu-id="a6a3d-132">藉由檢查所有事件以預先填入檢視，判斷目前的狀態，可能是從事件存放區取得資訊的唯一方式。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-132">Prepopulating views by examining all events to determine the current state might be the only way to obtain information from the event store.</span></span> <span data-ttu-id="a6a3d-133">如果您不使用事件來源，必須考慮具體化檢視是否有幫助。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-133">If you're not using Event Sourcing, you need to consider whether a materialized view is helpful or not.</span></span> <span data-ttu-id="a6a3d-134">具體化檢視通常專為一個或少數查詢量身訂做。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-134">Materialized views tend to be specifically tailored to one, or a small number of queries.</span></span> <span data-ttu-id="a6a3d-135">如果使用許多查詢，具體化檢視可能導致無法接受的儲存體容量需求及儲存體成本。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-135">If many queries are used, materialized views can result in unacceptable storage capacity requirements and storage cost.</span></span>

<span data-ttu-id="a6a3d-136">如果問題發生在排程時，於產生檢視以及更新檢視時，請考量對資料一致性的影響。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-136">Consider the impact on data consistency when generating the view, and when updating the view if this occurs on a schedule.</span></span> <span data-ttu-id="a6a3d-137">如果來源資料是在產生檢視時變更，檢視中的資料的副本與原始資料不會完全一致。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-137">If the source data is changing at the point when the view is generated, the copy of the data in the view won't be fully consistent with the original data.</span></span>

<span data-ttu-id="a6a3d-138">考慮您要在其中儲存檢視的位置。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-138">Consider where you'll store the view.</span></span> <span data-ttu-id="a6a3d-139">檢視不一定要位於與原始資料相同的存放區或磁碟分割。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-139">The view doesn't have to be located in the same store or partition as the original data.</span></span> <span data-ttu-id="a6a3d-140">它可以是來自幾個不同的分割合併的子集。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-140">It can be a subset from a few different partitions combined.</span></span>

<span data-ttu-id="a6a3d-141">如果檢視遺失，可以重建檢視。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-141">A view can be rebuilt if lost.</span></span> <span data-ttu-id="a6a3d-142">因此，如果檢視是暫時性且僅用於透過反映資料的目前狀態來改善查詢效能，或用於改善延展性，則可以將它儲存在快取或在較不可靠的位置。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-142">Because of that, if the view is transient and is only used to improve query performance by reflecting the current state of the data, or to improve scalability, it can be stored in a cache or in a less reliable location.</span></span>

<span data-ttu-id="a6a3d-143">定義具體化檢視時，根據現有資料項目的計算或轉換、根據在查詢中傳遞的值，或根據這些值的組合 (適當時) 來將資料項目或資料行新增至該檢視，將其價值最大化。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-143">When defining a materialized view, maximize its value by adding data items or columns to it based on computation or transformation of existing data items, on values passed in the query, or on combinations of these values when appropriate.</span></span>

<span data-ttu-id="a6a3d-144">在儲存機制支援時，請考慮將具體化檢視建立索引，以進一步提高效能。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-144">Where the storage mechanism supports it, consider indexing the materialized view to further increase performance.</span></span> <span data-ttu-id="a6a3d-145">大部分關聯式資料庫支援對檢視建立索引，根據 Apache Hadoop 的巨量資料解決方案也一樣。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-145">Most relational databases support indexing for views, as do big data solutions based on Apache Hadoop.</span></span>

## <a name="when-to-use-this-pattern"></a><span data-ttu-id="a6a3d-146">使用此模式的時機</span><span class="sxs-lookup"><span data-stu-id="a6a3d-146">When to use this pattern</span></span>

<span data-ttu-id="a6a3d-147">此模式在下列情況中非常有用：</span><span class="sxs-lookup"><span data-stu-id="a6a3d-147">This pattern is useful when:</span></span>

- <span data-ttu-id="a6a3d-148">對難以直接查詢的資料，或查詢非常複雜而無法擷取以標準化、半結構化或非結構化方式儲存的資料建立具體化檢視。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-148">Creating materialized views over data that's difficult to query directly, or where queries must be very complex to extract data that's stored in a normalized, semi-structured, or unstructured way.</span></span>
- <span data-ttu-id="a6a3d-149">建立暫存檢視可以大幅改善查詢效能，或可直接作為 UI、報告或顯示的來源檢視或資料傳輸物件。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-149">Creating temporary views that can dramatically improve query performance, or can act directly as source views or data transfer objects for the UI, for reporting, or for display.</span></span>
- <span data-ttu-id="a6a3d-150">支援對資料存放區的連接不一定可用、偶爾會連接或中斷連接的情節。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-150">Supporting occasionally connected or disconnected scenarios where connection to the data store isn't always available.</span></span> <span data-ttu-id="a6a3d-151">在此情況下，可以在本機快取檢視。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-151">The view can be cached locally in this case.</span></span>
- <span data-ttu-id="a6a3d-152">以不需要知道來源資料格式的方式，為實驗簡化查詢並公開資料。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-152">Simplifying queries and exposing data for experimentation in a way that doesn't require knowledge of the source data format.</span></span> <span data-ttu-id="a6a3d-153">例如，透過聯結一個或多個資料庫中的不同資料表，或是 NoSQL 存放區中的一或多個網域，然後設定資料格式以符合其最終使用方式。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-153">For example, by joining different tables in one or more databases, or one or more domains in NoSQL stores, and then formatting the data to fit its eventual use.</span></span>
- <span data-ttu-id="a6a3d-154">針對安全性或隱私權的理由，提供不應該普遍可供存取、開放修改或完全公開給使用者的來源資料特定子集的存取。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-154">Providing access to specific subsets of the source data that, for security or privacy reasons, shouldn't be generally accessible, open to modification, or fully exposed to users.</span></span>
- <span data-ttu-id="a6a3d-155">橋接不同的資料存放區，以利用其個別的功能。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-155">Bridging different data stores, to take advantage of their individual capabilities.</span></span> <span data-ttu-id="a6a3d-156">例如，使用足以寫入的雲端存放區作為參考資料存放區，以及使用提供良好查詢和讀取效能的關聯式資料庫來保存具體化檢視。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-156">For example, using a cloud store that's efficient for writing as the reference data store, and a relational database that offers good query and read performance to hold the materialized views.</span></span>

<span data-ttu-id="a6a3d-157">此模式在下列情況下不是很有用：</span><span class="sxs-lookup"><span data-stu-id="a6a3d-157">This pattern isn't useful in the following situations:</span></span>

- <span data-ttu-id="a6a3d-158">來源資料簡單並容易查詢。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-158">The source data is simple and easy to query.</span></span>
- <span data-ttu-id="a6a3d-159">來源資料變更快速，或不使用檢視就能存取。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-159">The source data changes very quickly, or can be accessed without using a view.</span></span> <span data-ttu-id="a6a3d-160">在這些情況下，您應該避免建立檢視的處理負擔。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-160">In these cases, you should avoid the processing overhead of creating views.</span></span>
- <span data-ttu-id="a6a3d-161">一致性是高優先順序。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-161">Consistency is a high priority.</span></span> <span data-ttu-id="a6a3d-162">檢視不一定都與原始資料完全一致。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-162">The views might not always be fully consistent with the original data.</span></span>

## <a name="example"></a><span data-ttu-id="a6a3d-163">範例</span><span class="sxs-lookup"><span data-stu-id="a6a3d-163">Example</span></span>

<span data-ttu-id="a6a3d-164">下圖顯示使用具體化檢視模式來產生銷售摘要的範例。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-164">The following figure shows an example of using the Materialized View pattern to generate a summary of sales.</span></span> <span data-ttu-id="a6a3d-165">Azure 儲存體帳戶中個別分割中 Order、OrderItem 和 Customer 資料表中的資料會結合，以便產生檢視，其中包含在 Electronics 類別中每個產品的總銷售值，以及對每個項目進行購買之客戶數目的計數。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-165">Data in the Order, OrderItem, and Customer tables in separate partitions in an Azure storage account are combined to generate a view containing the total sales value for each product in the Electronics category, along with a count of the number of customers who made purchases of each item.</span></span>

![圖 2：使用具體化檢視模式來產生銷售摘要](./_images/materialized-view-summary-diagram.png)

<span data-ttu-id="a6a3d-167">建立此具體化檢視需要複雜的查詢。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-167">Creating this materialized view requires complex queries.</span></span> <span data-ttu-id="a6a3d-168">不過，藉由以具體化檢視的形式公開查詢的結果，使用者可以輕鬆地取得結果，並直接使用它們或在另一個查詢中將它們併入。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-168">However, by exposing the query result as a materialized view, users can easily obtain the results and use them directly or incorporate them in another query.</span></span> <span data-ttu-id="a6a3d-169">檢視可能會用於報告系統或儀表板，並可以根據排程來更新 (例如每週)。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-169">The view is likely to be used in a reporting system or dashboard, and can be updated on a scheduled basis such as weekly.</span></span>

> <span data-ttu-id="a6a3d-170">雖然此範例會利用 Azure 資料表儲存體，許多關聯式資料庫管理系統也為具體化檢視提供原生支援。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-170">Although this example utilizes Azure table storage, many relational database management systems also provide native support for materialized views.</span></span>

## <a name="related-patterns-and-guidance"></a><span data-ttu-id="a6a3d-171">相關的模式和指導方針</span><span class="sxs-lookup"><span data-stu-id="a6a3d-171">Related patterns and guidance</span></span>

<span data-ttu-id="a6a3d-172">實作此模式時，下列模式和指導方針可能也相關：</span><span class="sxs-lookup"><span data-stu-id="a6a3d-172">The following patterns and guidance might also be relevant when implementing this pattern:</span></span>

- <span data-ttu-id="a6a3d-173">[資料一致性入門](https://msdn.microsoft.com/library/dn589800.aspx)。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-173">[Data Consistency Primer](https://msdn.microsoft.com/library/dn589800.aspx).</span></span> <span data-ttu-id="a6a3d-174">必須維護具體化檢視中的摘要資訊，使得它能夠反映基礎資料值。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-174">The summary information in a materialized view has to be maintained so that it reflects the underlying data values.</span></span> <span data-ttu-id="a6a3d-175">當資料值變更時，即時更新摘要資料可能不夠實際，而相反地，您就必須採用最終一致的方法。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-175">As the data values change, it might not be practical to update the summary data in real time, and instead you'll have to adopt an eventually consistent approach.</span></span> <span data-ttu-id="a6a3d-176">摘要說明維護分散式資料一致性的相關問題，並說明不同的一致性模型的優點和權衡取捨。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-176">Summarizes the issues surrounding maintaining consistency over distributed data, and describes the benefits and tradeoffs of different consistency models.</span></span>
- <span data-ttu-id="a6a3d-177">[命令與查詢責任隔離 (CQRS) 模式](./cqrs.md)。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-177">[Command and Query Responsibility Segregation (CQRS) pattern](./cqrs.md).</span></span> <span data-ttu-id="a6a3d-178">用來透過回應基礎資料值變更時發生的事件，更新具體化檢視中的資訊。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-178">Use to update the information in a materialized view by responding to events that occur when the underlying data values change.</span></span>
- <span data-ttu-id="a6a3d-179">[事件來源模式](./event-sourcing.md)。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-179">[Event Sourcing pattern](./event-sourcing.md).</span></span> <span data-ttu-id="a6a3d-180">搭配 CQRS 模式使用，以維護具體化檢視中的資訊。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-180">Use in conjunction with the CQRS pattern to maintain the information in a materialized view.</span></span> <span data-ttu-id="a6a3d-181">當具體化檢視依據的資料值變更時，系統就可以引發事件，說明這些變更並將它們儲存在事件存放區。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-181">When the data values a materialized view is based on are changed, the system can raise events that describe these changes and save them in an event store.</span></span>
- <span data-ttu-id="a6a3d-182">[索引表格模式](./index-table.md)。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-182">[Index Table pattern](./index-table.md).</span></span> <span data-ttu-id="a6a3d-183">具體化檢視中的資料通常依照主索引鍵組織，但查詢可能需要藉由檢查其他欄位中的資料，從此檢視擷取資訊。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-183">The data in a materialized view is typically organized by a primary key, but queries might need to retrieve information from this view by examining data in other fields.</span></span> <span data-ttu-id="a6a3d-184">用來對不支援原生次要索引之資料存放區的資料集建立次要索引。</span><span class="sxs-lookup"><span data-stu-id="a6a3d-184">Use to create secondary indexes over data sets for data stores that don't support native secondary indexes.</span></span>
