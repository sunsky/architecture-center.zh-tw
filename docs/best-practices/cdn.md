---
title: 內容傳遞網路指導
description: 內容傳遞網路 (CDN) 的指引，目的是傳遞 Azure 中裝載的高頻寬內容。
author: dragon119
ms.date: 02/02/2018
pnp.series.title: Best Practices
ms.openlocfilehash: 9805b1b6df8cedd7668eb9e85f741ee81c3dfa58
ms.sourcegitcommit: 94d50043db63416c4d00cebe927a0c88f78c3219
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/28/2018
ms.locfileid: "47428885"
---
# <a name="best-practices-for-using-content-delivery-networks-cdns"></a>使用內容傳遞網路 (CDN) 的最佳作法

內容傳遞網路 (CDN) 是可以有效率地將 Web 內容傳遞給使用者的分散式伺服器網路。 CDN 會將快取的內容儲存在使用者附近的邊緣伺服器，以將延遲降至最低。 

CDN 通常用來傳遞靜態內容，例如影像、樣式表、文件、檔案、用戶端指令碼和 HTML 頁面。 使用 CDN 的主要優點是較低的延遲及更快將內容傳遞給使用者，而與裝載應用程式的資料中心的地理位置無關。 CDN 也有助於降低 Web 應用程式的負載，因為此類應用程式不需要處理對 CDN 所裝載的內容提出的要求。
 
![CDN 圖表](./images/cdn/CDN.png)

在 Azure 中，[Azure 內容傳遞網路](/azure/cdn/cdn-overview)是一個全域 CDN 解決方案，可提供裝載在 Azure 或任何其他位置中的高頻寬內容。 使用 Azure CDN 可讓您快取從 Azure Blob 儲存體、Web 應用程式、虛擬機器、任何可公開存取的 Web 伺服器載入的公用物件。 

本主題說明使用 CDN 時的一般最佳作法和考量事項。 若要深入了解如何使用 Azure CDN，請參閱 [CDN 文件](/azure/cdn/)。

## <a name="how-and-why-a-cdn-is-used"></a>如何及為何使用 CDN

CDN 的典型用法包括：  

* 傳遞用戶端應用程式的靜態資源，通常是來自網站。 這些資源可以是映像、樣式表、文件、檔案、用戶端指令碼、HTML 頁面、HTML 片段，或伺服器不需要為每個要求修改的任何其他內容。 應用程式可在執行階段建立項目，並讓 CDN 使用它們 (例如，藉由建立目前頭條新聞清單)，但它不會為每個要求這麼做。
* 將公用靜態和共用內容傳遞給裝置，例如行動電話和平板電腦。 應用程式本身是一個 Web 服務，可將 API 提供給執行於各種裝置的用戶端。 CDN 也可以傳遞靜態資料集 (透過 Web 服務) 供用戶端使用，或許用來產生用戶端 UI。 例如，CDN 可用來散發 JSON 或 XML 文件。
* 讓用戶端使用僅包含公用靜態內容的整個網站，而不需要任何專用的計算資源。
* 視需要將視訊檔案串流到用戶端。 視訊可從提供 CDN 連接的全球資料中心，獲得低延遲和可靠連線的好處。 Microsoft Azure 媒體服務 (AMS) 會與 Azure CDN 整合，直接提供內容給 CDN，以進行進一步的發佈。 如需詳細資訊，請參閱[串流端點概觀](/azure/media-services/media-services-streaming-endpoints-overview)。
* 一般可改善使用者體驗，特別是與裝載應用程式的資料中心相距較遠的使用者。 這些使用者可能會遭遇到較高的延遲。 Web 應用程式中內容的總大小大都是靜態的，且使用 CDN 有助於維護效能和整體使用者體驗，同時不需要將應用程式部署到多個資料中心。 如需 Azure CDN 節點位置清單，請參閱 [Azure CDN POP 位置](/azure/cdn/cdn-pop-locations/)。
* 支援 IoT (物聯網) 解決方案。 如果需要直接將韌體更新散發到每個裝置，與 IoT 解決方案有關的裝置和設備數量極為龐大，可能會輕易導致應用程式無法因應。
* 處理尖峰和偶發性需求而不需應用程式調整，避免後續增加營運成本。 例如，針對硬體裝置 (例如特定型號的路由器) 或消費性裝置 (例如智慧型電視) 發行作業系統的更新時，如果數以百萬的使用者和裝置在短期間內下載更新，則可能會視需要產生龐大的尖峰量。

## <a name="challenges"></a>挑戰

計劃使用 CDN 時必須考量幾項挑戰。  

* **部署**。 決定 CDN 將從中提取內容的原點，及是否需要將內容部署到多個儲存體系統中。 請將部署靜態內容和資源的程序納入考量。 比方說，您可能需要實作個別的步驟，才能將內容載入 Azure blob 儲存體。
* **版本控制和快取控制**。 考慮如何更新靜態內容和部署新版本。 請了解 CDN 執行快取和存留時間 (TTL) 的方式。 如需 Azure CDN 的相關資訊，請參閱[快取的運作方式](/azure/cdn/cdn-how-caching-works)。
* **測試**。 在本機或在預備環境中開發和測試應用程式時，很難為 CDN 設定執行本機測試。
* **搜尋引擎最佳化 (SEO)**。 當您使用 CDN 時，如影像和文件等內容皆由不同的網域服務。 這可能會影響此內容的 SEO。
* **內容安全性**。 並非所有的 CDN 皆提供任何形式的內容存取控制。 有些 CDN 服務 (包括 Azure CDN) 支援以權杖型驗證保護 CDN 內容。 如需詳細資訊，請參閱[使用權杖驗證來保護 Azure 內容傳遞網路資產](/azure/cdn/cdn-token-auth)。
* **用戶端安全性**。 用戶端可從不允許存取 CDN 上資源的環境中連接。 這可能是安全性限制的環境，限制只能存取一組已知來源，或防止從原始頁面以外的任何位置載入資源的環境。 需要後援實作，才能處理這些情況。
* **恢復功能**。 CDN 是應用程式的潛在單一失敗點。 

CDN 較沒有用的案例括：  

* 如果內容點擊率偏低，該內容在有效期間 (由其存留時間設定值決定) 可能僅被存取數次。 
* 如果資料是私人的，例如適用於大型企業或供應鏈生態系統。

## <a name="general-guidelines-and-good-practices"></a>一般方針和最佳做法

使用 CDN 是最小化應用程式負載，及最大化可用性與效能的好方法。 為應用程式使用的所有適當內容和資源，考慮採用此策略。 設計使用 CDN 的策略時，請考量以下幾節中的要點。

### <a name="deployment"></a>部署
如果您未在應用程式部署封裝或程序中包含靜態內容，該靜態內容可能需要與應用程式分開佈建和部署。 請思考這會如何影響版本控制方法，也就是您用於管理應用程式元件和靜態資源內容的方法。

請考慮使用統合和縮製技術，以縮短用戶端的載入時間。 統合可將多個檔案合併成單一檔案。 縮製可在不變更功能的情況下，從指令碼和 CSS 檔案中移除非必要的字元。

如果您需要將內容部署到其他位置，這會是部署程序中的額外步驟。 如果應用程式更新 CDN 的內容 (或許是固定間隔或為了回應事件)，它必須將更新的內容儲存於任何其他位置，以及 CDN 的端點。

請考量在預期 CDN 會提供部分靜態內容時，您應如何處理本機開發和測試。 例如，您可以將內容預先部署至 CDN，作為建置指令碼的一部分。 或者，您可以使用編譯指示詞或旗標，控制應用程式載入資源的方式。 例如，在偵錯模式中，應用程式可能會從本機資料夾載入靜態資源。 在發行模式中，應用程式會使用 CDN。

請考慮使用檔案壓縮的選項，例如 gzip (GNU zip)。 壓縮可在來源伺服器上由裝載的 Web 應用程式執行，或是直接在邊緣伺服器上由 CDN 執行。 如需詳細資訊，請參閱[在 Azure CDN 中壓縮檔案以改善效能](/azure/cdn/cdn-improve-performance)。


### <a name="routing-and-versioning"></a>路由和版本控制
您可能需要在不同時間使用不同的 CDN 執行個體。 例如，當您部署新版的應用程式時，可能會想要使用新的 CDN，並保留舊的 CDN (以適用於舊版的舊格式保存內容)。 如果您將 Azure Blob 儲存體作為內容的原點，可以建立個別的儲存體帳戶或個別的容器，並將 CDN 端點指向它。 

請勿使用查詢字串來表示 CDN 上資源連結中不同版本的應用程式，因為從 Azure Blob 儲存體擷取內容時，查詢字串為資源名稱 (Blob 名稱) 的一部分。 此方法也會影響用戶端快取資源的方式。

若是在 CDN 上快取先前的資源，則在部署新版本的靜態內容時，更新應用程式可能是一項挑戰。 如需詳細資訊，請參閱以下與快取控制有關的小節。

請考慮依國家/地區限制 CDN 內容存取。 Azure CDN 可以讓您根據來源的國家/地區來篩選要求，並限制傳遞的內容。 如需詳細資訊，請參閱[依國家/地區限制對內容的存取](/azure/cdn/cdn-restrict-access-by-country/)。

### <a name="cache-control"></a>快取控制
請考量如何管理系統內的快取。 例如，在 Azure CDN 中，您可以設定全域快取規則，然後為特定的來源端點設定自訂快取。 您也可以在來源傳送快取指示詞標頭，以控制在 CDN 中執行快取的方式。 

如需詳細資訊，請參閱[快取的運作方式](/azure/cdn/cdn-how-caching-works)。

若要防止在 CDN 上使用物件，您可以從來源加以刪除、移除或刪除 CDN 端點，或在使用 Blob 儲存體的情況下，讓容器或 Blob 變成私用。 不過，只有在存留時間到期後，才會移除項目。 您也可以手動清除 CDN 端點。

### <a name="security"></a>安全性

CDN 可以使用 CDN 所提供的憑證，透過 HTTPS (SSL) 傳遞內容，也可以透過 HTTP。 為了避免瀏覽器發出混合內容警告，您最好使用 HTTPS，要求透過 HTTPS 載入的頁面所顯示的靜態內容。

使用 CDN 傳遞靜態資產時 (如字型檔案)，如果使用 *XMLHttpRequest* 呼叫要求不同網域中的這些資源，可能會遇到相同來源原則問題。 許多網頁瀏覽器會防止跨原始來源資源分享 (CORS)，除非網頁伺服器已設定適當的回應標頭。 使用下列方法之一可以設定 CDN 支援 CORS：

* 使用 CDN 以將 CORS 標頭新增至回應。 如需詳細資訊，請參閱[搭配使用 Azure CDN 與 CORS](/azure/cdn/cdn-cors)。 
* 如果來源是 Azure Blob 儲存體，請將 CORS 規則新增至儲存體端點。 如需詳細資訊，請參閱 [跨原始資源共用 (CORS) 支援 Azure 儲存體服務](/rest/api/storageservices/Cross-Origin-Resource-Sharing--CORS--Support-for-the-Azure-Storage-Services)。
* 設定應用程式以設定 CORS 標頭。 如需範例，請參閱 ASP.NET Core 文件中的[啟用跨源要求 (CORS)](/aspnet/core/security/cors)。

### <a name="cdn-fallback"></a>CDN 後援
考量應用程式如何處理 CDN 失敗或暫時無法使用。 如果無法使用 CDN，用戶端應用程式可使用前一個要求期間的本機快取資源複本 (位於用戶端)，或者可以加入程式碼來偵測失敗，而非從原點要求資源 (應用程式資料夾或佔用資源的 Azure Blob 容器)。
