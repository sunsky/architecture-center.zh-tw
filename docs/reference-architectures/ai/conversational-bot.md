---
title: 組建企業級交談式聊天機器人
description: 如何使用 Azure Bot Framework 組建企業級交談式聊天機器人。
author: roalexan
ms.date: 01/24/2019
ms.topic: reference-architecture
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: azcat-ai
ms.openlocfilehash: caee864285a03affa43739317d1c4c6fd2131450
ms.sourcegitcommit: 579c39ff4b776704ead17a006bf24cd4cdc65edd
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/17/2019
ms.locfileid: "59640629"
---
# <a name="enterprise-grade-conversational-bot"></a><span data-ttu-id="5a047-103">企業級交談式聊天機器人</span><span class="sxs-lookup"><span data-stu-id="5a047-103">Enterprise-grade conversational bot</span></span>

<span data-ttu-id="5a047-104">此參考架構說明如何使用 [Azure Bot Framework][bot-framework] 組建企業級交談式聊天機器人。</span><span class="sxs-lookup"><span data-stu-id="5a047-104">This reference architecture describes how to build an enterprise-grade conversational bot (chatbot) using the [Azure Bot Framework][bot-framework].</span></span> <span data-ttu-id="5a047-105">每個聊天機器人都不同，但有一些常見的模式、工作流程和技術需要注意。</span><span class="sxs-lookup"><span data-stu-id="5a047-105">Each bot is different, but there are some common patterns, workflows, and technologies to be aware of.</span></span> <span data-ttu-id="5a047-106">特別是針對提供企業工作負載的聊天機器人，除了核心功能之外，還有許多設計考量。</span><span class="sxs-lookup"><span data-stu-id="5a047-106">Especially for a bot to serve enterprise workloads, there are many design considerations beyond just the core functionality.</span></span> <span data-ttu-id="5a047-107">本文章涵蓋最重要的設計層面，並介紹組建耐用、安全且主動學習之聊天機器人所需的工具。</span><span class="sxs-lookup"><span data-stu-id="5a047-107">This article covers the most essential design aspects, and introduces the tools needed to build a robust, secure, and actively learning bot.</span></span>

<span data-ttu-id="5a047-108">[![架構圖][0]][0]</span><span class="sxs-lookup"><span data-stu-id="5a047-108">[![Diagram of the architecture][0]][0]</span></span>

<span data-ttu-id="5a047-109">此架構中使用的最佳做法範例是完全開放的原始碼，並在 [GitHub][git-repo-base] 提供。</span><span class="sxs-lookup"><span data-stu-id="5a047-109">The best practice utility samples used in this architecture are fully open-sourced and available on [GitHub][git-repo-base].</span></span> 

## <a name="architecture"></a><span data-ttu-id="5a047-110">架構</span><span class="sxs-lookup"><span data-stu-id="5a047-110">Architecture</span></span>

<span data-ttu-id="5a047-111">這裡顯示的架構會使用下列 Azure 服務。</span><span class="sxs-lookup"><span data-stu-id="5a047-111">The architecture shown here uses the following Azure services.</span></span> <span data-ttu-id="5a047-112">您自己的聊天機器人可能無法使用所有這些服務，或可能會納入其他服務。</span><span class="sxs-lookup"><span data-stu-id="5a047-112">Your own bot may not use all of these services, or may incorporate additional services.</span></span>

### <a name="bot-logic-and-user-experience"></a><span data-ttu-id="5a047-113">聊天機器人邏輯和使用者體驗</span><span class="sxs-lookup"><span data-stu-id="5a047-113">Bot logic and user experience</span></span>

- <span data-ttu-id="5a047-114">**[Bot Framework Service] [ bot-framework-service]**  (BFS)。</span><span class="sxs-lookup"><span data-stu-id="5a047-114">**[Bot Framework Service][bot-framework-service]** (BFS).</span></span> <span data-ttu-id="5a047-115">此服務會將您的聊天機器人連線至通訊應用程式 Cortana、Facebook、Messenger 或 Slack。</span><span class="sxs-lookup"><span data-stu-id="5a047-115">This service connects your bot to a communication app such as Cortana, Facebook Messenger, or Slack.</span></span> <span data-ttu-id="5a047-116">它協助您的聊天機器人與使用者之間的通訊。</span><span class="sxs-lookup"><span data-stu-id="5a047-116">It facilitates communication between your bot and the user.</span></span>
- <span data-ttu-id="5a047-117">**[Azure App Service][app-service]**。</span><span class="sxs-lookup"><span data-stu-id="5a047-117">**[Azure App Service][app-service]**.</span></span> <span data-ttu-id="5a047-118">聊天機器人邏輯裝載於 Azure App Service 中。</span><span class="sxs-lookup"><span data-stu-id="5a047-118">The bot application logic is hosted in Azure App Service.</span></span>

### <a name="bot-cognition-and-intelligence"></a><span data-ttu-id="5a047-119">聊天機器人認知和智慧</span><span class="sxs-lookup"><span data-stu-id="5a047-119">Bot cognition and intelligence</span></span>

- <span data-ttu-id="5a047-120">**[Language Understanding][luis]** (LUIS)。</span><span class="sxs-lookup"><span data-stu-id="5a047-120">**[Language Understanding][luis]** (LUIS).</span></span> <span data-ttu-id="5a047-121">[Azure 認知服務][cognitive-services]的一部分，LUIS 可讓您的聊天機器人藉由識別使用者意圖和實體了解自然語言。</span><span class="sxs-lookup"><span data-stu-id="5a047-121">Part of [Azure Cognitive Services][cognitive-services], LUIS enables your bot to understand natural language by identifying user intents and entities.</span></span>
- <span data-ttu-id="5a047-122">**[Azure 搜尋服務][search]**。</span><span class="sxs-lookup"><span data-stu-id="5a047-122">**[Azure Search][search]**.</span></span> <span data-ttu-id="5a047-123">Azure 搜尋服務是受控服務，其提供可快速搜尋的文件索引。</span><span class="sxs-lookup"><span data-stu-id="5a047-123">Search is a managed service that provides a quick searchable document index.</span></span>
- <span data-ttu-id="5a047-124">**[QnA Maker][qna-maker]**。</span><span class="sxs-lookup"><span data-stu-id="5a047-124">**[QnA Maker][qna-maker]**.</span></span> <span data-ttu-id="5a047-125">QnA Maker 是一項雲端式 API 服務，可對您的資料建立交談式的問答層。</span><span class="sxs-lookup"><span data-stu-id="5a047-125">QnA Maker is a cloud-based API service that creates a conversational, question-and-answer layer over your data.</span></span> <span data-ttu-id="5a047-126">通常，它會隨著半結構化內容一起載入，例如常見問題集。</span><span class="sxs-lookup"><span data-stu-id="5a047-126">Typically, it's loaded with semi-structured content such as FAQs.</span></span> <span data-ttu-id="5a047-127">您可以使用它來建立知識庫，以回答自然語言問題。</span><span class="sxs-lookup"><span data-stu-id="5a047-127">Use it to create a knowledge base for answering natural-language questions.</span></span>
- <span data-ttu-id="5a047-128">**[Web 應用程式][webapp]**.</span><span class="sxs-lookup"><span data-stu-id="5a047-128">**[Web app][webapp]**.</span></span> <span data-ttu-id="5a047-129">如果您的聊天機器人需要現有服務未提供的 AI 解決方案，則您可以實作自己的自訂 AI，並將其裝載為 Web 應用程式。</span><span class="sxs-lookup"><span data-stu-id="5a047-129">If your bot needs AI solutions not provided by an existing service, you can implement your own custom AI and host it as a web app.</span></span> <span data-ttu-id="5a047-130">這會提供一個 Web 端點，供您的聊天機器人呼叫。</span><span class="sxs-lookup"><span data-stu-id="5a047-130">This provides a web endpoint for your bot to call.</span></span>

### <a name="data-ingestion"></a><span data-ttu-id="5a047-131">資料擷取</span><span class="sxs-lookup"><span data-stu-id="5a047-131">Data ingestion</span></span>

<span data-ttu-id="5a047-132">聊天機器人將會依賴必須擷取和準備的未經處理資料。</span><span class="sxs-lookup"><span data-stu-id="5a047-132">The bot will rely on raw data that must be ingested and prepared.</span></span> <span data-ttu-id="5a047-133">請考慮下列任何選項來協調此程序：</span><span class="sxs-lookup"><span data-stu-id="5a047-133">Consider any of the following options to orchestrate this process:</span></span>

- <span data-ttu-id="5a047-134">**[Azure Data Factory][data-factory]**。</span><span class="sxs-lookup"><span data-stu-id="5a047-134">**[Azure Data Factory][data-factory]**.</span></span> <span data-ttu-id="5a047-135">Data Factory 可協調並自動化資料移動和資料轉換。</span><span class="sxs-lookup"><span data-stu-id="5a047-135">Data Factory orchestrates and automates data movement and data transformation.</span></span>
- <span data-ttu-id="5a047-136">**[Logic Apps][logic-apps]**。</span><span class="sxs-lookup"><span data-stu-id="5a047-136">**[Logic Apps][logic-apps]**.</span></span> <span data-ttu-id="5a047-137">Logic Apps 是一個無伺服器平台，用於組建可整合應用程式、資料和服務的工作流程。</span><span class="sxs-lookup"><span data-stu-id="5a047-137">Logic Apps is a serverless platform for building workflows that integrate applications, data, and services.</span></span> <span data-ttu-id="5a047-138">Logic Apps 為許多應用程式提供資料連接器，包括 Office 365。</span><span class="sxs-lookup"><span data-stu-id="5a047-138">Logic Apps provides data connectors for many applications, including Office 365.</span></span>
- <span data-ttu-id="5a047-139">**[Azure Functions][functions]**。</span><span class="sxs-lookup"><span data-stu-id="5a047-139">**[Azure Functions][functions]**.</span></span> <span data-ttu-id="5a047-140">您可以使用 Azure Functions 來撰寫自訂的無伺服器程式碼，其由[觸發程序][ functions-triggers] &mdash;叫用，例如，每當文件新增至 Blob 儲存體或 Cosmos DB 時即會叫用。</span><span class="sxs-lookup"><span data-stu-id="5a047-140">You can use Azure Functions to write custom serverless code that is invoked by a [trigger][functions-triggers] &mdash; for example, whenever a document is added to blob storage or Cosmos DB.</span></span>

### <a name="logging-and-monitoring"></a><span data-ttu-id="5a047-141">記錄和監視</span><span class="sxs-lookup"><span data-stu-id="5a047-141">Logging and monitoring</span></span>

- <span data-ttu-id="5a047-142">**[Application Insights][app-insights]**。</span><span class="sxs-lookup"><span data-stu-id="5a047-142">**[Application Insights][app-insights]**.</span></span> <span data-ttu-id="5a047-143">使用 Application Insights 來記錄聊天機器人用於監視、 診斷和分析用途的 bot 應用程式計量。</span><span class="sxs-lookup"><span data-stu-id="5a047-143">Use Application Insights to log the bot's application metrics for monitoring, diagnostic, and analytical purposes.</span></span>
- <span data-ttu-id="5a047-144">**[Azure Blob 儲存體][blob]**。</span><span class="sxs-lookup"><span data-stu-id="5a047-144">**[Azure Blob Storage][blob]**.</span></span> <span data-ttu-id="5a047-145">Blob 儲存體已針對儲存大量非結構化資料最佳化。</span><span class="sxs-lookup"><span data-stu-id="5a047-145">Blob storage is optimized for storing massive amounts of unstructured data.</span></span>
- <span data-ttu-id="5a047-146">**[Cosmos DB][cosmosdb]**。</span><span class="sxs-lookup"><span data-stu-id="5a047-146">**[Cosmos DB][cosmosdb]**.</span></span> <span data-ttu-id="5a047-147">Cosmos DB 非常適合於儲存半結構化的記錄資料，例如交談。</span><span class="sxs-lookup"><span data-stu-id="5a047-147">Cosmos DB is well-suited for storing semi-structured log data such as conversations.</span></span>
- <span data-ttu-id="5a047-148">**[Power BI][power-bi]**。</span><span class="sxs-lookup"><span data-stu-id="5a047-148">**[Power BI][power-bi]**.</span></span> <span data-ttu-id="5a047-149">您可以使用 Power BI，為您的聊天機器人建立監視儀表板。</span><span class="sxs-lookup"><span data-stu-id="5a047-149">Use Power BI to create monitoring dashboards for your bot.</span></span>

### <a name="security-and-governance"></a><span data-ttu-id="5a047-150">安全性與治理</span><span class="sxs-lookup"><span data-stu-id="5a047-150">Security and governance</span></span>

- <span data-ttu-id="5a047-151">**[Azure Active Directory][aad]** (Azure AD)。</span><span class="sxs-lookup"><span data-stu-id="5a047-151">**[Azure Active Directory][aad]** (Azure AD).</span></span> <span data-ttu-id="5a047-152">使用者會透過識別提供者 (例如 Azure AD) 進行驗證。</span><span class="sxs-lookup"><span data-stu-id="5a047-152">Users will authenticate through an identity provider such as Azure AD.</span></span> <span data-ttu-id="5a047-153">聊天機器人服務會處理驗證流程與 OAuth 權杖管理。</span><span class="sxs-lookup"><span data-stu-id="5a047-153">The Bot Service handles the authentication flow and OAuth token management.</span></span> <span data-ttu-id="5a047-154">請參閱[透過 Azure Bot 服務將驗證新增至您的聊天機器人][bot-authentication]。</span><span class="sxs-lookup"><span data-stu-id="5a047-154">See [Add authentication to your bot via Azure Bot Service][bot-authentication].</span></span>
- <span data-ttu-id="5a047-155">**[Azure Key Vault][key-vault]**。</span><span class="sxs-lookup"><span data-stu-id="5a047-155">**[Azure Key Vault][key-vault]**.</span></span> <span data-ttu-id="5a047-156">使用 Key Vault 儲存認證和其他祕密。</span><span class="sxs-lookup"><span data-stu-id="5a047-156">Store credentials and other secrets using Key Vault.</span></span>

### <a name="quality-assurance-and-enhancements"></a><span data-ttu-id="5a047-157">品質保證和增強功能</span><span class="sxs-lookup"><span data-stu-id="5a047-157">Quality assurance and enhancements</span></span>

- <span data-ttu-id="5a047-158">**[Azure DevOps][devops]**。</span><span class="sxs-lookup"><span data-stu-id="5a047-158">**[Azure DevOps][devops]**.</span></span> <span data-ttu-id="5a047-159">提供許多服務進行應用程式管理，包括原始檔控制、組建、測試、部署和專案追蹤。</span><span class="sxs-lookup"><span data-stu-id="5a047-159">Provides many services for app management, including source control, building, testing, deployment, and project tracking.</span></span>
- <span data-ttu-id="5a047-160">**[VS Code][vscode]** 適合於應用程式開發的輕量型程式碼編輯器。</span><span class="sxs-lookup"><span data-stu-id="5a047-160">**[VS Code][vscode]** A lightweight code editor for app development.</span></span> <span data-ttu-id="5a047-161">您可以使用任何其他具有類似功能的 IDE。</span><span class="sxs-lookup"><span data-stu-id="5a047-161">You can use any other IDE with similar features.</span></span>

## <a name="design-considerations"></a><span data-ttu-id="5a047-162">設計考量</span><span class="sxs-lookup"><span data-stu-id="5a047-162">Design considerations</span></span>

<span data-ttu-id="5a047-163">就高階來說，交談式聊天機器人可以分成聊天機器人功能 (「大腦」) 和一組周圍需求 (「身體」)。</span><span class="sxs-lookup"><span data-stu-id="5a047-163">At a high level, a conversational bot can be divided into the bot functionality (the "brain") and a set of surrounding requirements (the "body").</span></span> <span data-ttu-id="5a047-164">大腦包含網域感知元件，包括聊天機器人邏輯和 ML 功能。</span><span class="sxs-lookup"><span data-stu-id="5a047-164">The brain includes the domain-aware components, including the bot logic and ML capabilities.</span></span> <span data-ttu-id="5a047-165">其他元件為網域不可知的，並會處理非功能性需求，例如 CI/CD、品質保證和安全性。</span><span class="sxs-lookup"><span data-stu-id="5a047-165">Other components are domain agnostic and address non-functional requirements such as CI/CD, quality assurance, and security.</span></span>

![聊天機器人功能的邏輯圖](./_images/conversational-bot-logical.png)

<span data-ttu-id="5a047-167">在深入了解此架構的細節之前，讓我們從通過設計的每個子元件的資料流程開始。</span><span class="sxs-lookup"><span data-stu-id="5a047-167">Before getting into the specifics of this architecture, let's start with the data flow through each subcomponent of the design.</span></span> <span data-ttu-id="5a047-168">資料流程包含使用者起始和系統起始的資料流程。</span><span class="sxs-lookup"><span data-stu-id="5a047-168">The data flow includes user-initiated and system-initiated data flows.</span></span>

### <a name="user-message-flow"></a><span data-ttu-id="5a047-169">使用者訊息流程</span><span class="sxs-lookup"><span data-stu-id="5a047-169">User message flow</span></span>

<span data-ttu-id="5a047-170">**驗證**。</span><span class="sxs-lookup"><span data-stu-id="5a047-170">**Authentication**.</span></span> <span data-ttu-id="5a047-171">使用者開始使用其與機器人的通訊通道所提供的任何機制自行驗證。</span><span class="sxs-lookup"><span data-stu-id="5a047-171">Users start by authenticating themselves using whatever mechanism is provided by their channel of communication with the bot.</span></span> <span data-ttu-id="5a047-172">聊天機器人架構支援許多通訊通道，包括 Cortana、Microsoft Teams、Facebook Messenger、Kik 和 Slack。</span><span class="sxs-lookup"><span data-stu-id="5a047-172">The bot framework supports many communication channels, including Cortana, Microsoft Teams, Facebook Messenger, Kik, and Slack.</span></span> <span data-ttu-id="5a047-173">如需通道清單，請參閱[將聊天機器人連線到通道](/azure/bot-service/bot-service-manage-channels)。</span><span class="sxs-lookup"><span data-stu-id="5a047-173">For a list of channels, see [Connect a bot to channels](/azure/bot-service/bot-service-manage-channels).</span></span> <span data-ttu-id="5a047-174">當您使用 Azure Bot 服務建立聊天機器人時，會自動設定[網路聊天][webchat]。</span><span class="sxs-lookup"><span data-stu-id="5a047-174">When you create a bot with Azure Bot Service, the [Web Chat][webchat] channel is automatically configured.</span></span> <span data-ttu-id="5a047-175">此通道可讓使用者在網頁中直接與您的聊天機器人互動。</span><span class="sxs-lookup"><span data-stu-id="5a047-175">This channel allows users to interact with your bot directly in a web page.</span></span> <span data-ttu-id="5a047-176">您也可以使用 [Direct Line](/azure/bot-service/bot-service-channel-connect-directline) 通道，將聊天機器人連線到自訂應用程式。</span><span class="sxs-lookup"><span data-stu-id="5a047-176">You can also connect the bot to a custom app by using the [Direct Line](/azure/bot-service/bot-service-channel-connect-directline) channel.</span></span> <span data-ttu-id="5a047-177">使用者的身分識別是用來提供角色型存取控制，以及提供個人化的內容。</span><span class="sxs-lookup"><span data-stu-id="5a047-177">The user's identity is used to provide role-based access control, as well as to serve personalized content.</span></span>

<span data-ttu-id="5a047-178">**使用者訊息**。</span><span class="sxs-lookup"><span data-stu-id="5a047-178">**User message**.</span></span> <span data-ttu-id="5a047-179">驗證後，使用者會傳送一則訊息至聊天機器人。</span><span class="sxs-lookup"><span data-stu-id="5a047-179">Once authenticated, the user sends a message to the bot.</span></span> <span data-ttu-id="5a047-180">聊天機器人會讀取訊息，並將其路由傳送至自然語言理解服務，例如 [LUIS](/azure/cognitive-services/luis/)。</span><span class="sxs-lookup"><span data-stu-id="5a047-180">The bot reads the message and routes it to a natural language understanding service such as [LUIS](/azure/cognitive-services/luis/).</span></span> <span data-ttu-id="5a047-181">此步驟會取得**意圖** (使用者想要做什麼) 和**實體** (使用者感興趣的事物)。</span><span class="sxs-lookup"><span data-stu-id="5a047-181">This step gets the **intents** (what the user wants to do) and **entities** (what things the user is interested in).</span></span> <span data-ttu-id="5a047-182">然後，聊天機器人會組建一個查詢，其會傳遞至提供資訊的服務，例如 [Azure 搜尋服務][ search]進行文件擷取、[QnA Maker](https://www.qnamaker.ai/) 取得常見問題集，或自訂知識庫。</span><span class="sxs-lookup"><span data-stu-id="5a047-182">The bot then builds a query that it passes to a service that serves information, such as [Azure Search][search] for document retrieval, [QnA Maker](https://www.qnamaker.ai/) for FAQs, or a custom knowledge base.</span></span> <span data-ttu-id="5a047-183">聊天機器人會使用這些結果來建構回應。</span><span class="sxs-lookup"><span data-stu-id="5a047-183">The bot uses these results to construct a response.</span></span> <span data-ttu-id="5a047-184">若要為指定的查詢提供最佳結果，聊天機器人可能會對這些遠端服務進行數次來回呼叫。</span><span class="sxs-lookup"><span data-stu-id="5a047-184">To give the best result for a  given query, the bot might make several back-and-forth calls to these remote services.</span></span>

<span data-ttu-id="5a047-185">**回應**。</span><span class="sxs-lookup"><span data-stu-id="5a047-185">**Response**.</span></span> <span data-ttu-id="5a047-186">此時，聊天機器人已判定最佳回應，並將其傳送給使用者。</span><span class="sxs-lookup"><span data-stu-id="5a047-186">At this point, the bot has determined the best response and sends it to the user.</span></span> <span data-ttu-id="5a047-187">如果最佳比對答案的信心分數很低，則回應可能是解疑問題或聊天機器人可能無法充分回應的確認。</span><span class="sxs-lookup"><span data-stu-id="5a047-187">If the confidence score of the best-matched answer is low, the response might be a disambiguation question or an acknowledgement that the bot could not reply adequately.</span></span>

<span data-ttu-id="5a047-188">**記錄**。</span><span class="sxs-lookup"><span data-stu-id="5a047-188">**Logging**.</span></span> <span data-ttu-id="5a047-189">當收到使用者要求或回應時，所有交談動作都應該記錄至記錄存放區，連同效能計量和來自外部服務的一般錯誤。</span><span class="sxs-lookup"><span data-stu-id="5a047-189">When a user request is received or a response is sent, all conversation actions should be logged to a logging store, along with performance metrics and general errors from external services.</span></span> <span data-ttu-id="5a047-190">稍後診斷問題並改善系統時，這些記錄很有用。</span><span class="sxs-lookup"><span data-stu-id="5a047-190">These logs will be useful later when diagnosing issues and improving the system.</span></span>

<span data-ttu-id="5a047-191">**意見反應**。</span><span class="sxs-lookup"><span data-stu-id="5a047-191">**Feedback**.</span></span> <span data-ttu-id="5a047-192">另一個好做法是收集使用者意見反應和滿意度分數。</span><span class="sxs-lookup"><span data-stu-id="5a047-192">Another good practice is to collect user feedback and satisfaction scores.</span></span> <span data-ttu-id="5a047-193">作為機器人最終回應的後續動作，機器人應該要求使用者對於回覆做出滿意度評價。</span><span class="sxs-lookup"><span data-stu-id="5a047-193">As a follow up to the bot's final response, the bot should ask the user to rate their satisfaction with the reply.</span></span> <span data-ttu-id="5a047-194">意見反應可以協助您解決自然語言理解的冷啟動問題，並持續提高回應的精確度。</span><span class="sxs-lookup"><span data-stu-id="5a047-194">Feedback can help you to solve the cold start problem of natural language understanding, and continually improve the accuracy of responses.</span></span>

### <a name="system-data-flow"></a><span data-ttu-id="5a047-195">系統資料流程</span><span class="sxs-lookup"><span data-stu-id="5a047-195">System Data Flow</span></span>

<span data-ttu-id="5a047-196">**ETL**。</span><span class="sxs-lookup"><span data-stu-id="5a047-196">**ETL**.</span></span> <span data-ttu-id="5a047-197">聊天機器人會依賴後端 ETL 程序從未經處理資料擷取的資訊與知識。</span><span class="sxs-lookup"><span data-stu-id="5a047-197">The bot relies on information and knowledge extracted from the raw data by an ETL process in the backend.</span></span> <span data-ttu-id="5a047-198">此資料可能是結構化 (SQL 資料庫)、半結構化 (CRM 系統、常見問題集) 或非結構化 (Word 文件、PDF、Web 記錄)。</span><span class="sxs-lookup"><span data-stu-id="5a047-198">This data might be structured (SQL database), semi-structured (CRM system, FAQs), or unstructured (Word documents, PDFs, web logs).</span></span> <span data-ttu-id="5a047-199">ETL 子系統會依固定排程擷取資料。</span><span class="sxs-lookup"><span data-stu-id="5a047-199">An ETL subsystem extracts the data on a fixed schedule.</span></span> <span data-ttu-id="5a047-200">內容會進行轉換並擴充，然後載入至中繼資料存放區，例如 Cosmos DB 或 Azure Blob 儲存體。</span><span class="sxs-lookup"><span data-stu-id="5a047-200">The content is transformed and enriched, then loaded into an intermediary data store, such as Cosmos DB or Azure Blob Storage.</span></span>

<span data-ttu-id="5a047-201">然後，中繼存放區中的資料會進行索引編製並存入 Azure 搜尋服務進行文件擷取、載入至 QnA Maker 以建立問答配對，或載入至自訂 Web 應用程式進行非結構化文字處理。</span><span class="sxs-lookup"><span data-stu-id="5a047-201">Data in the intermediary store is then indexed into Azure Search for document retrieval, loaded into QnA Maker to create question and answer pairs, or loaded into a custom web app for unstructured text processing.</span></span> <span data-ttu-id="5a047-202">資料也會用來定型 LUIS 模型，以取得意圖和進行實體擷取。</span><span class="sxs-lookup"><span data-stu-id="5a047-202">The data is also used to train a LUIS model for intent and entity extraction.</span></span>

<span data-ttu-id="5a047-203">**品質保證**。</span><span class="sxs-lookup"><span data-stu-id="5a047-203">**Quality assurance**.</span></span> <span data-ttu-id="5a047-204">交談記錄用來診斷並修正錯誤、提供如何使用聊天機器人的見解，以及追蹤整體效能。</span><span class="sxs-lookup"><span data-stu-id="5a047-204">The conversation logs are used to diagnose and fix bugs, provide insight into how the bot is being used, and track overall performance.</span></span> <span data-ttu-id="5a047-205">意見反應資料有助於重新定型 AI 模型，以提高聊天機器人效能。</span><span class="sxs-lookup"><span data-stu-id="5a047-205">Feedback data is useful for retraining the AI models to improve bot performance.</span></span>

## <a name="building-a-bot"></a><span data-ttu-id="5a047-206">建立 Bot</span><span class="sxs-lookup"><span data-stu-id="5a047-206">Building a bot</span></span>

<span data-ttu-id="5a047-207">甚至在您撰寫一行程式碼之前，請務必撰寫功能規格，讓開發小組清楚知道預期機器人做什麼。</span><span class="sxs-lookup"><span data-stu-id="5a047-207">Before you even write a single line of code, it's important to write a functional specification so the development team has a clear idea of what the bot is expected to do.</span></span> <span data-ttu-id="5a047-208">規格應該包括合理全方位的使用者輸入清單，以及在各種知識領域中預期的聊天機器人回應。</span><span class="sxs-lookup"><span data-stu-id="5a047-208">The specification should include a reasonably comprehensive list of user inputs and expected bot responses in various knowledge domains.</span></span> <span data-ttu-id="5a047-209">這份即時文件將是開發和測試您的聊天機器人的寶貴指南。</span><span class="sxs-lookup"><span data-stu-id="5a047-209">This living document will be an invaluable guide for developing and testing your bot.</span></span>

### <a name="ingest-data"></a><span data-ttu-id="5a047-210">擷取資料</span><span class="sxs-lookup"><span data-stu-id="5a047-210">Ingest data</span></span>

<span data-ttu-id="5a047-211">接下來，找出可讓機器人以智慧方式與使用者互動的資料來源。</span><span class="sxs-lookup"><span data-stu-id="5a047-211">Next, identify the data sources that will enable the bot to interact intelligently with users.</span></span> <span data-ttu-id="5a047-212">如先前所述，這些資料來源可以包含結構化、半結構化或非結構化資料集。</span><span class="sxs-lookup"><span data-stu-id="5a047-212">As mentioned earlier, these data sources could contain structured, semi-structured, or unstructured data sets.</span></span> <span data-ttu-id="5a047-213">當您開始使用時，好方法是對中央存放區 (例如 Cosmos DB 或 Azure 儲存體) 進行資料的一次性複製。</span><span class="sxs-lookup"><span data-stu-id="5a047-213">When you're getting started, a good approach is to make a one-off copy of the data to a central store, such as Cosmos DB or Azure Storage.</span></span> <span data-ttu-id="5a047-214">當您繼續，您應該建立要保留這項資料目前的自動的資料管線擷取。</span><span class="sxs-lookup"><span data-stu-id="5a047-214">As you progress, you should create an automated data ingestion pipeline to keep this data current.</span></span> <span data-ttu-id="5a047-215">自動擷取管線的選項包括 Data Factory、Functions 和 Logic Apps。</span><span class="sxs-lookup"><span data-stu-id="5a047-215">Options for an automated ingestion pipeline include Data Factory, Functions, and Logic Apps.</span></span> <span data-ttu-id="5a047-216">根據資料存放區和結構描述，您可能使用這些方法的組合。</span><span class="sxs-lookup"><span data-stu-id="5a047-216">Depending on the data stores and the schemas, you might use a combination of these approaches.</span></span>

<span data-ttu-id="5a047-217">開始使用時，使用 Azure 入口網站手動建立 Azure 資源，這是合理的作法。</span><span class="sxs-lookup"><span data-stu-id="5a047-217">As you get started, it's reasonable to use the Azure portal to manually create Azure resources.</span></span> <span data-ttu-id="5a047-218">稍後，您應該仔細考慮如何自動部署這些資源。</span><span class="sxs-lookup"><span data-stu-id="5a047-218">Later on, you should put more thought into automating the deployment of these resources.</span></span>

### <a name="core-bot-logic-and-ux"></a><span data-ttu-id="5a047-219">核心聊天機器人邏輯與 UX</span><span class="sxs-lookup"><span data-stu-id="5a047-219">Core bot logic and UX</span></span>

<span data-ttu-id="5a047-220">一旦有了一種規格和一些資料，就可以開始將您的聊天機器人付諸實現。</span><span class="sxs-lookup"><span data-stu-id="5a047-220">Once you have a specification and some data, it's time to start making your bot into reality.</span></span> <span data-ttu-id="5a047-221">讓我們專注於核心聊天機器人邏輯。</span><span class="sxs-lookup"><span data-stu-id="5a047-221">Let's focus on the core bot logic.</span></span> <span data-ttu-id="5a047-222">這是處理與使用者交談的程式碼，包括路由邏輯、解疑邏輯和記錄。</span><span class="sxs-lookup"><span data-stu-id="5a047-222">This is the code that handles the conversation with the user, including the routing logic, disambiguation logic, and logging.</span></span> <span data-ttu-id="5a047-223">開始熟悉 [Bot Framework][bot-framework]，包括：</span><span class="sxs-lookup"><span data-stu-id="5a047-223">Start by familiarizing yourself with the [Bot Framework][bot-framework], including:</span></span>

- <span data-ttu-id="5a047-224">架構中使用的基本概念和術語，尤指[交談][回合]和[活動]。</span><span class="sxs-lookup"><span data-stu-id="5a047-224">Basic concepts and terminology used in the framework, especially [conversations], [turns], and [activities].</span></span>
- <span data-ttu-id="5a047-225">[Bot Connector 服務](/azure/bot-service/rest-api/bot-framework-rest-connector-quickstart)，處理聊天機器人與您通道之間的網路。</span><span class="sxs-lookup"><span data-stu-id="5a047-225">The [Bot Connector service](/azure/bot-service/rest-api/bot-framework-rest-connector-quickstart), which handles the networking between the bot and your channels.</span></span>
- <span data-ttu-id="5a047-226">如何維護交談[狀態](/azure/bot-service/bot-builder-concept-state)，放在記憶體中還是更適合放在存放區中，例如 Azure Blob 儲存體或 Azure Cosmos DB。</span><span class="sxs-lookup"><span data-stu-id="5a047-226">How conversation [state](/azure/bot-service/bot-builder-concept-state) is maintained, either in memory or better yet in a store such as Azure Blob Storage or Azure Cosmos DB.</span></span>
- <span data-ttu-id="5a047-227">[中介軟體](/azure/bot-service/bot-builder-basics#middleware)，以及如何使用它來連結您的聊天機器人與外部服務，例如認知服務。</span><span class="sxs-lookup"><span data-stu-id="5a047-227">[Middleware](/azure/bot-service/bot-builder-basics#middleware), and how it can be used to hook up your bot with external services, such as Cognitive Services.</span></span>

<span data-ttu-id="5a047-228">如需豐富的[使用者體驗](/azure/bot-service/bot-service-design-user-experience)，有許多選項。</span><span class="sxs-lookup"><span data-stu-id="5a047-228">For a rich [user experience](/azure/bot-service/bot-service-design-user-experience), there are many options.</span></span>

- <span data-ttu-id="5a047-229">您可以使用[卡](/azure/bot-service/bot-service-design-user-experience#cards)，來包含按鈕、影像、浮動切換和功能表。</span><span class="sxs-lookup"><span data-stu-id="5a047-229">You can use [cards](/azure/bot-service/bot-service-design-user-experience#cards) to include buttons, images, carousels, and menus.</span></span>
- <span data-ttu-id="5a047-230">聊天機器人可以支援語音。</span><span class="sxs-lookup"><span data-stu-id="5a047-230">A bot can support speech.</span></span>
- <span data-ttu-id="5a047-231">您甚至可以將聊天機器人內嵌在應用程式或網站，並使用其裝載所在應用程式的功能。</span><span class="sxs-lookup"><span data-stu-id="5a047-231">You can even embed your bot in an app or website and use the capabilities of the app hosting it.</span></span>

<span data-ttu-id="5a047-232">若要開始，您可以使用 [Azure Bot Service](/azure/bot-service/bot-service-quickstart) 來線上組建聊天機器人，從可用的 C# 和 Node.js 範本中選取。</span><span class="sxs-lookup"><span data-stu-id="5a047-232">To get started, you can build your bot online using the [Azure Bot Service](/azure/bot-service/bot-service-quickstart), selecting from the available C# and Node.js templates.</span></span> <span data-ttu-id="5a047-233">不過，當您的聊天機器人越來越複雜時，您將需要在本機建立聊天機器人，然後將其部署至 Web。</span><span class="sxs-lookup"><span data-stu-id="5a047-233">As your bot gets more sophisticated, however, you will need to create your bot locally then deploy it to the web.</span></span> <span data-ttu-id="5a047-234">選擇 IDE (例如 Visual Studio 或 Visual Studio Code) 和程式設計語言。</span><span class="sxs-lookup"><span data-stu-id="5a047-234">Choose an IDE, such as Visual Studio or Visual Studio Code, and a programming language.</span></span> <span data-ttu-id="5a047-235">SDK 提供下列語言版本：</span><span class="sxs-lookup"><span data-stu-id="5a047-235">SDKs are available for the following languages:</span></span>

- [<span data-ttu-id="5a047-236">C#</span><span class="sxs-lookup"><span data-stu-id="5a047-236">C#</span></span>](https://github.com/microsoft/botbuilder-dotnet)
- [<span data-ttu-id="5a047-237">JavaScript</span><span class="sxs-lookup"><span data-stu-id="5a047-237">JavaScript</span></span>](https://github.com/microsoft/botbuilder-js)
- <span data-ttu-id="5a047-238">[Java](https://github.com/microsoft/botbuilder-java) (預覽)</span><span class="sxs-lookup"><span data-stu-id="5a047-238">[Java](https://github.com/microsoft/botbuilder-java) (preview)</span></span>
- <span data-ttu-id="5a047-239">[Python](https://github.com/microsoft/botbuilder-python) (預覽)</span><span class="sxs-lookup"><span data-stu-id="5a047-239">[Python](https://github.com/microsoft/botbuilder-python) (preview)</span></span>

<span data-ttu-id="5a047-240">做為起點，您可以針對使用 Azure Bot Service 建立的聊天機器人下載原始程式碼。</span><span class="sxs-lookup"><span data-stu-id="5a047-240">As a starting point, you can download the source code for the bot you created using the Azure Bot Service.</span></span> <span data-ttu-id="5a047-241">您也可以找到[範例程式碼](https://github.com/Microsoft/BotBuilder-Samples/blob/master/README.md)，從簡單的回應聊天機器人到更複雜且與各種 AI 服務整合的聊天機器人。</span><span class="sxs-lookup"><span data-stu-id="5a047-241">You can also find [sample code](https://github.com/Microsoft/BotBuilder-Samples/blob/master/README.md), from simple echo bots to more sophisticated bots that integrate with various AI services.</span></span>

### <a name="add-smarts-to-your-bot"></a><span data-ttu-id="5a047-242">在您的聊天機器人中加入智慧</span><span class="sxs-lookup"><span data-stu-id="5a047-242">Add smarts to your bot</span></span>

<span data-ttu-id="5a047-243">針對具有適當定義之命令清單的簡單聊天機器人，您可以使用規則型方法，透過 regex 剖析使用者輸入。</span><span class="sxs-lookup"><span data-stu-id="5a047-243">For a simple bot with a well-defined list of commands, you might be able to use a rules-based approach to parse the user input via regex.</span></span> <span data-ttu-id="5a047-244">這具有確定性和可理解的優勢。</span><span class="sxs-lookup"><span data-stu-id="5a047-244">This has the advantage of being deterministic and understandable.</span></span> <span data-ttu-id="5a047-245">不過，當您的聊天機器人需要理解其他自然語言訊息的意圖和實體時，有 AI 服務可以提供協助。</span><span class="sxs-lookup"><span data-stu-id="5a047-245">However, when your bot needs to understand the intents and entities of a more natural-language message, there are AI services that can help.</span></span>

- <span data-ttu-id="5a047-246">LUIS 是特別設計來理解使用者意圖和實體。</span><span class="sxs-lookup"><span data-stu-id="5a047-246">LUIS is specifically designed to understand user intents and entities.</span></span> <span data-ttu-id="5a047-247">您利用相關[使用者輸入](/azure/cognitive-services/luis/luis-concept-utterance)和所需回應的中等大小集合將其定型，而且它會傳回使用者特定訊息的意圖和實體。</span><span class="sxs-lookup"><span data-stu-id="5a047-247">You train it with a moderately sized collection of relevant [user input](/azure/cognitive-services/luis/luis-concept-utterance) and desired responses, and it returns the intents and entities for a user's given message.</span></span>

- <span data-ttu-id="5a047-248">Azure 搜尋服務可以與 LUIS 一起運作。</span><span class="sxs-lookup"><span data-stu-id="5a047-248">Azure Search can work alongside LUIS.</span></span> <span data-ttu-id="5a047-249">使用 Azure 搜尋服務，您可以對所有的相關資料建立可搜尋索引。</span><span class="sxs-lookup"><span data-stu-id="5a047-249">Using Search, you create searchable indexes over all relevant data.</span></span> <span data-ttu-id="5a047-250">聊天機器人會查詢這些索引，以取得 LUIS 所擷取的實體。</span><span class="sxs-lookup"><span data-stu-id="5a047-250">The bot queries these indexes for the entities extracted by LUIS.</span></span> <span data-ttu-id="5a047-251">Azure 搜尋服務也支援[同義字][synonyms]，這可擴大正確的字對應網。</span><span class="sxs-lookup"><span data-stu-id="5a047-251">Azure Search also supports [synonyms][synonyms], which can widen the net of correct word mappings.</span></span>

- <span data-ttu-id="5a047-252">QnA Maker 是另一種服務，其設計來針對指定的問題傳回答案。</span><span class="sxs-lookup"><span data-stu-id="5a047-252">QnA Maker is another service that is designed to return answers for given questions.</span></span> <span data-ttu-id="5a047-253">它通常是透過半結構化資料 (例如常見問題集) 來定型。</span><span class="sxs-lookup"><span data-stu-id="5a047-253">It's typically trained over semi-structured data such as FAQs.</span></span>

<span data-ttu-id="5a047-254">您的聊天機器人可以使用其他 AI 服務，來進一步豐富使用者體驗。</span><span class="sxs-lookup"><span data-stu-id="5a047-254">Your bot can use other AI services to further enrich the user experience.</span></span> <span data-ttu-id="5a047-255">[預先建置 AI 的認知服務套件](https://azure.microsoft.com/en-us/services/cognitive-services/?v=18.44a) 服務 (包括 LUIS 和 QnA Maker) 具有視覺、語音、語言、搜尋和定位的服務。</span><span class="sxs-lookup"><span data-stu-id="5a047-255">The [Cognitive Services suite of pre-built AI](https://azure.microsoft.com/en-us/services/cognitive-services/?v=18.44a) services (which includes LUIS and QnA Maker) has services for vision, speech, language, search, and location.</span></span> <span data-ttu-id="5a047-256">您可以快速新增功能，例如語言翻譯、拼字檢查、情感分析、OCR、定位感知，以及內容仲裁等功能。</span><span class="sxs-lookup"><span data-stu-id="5a047-256">You can quickly add functionality such as language translation, spell checking, sentiment analysis, OCR, location awareness, and content moderation.</span></span> <span data-ttu-id="5a047-257">這些服務可以做為聊天機器人中的中介軟體模組連接起來，來更自然且更有智慧地與使用者動互動。</span><span class="sxs-lookup"><span data-stu-id="5a047-257">These services can be wired up as middleware modules in your bot to interact more naturally and intelligently with the user.</span></span>

<span data-ttu-id="5a047-258">另一個選項是整合自己的自訂 AI 服務。</span><span class="sxs-lookup"><span data-stu-id="5a047-258">Another option is to integrate your own custom AI service.</span></span> <span data-ttu-id="5a047-259">這種方法更複雜，但在機器學習演算法、定型和模型方面為您提供完整的彈性。</span><span class="sxs-lookup"><span data-stu-id="5a047-259">This approach is more complex, but gives you complete flexibility in terms of the machine learning algorithm, training, and model.</span></span> <span data-ttu-id="5a047-260">例如，您可以實作自己的主題模型化，並使用 [LDA] [ lda] 這類演算法來尋找類似或相關文件。</span><span class="sxs-lookup"><span data-stu-id="5a047-260">For example, you could implement your own topic modeling and use algorithm such as [LDA][lda] to find similar or relevant documents.</span></span> <span data-ttu-id="5a047-261">有一個不錯的方法，就是將您的自訂 AI 解決方案公開為 Web 服務端點，並從核心聊天機器人邏輯中呼叫端點。</span><span class="sxs-lookup"><span data-stu-id="5a047-261">A good approach is to expose your custom AI solution as a web service endpoint, and call the endpoint from the core bot logic.</span></span> <span data-ttu-id="5a047-262">Web 服務可以裝載於 VM 叢集中的 App Service。</span><span class="sxs-lookup"><span data-stu-id="5a047-262">The web service could be hosted in App Service or in a cluster of VMs.</span></span> <span data-ttu-id="5a047-263">[Azure Machine Learning] [ aml] 提供多個服務和程式庫，以協助您[定型](https://github.com/Azure/MachineLearningNotebooks/tree/master/how-to-use-azureml/training)和[部署](https://github.com/Azure/MachineLearningNotebooks/tree/master/how-to-use-azureml/deployment)您的模型。</span><span class="sxs-lookup"><span data-stu-id="5a047-263">[Azure Machine Learning][aml] provides a number of services and libraries to assist you in [training](https://github.com/Azure/MachineLearningNotebooks/tree/master/how-to-use-azureml/training) and [deploying](https://github.com/Azure/MachineLearningNotebooks/tree/master/how-to-use-azureml/deployment) your models.</span></span>

## <a name="quality-assurance-and-enhancement"></a><span data-ttu-id="5a047-264">品質保證和增強功能</span><span class="sxs-lookup"><span data-stu-id="5a047-264">Quality assurance and enhancement</span></span>

<span data-ttu-id="5a047-265">**記錄**。</span><span class="sxs-lookup"><span data-stu-id="5a047-265">**Logging**.</span></span> <span data-ttu-id="5a047-266">記錄使用者與機器人的交談，包括基礎效能計量和任何錯誤。</span><span class="sxs-lookup"><span data-stu-id="5a047-266">Log user conversations with the bot, including the underlying performance metrics and any errors.</span></span> <span data-ttu-id="5a047-267">這些記錄在偵錯問題、了解使用者互動，以及改善系統方面非常有用。</span><span class="sxs-lookup"><span data-stu-id="5a047-267">These logs will prove invaluable for debugging issues, understanding user interactions, and improving the system.</span></span> <span data-ttu-id="5a047-268">不同的資料存放區可能適用於不同類型的記錄。</span><span class="sxs-lookup"><span data-stu-id="5a047-268">Different data stores might be appropriate for different types of logs.</span></span> <span data-ttu-id="5a047-269">例如，考慮 Application Insights 用於 Web 記錄、Cosmos DB 用於交談，以及 Azure 儲存體用於大型承載。</span><span class="sxs-lookup"><span data-stu-id="5a047-269">For example, consider Application Insights for web logs, Cosmos DB for conversations, and Azure Storage for large payloads.</span></span> <span data-ttu-id="5a047-270">請參閱[直接寫入 Azure 儲存體][transcript-storage]。</span><span class="sxs-lookup"><span data-stu-id="5a047-270">See [Write directly to Azure Storage][transcript-storage].</span></span>

<span data-ttu-id="5a047-271">**意見反應**。</span><span class="sxs-lookup"><span data-stu-id="5a047-271">**Feedback**.</span></span> <span data-ttu-id="5a047-272">也請務必了解滿意的使用者如何與其聊天機器人互動。</span><span class="sxs-lookup"><span data-stu-id="5a047-272">It's also important to understand how satisfied users are with their bot interactions.</span></span> <span data-ttu-id="5a047-273">如果您有一筆使用者意見反應的記錄，則可以使用此資料，致力於改善某些互動，並重新定型 AI 模型以提高效能。</span><span class="sxs-lookup"><span data-stu-id="5a047-273">If you have a record of user feedback, you can use this data to focus your efforts on improving certain interactions and retraining the AI models for improved performance.</span></span> <span data-ttu-id="5a047-274">使用意見反應來重新定型您系統中的模型，例如 LUIS。</span><span class="sxs-lookup"><span data-stu-id="5a047-274">Use the feedback to retrain the models, such as LUIS, in your system.</span></span>

<span data-ttu-id="5a047-275">**測試**。</span><span class="sxs-lookup"><span data-stu-id="5a047-275">**Testing**.</span></span> <span data-ttu-id="5a047-276">測試聊天機器人包括單元測試、整合測試、迴歸測試和功能測試。</span><span class="sxs-lookup"><span data-stu-id="5a047-276">Testing a bot involves unit tests, integration tests, regression tests, and functional tests.</span></span> <span data-ttu-id="5a047-277">進行測試時，建議您記錄來自外部服務 (例如 Azure 搜尋服務或 QnA Maker) 的實際 HTTP 回應，讓它們可在單元測試期間播放，而無需對外部服務進行實際的網路呼叫。</span><span class="sxs-lookup"><span data-stu-id="5a047-277">For testing, we recommend recording real HTTP responses from external services, such as Azure Search or QnA Maker, so they can be played back during unit testing without needing to make real network calls to external services.</span></span>

>[!NOTE]
> <span data-ttu-id="5a047-278">若要在這些區域中進行開發，請查看 [Botbuilder Utils for JavaScript][git-repo-base]。</span><span class="sxs-lookup"><span data-stu-id="5a047-278">To jump-start your development in these areas, look at the [Botbuilder Utils for JavaScript][git-repo-base].</span></span> <span data-ttu-id="5a047-279">此存放庫包含使用 [Microsoft Bot Framework v4] [ bot-framework] 組建並執行 Node.js 之聊天機器人的範例公用程式碼。</span><span class="sxs-lookup"><span data-stu-id="5a047-279">This repo contains sample utility code for bots built with [Microsoft Bot Framework v4][bot-framework] and running Node.js.</span></span> <span data-ttu-id="5a047-280">包括下列套件：</span><span class="sxs-lookup"><span data-stu-id="5a047-280">It includes the following packages:</span></span>
>
> - <span data-ttu-id="5a047-281">[Cosmos DB 記錄存放區][cosmosdb-logger]。</span><span class="sxs-lookup"><span data-stu-id="5a047-281">[Cosmos DB Logging Store][cosmosdb-logger].</span></span> <span data-ttu-id="5a047-282">顯示如何在 Cosmos DB 儲存和查詢聊天機器人記錄。</span><span class="sxs-lookup"><span data-stu-id="5a047-282">Shows how to store and query bot logs in Cosmos DB.</span></span>
> - <span data-ttu-id="5a047-283">[Application Insights 記錄存放區][appinsights-logger]。</span><span class="sxs-lookup"><span data-stu-id="5a047-283">[Application Insights Logging Store][appinsights-logger].</span></span> <span data-ttu-id="5a047-284">顯示如何在 Application Insights 儲存和查詢聊天機器人記錄。</span><span class="sxs-lookup"><span data-stu-id="5a047-284">Shows how to store and query bot logs in Application Insights.</span></span>
> - <span data-ttu-id="5a047-285">[Feedback Collection Middleware][feedback-util]。</span><span class="sxs-lookup"><span data-stu-id="5a047-285">[Feedback Collection Middleware][feedback-util].</span></span> <span data-ttu-id="5a047-286">為聊天機器人提供使用者意見反應要求機制的範例中介軟體。</span><span class="sxs-lookup"><span data-stu-id="5a047-286">Sample middleware that provides a bot user feedback-request mechanism.</span></span>
> - <span data-ttu-id="5a047-287">[Http Test Recorder][testing util]。</span><span class="sxs-lookup"><span data-stu-id="5a047-287">[Http Test Recorder][testing util].</span></span> <span data-ttu-id="5a047-288">記錄來自聊天機器人外部服務的 HTTP 流量。</span><span class="sxs-lookup"><span data-stu-id="5a047-288">Records HTTP traffic from services external to the bot.</span></span> <span data-ttu-id="5a047-289">它預先建置 LUIS、Azure 搜尋服務和 QnAMaker 的支援，但提供擴充功能以支援任何服務。</span><span class="sxs-lookup"><span data-stu-id="5a047-289">It comes pre-built with support for LUIS, Azure Search, and QnAMaker, but extensions are available to support any service.</span></span> <span data-ttu-id="5a047-290">這可協助您自動測試聊天機器人。</span><span class="sxs-lookup"><span data-stu-id="5a047-290">This helps you automate bot testing.</span></span>
>
> <span data-ttu-id="5a047-291">這些套件是以公用程式範例程式碼形式提供，且未隨附任何支援或更新保證。</span><span class="sxs-lookup"><span data-stu-id="5a047-291">These packages are provided as utility sample code, and come with no guarantee of support or updates.</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="5a047-292">可用性考量</span><span class="sxs-lookup"><span data-stu-id="5a047-292">Availability considerations</span></span>

<span data-ttu-id="5a047-293">向聊天機器人推出新功能或錯誤修正時，最好使用多個部署環境，例如暫存和生產環境。</span><span class="sxs-lookup"><span data-stu-id="5a047-293">As you roll out new features or bug fixes to your bot, it's best to use multiple deployment environments, such as staging and production.</span></span> <span data-ttu-id="5a047-294">使用來自 [Azure DevOps][devops] 的部署[位置][slots]可讓您執行這項操作，而不需要停機。</span><span class="sxs-lookup"><span data-stu-id="5a047-294">Using deployment [slots][slots] from [Azure DevOps][devops] allows you to do this with zero downtime.</span></span> <span data-ttu-id="5a047-295">您可以在暫存環境中測試最新升級，然後再將它們切換至生產環境。</span><span class="sxs-lookup"><span data-stu-id="5a047-295">You can test your latest upgrades in the staging environment before swapping them to the production environment.</span></span> <span data-ttu-id="5a047-296">在處理負載方面，App Service 的設計旨在手動或自動相應增加或減小。</span><span class="sxs-lookup"><span data-stu-id="5a047-296">In terms of handling load, App Service is designed to scale up or out manually or automatically.</span></span> <span data-ttu-id="5a047-297">因為您的聊天機器人裝載於 Microsoft 的全球資料中心基礎結構中，所以 App Service SLA 會承諾高可用性。</span><span class="sxs-lookup"><span data-stu-id="5a047-297">Because your bot is hosted in Microsoft's global datacenter infrastructure, the App Service SLA promises high availability.</span></span>

## <a name="security-considerations"></a><span data-ttu-id="5a047-298">安全性考量</span><span class="sxs-lookup"><span data-stu-id="5a047-298">Security considerations</span></span>

<span data-ttu-id="5a047-299">如同任何其他應用程式，聊天機器人可以設計來正確處理敏感性資料。</span><span class="sxs-lookup"><span data-stu-id="5a047-299">As with any other application, the bot can be designed to handle sensitive data.</span></span> <span data-ttu-id="5a047-300">因此，限制誰可以登入和使用聊天機器人。</span><span class="sxs-lookup"><span data-stu-id="5a047-300">Therefore, restrict who can sign in and use the bot.</span></span> <span data-ttu-id="5a047-301">也會根據使用者的身分識別或角色限制可以存取哪些資料。</span><span class="sxs-lookup"><span data-stu-id="5a047-301">Also limit which data can be accessed, based on the user's identity or role.</span></span> <span data-ttu-id="5a047-302">使用 Azure AD 進行身分識別和存取控制，以及使用 Key Vault 來管理金鑰和祕密。</span><span class="sxs-lookup"><span data-stu-id="5a047-302">Use Azure AD for identity and access control and Key Vault to manage keys and secrets.</span></span>

## <a name="manageability-considerations"></a><span data-ttu-id="5a047-303">管理性考量</span><span class="sxs-lookup"><span data-stu-id="5a047-303">Manageability considerations</span></span>

### <a name="monitoring-and-reporting"></a><span data-ttu-id="5a047-304">監視和報告</span><span class="sxs-lookup"><span data-stu-id="5a047-304">Monitoring and reporting</span></span>

<span data-ttu-id="5a047-305">一旦您的聊天機器人在生產環境中執行，就需要 DevOps 團隊來保持這種方式。</span><span class="sxs-lookup"><span data-stu-id="5a047-305">Once your bot is running in production, you will need a DevOps team to keep it that way.</span></span> <span data-ttu-id="5a047-306">持續監視系統，以確保聊天機器人以尖峰效能操作。</span><span class="sxs-lookup"><span data-stu-id="5a047-306">Continually monitor the system to ensure the bot operates at peak performance.</span></span> <span data-ttu-id="5a047-307">使用傳送至 Application Insights 或 Cosmos DB 的記錄來建立監視儀表板，方法為使用 Application Insights 本身、Power BI 或自訂的 Web 應用程式儀表板。</span><span class="sxs-lookup"><span data-stu-id="5a047-307">Use the logs sent to Application Insights or Cosmos DB to create monitoring dashboards, either using Application Insights itself, Power BI, or a custom web app dashboard.</span></span> <span data-ttu-id="5a047-308">如果發生嚴重錯誤或效能低於可接受的閾值，請將警示傳送至 DevOps 團隊。</span><span class="sxs-lookup"><span data-stu-id="5a047-308">Send alerts to the DevOps team if critical errors occur or performance falls below an acceptable threshold.</span></span>

### <a name="automated-resource-deployment"></a><span data-ttu-id="5a047-309">自動部署資源</span><span class="sxs-lookup"><span data-stu-id="5a047-309">Automated resource deployment</span></span>

<span data-ttu-id="5a047-310">聊天機器人本身只是大型系統的一部分，此系統會為其提供最新資料，並確保其正常運作。</span><span class="sxs-lookup"><span data-stu-id="5a047-310">The bot itself is only part of a larger system that provides it with the latest data and ensures its proper operation.</span></span> <span data-ttu-id="5a047-311">所有其他 Azure 資源 &mdash;資料協調流程服務 (例如 Data Factory)、儲存體服務 (例如 Cosmos DB) 等等&mdash; 必須加以部署。</span><span class="sxs-lookup"><span data-stu-id="5a047-311">All of these other Azure resources &mdash; data orchestration services such as Data Factory, storage services such as Cosmos DB, and so forth &mdash; must be deployed.</span></span> <span data-ttu-id="5a047-312">Azure Resource Manager 提供一致的管理層，您可以透過 Azure 入口網站、PowerShell 或 Azure CLI 來存取。</span><span class="sxs-lookup"><span data-stu-id="5a047-312">Azure Resource Manager provides a consistent management layer that you can access through the Azure portal, PowerShell, or the Azure CLI.</span></span> <span data-ttu-id="5a047-313">如需速度與一致性，最好使用其中一種方法，將您的部署自動化。</span><span class="sxs-lookup"><span data-stu-id="5a047-313">For speed and consistency, it's best to automate your deployment using one of these approaches.</span></span>

### <a name="continuous-bot-deployment"></a><span data-ttu-id="5a047-314">持續聊天機器人部署</span><span class="sxs-lookup"><span data-stu-id="5a047-314">Continuous bot deployment</span></span>

<span data-ttu-id="5a047-315">您可以從 IDE 或從命令列直接部署聊天機器人，例如 Azure CLI 邏輯。</span><span class="sxs-lookup"><span data-stu-id="5a047-315">You can deploy the bot logic directly from your IDE or from a command line, such as the Azure CLI.</span></span> <span data-ttu-id="5a047-316">不過，當您的聊天機器人成熟時，最好利用 CI/CD 解決方案 (例如 Azure DevOps) 來使用持續部署程序，如[設定持續部署](/azure/bot-service/bot-service-build-continuous-deployment)所述。</span><span class="sxs-lookup"><span data-stu-id="5a047-316">As your bot matures, however, it's best to use a continual deployment process using a CI/CD solution such as Azure DevOps, as described in the article [Set up continuous deployment](/azure/bot-service/bot-service-build-continuous-deployment).</span></span> <span data-ttu-id="5a047-317">這是一種很好的方法，可以減輕在近乎生產環境中測試機器人中新功能和修正的摩擦。</span><span class="sxs-lookup"><span data-stu-id="5a047-317">This is a good way to ease the friction in testing new features and fixes in your bot in a near-production environment.</span></span> <span data-ttu-id="5a047-318">具有多個部署環境 (通常至少有暫存和生產環境) 也是個不錯的主意。</span><span class="sxs-lookup"><span data-stu-id="5a047-318">It's also a good idea to have multiple deployment environments, typically at least staging and production.</span></span> <span data-ttu-id="5a047-319">Azure DevOps 支援這個方法。</span><span class="sxs-lookup"><span data-stu-id="5a047-319">Azure DevOps supports this approach.</span></span>

<!-- links -->

[0]: ./_images/conversational-bot.png
[aad]: /azure/active-directory/
[活動]: /azure/bot-service/rest-api/bot-framework-rest-connector-activities
[activities]: /azure/bot-service/rest-api/bot-framework-rest-connector-activities
[aml]: /azure/machine-learning/service/
[app-insights]: /azure/azure-monitor/app/app-insights-overview
[app-service]: /azure/app-service/
[blob]: /azure/storage/blobs/storage-blobs-introduction
[bot-authentication]: /azure/bot-service/bot-builder-authentication
[bot-framework]: https://dev.botframework.com/
[bot-framework-service]: /azure/bot-service/bot-builder-basics
[cognitive-services]: /azure/cognitive-services/welcome
[交談]: /azure/bot-service/bot-service-design-conversation-flow
[conversations]: /azure/bot-service/bot-service-design-conversation-flow
[cosmosdb]: /azure/cosmos-db/
[data-factory]: /azure/data-factory/
[data-factory-ref-arch]: ../data/enterprise-bi-adf.md
[devops]: https://azure.microsoft.com/solutions/devops/
[functions]: /azure/azure-functions/
[functions-triggers]: /azure/azure-functions/functions-triggers-bindings
[git-repo-appinsights-logger]: https://github.com/Microsoft/botbuilder-utils-js/tree/master/packages/botbuilder-transcript-app-insights
[git-repo-base]: https://github.com/Microsoft/botbuilder-utils-js
[git-repo-cosmosdb-logger]: https://github.com/Microsoft/botbuilder-utils-js/tree/master/packages/botbuilder-transcript-cosmosdb
[git-repo-feedback-util]: https://github.com/Microsoft/botbuilder-utils-js/tree/master/packages/botbuilder-feedback
[git-repo-testing-util]: https://github.com/Microsoft/botbuilder-utils-js/tree/master/packages/botbuilder-http-test-recorder
[testing-util]: https://github.com/Microsoft/botbuilder-utils-js/tree/master/packages/botbuilder-http-test-recorder
[key-vault]: /azure/key-vault/
[lda]: https://wikipedia.org/wiki/Latent_Dirichlet_allocation/
[logic-apps]: /azure/logic-apps/logic-apps-overview
[luis]: /azure/cognitive-services/luis/
[power-bi]: /power-bi/
[qna-maker]: /azure/cognitive-services/QnAMaker/
[search]: /azure/search/
[slots]: /azure/app-service/deploy-staging-slots/
[synonyms]: /azure/search/search-synonyms
[transcript-storage]: /azure/bot-service/bot-builder-howto-v4-storage
[回合]: /azure/bot-service/bot-builder-basics#defining-a-turn
[turns]: /azure/bot-service/bot-builder-basics#defining-a-turn
[vscode]: https://azure.microsoft.com/products/visual-studio-code/
[webapp]: /azure/app-service/overview
[webchat]: /azure/bot-service/bot-service-channel-connect-webchat?view=azure-bot-service-4.0/

[cosmosdb-logger]: https://github.com/Microsoft/botbuilder-utils-js/tree/master/packages/botbuilder-transcript-cosmosdb
[appinsights-logger]: https://github.com/Microsoft/botbuilder-utils-js/tree/master/packages/botbuilder-transcript-app-insights
[feedback-util]: https://github.com/Microsoft/botbuilder-utils-js/tree/master/packages/botbuilder-feedback
[testing util]: https://github.com/Microsoft/botbuilder-utils-js/tree/master/packages/botbuilder-http-test-recorder
