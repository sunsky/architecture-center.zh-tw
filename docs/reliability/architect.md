---
title: 建構恢復功能和可用性的 Azure 應用的程式
description: 在 Azure 的應用程式中建置復原功能和可用性
author: MikeWasson
ms.date: 04/10/2019
ms.topic: article
ms.service: architecture-center
ms.subservice: cloud-design-principles
ms.openlocfilehash: ee4bb5b4a85e48fe0ff017297c31823c93a48f04
ms.sourcegitcommit: 579c39ff4b776704ead17a006bf24cd4cdc65edd
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/17/2019
ms.locfileid: "59646520"
---
# <a name="architecting-azure-applications-for-resiliency-and-availability"></a><span data-ttu-id="f135e-103">建構恢復功能和可用性的 Azure 應用的程式</span><span class="sxs-lookup"><span data-stu-id="f135e-103">Architecting Azure applications for resiliency and availability</span></span>

<span data-ttu-id="f135e-104">您已針對您的應用程式開發的需求之後下, 一個步驟是要內建的復原和可用性。</span><span class="sxs-lookup"><span data-stu-id="f135e-104">After you've developed the requirements for your application, the next step is to build resiliency and availability into it.</span></span> <span data-ttu-id="f135e-105">這些特質無法加入結尾&mdash;您必須將它們設計架構。</span><span class="sxs-lookup"><span data-stu-id="f135e-105">These qualities can't be added at the end &mdash; you must design them into the architecture.</span></span>

## <a name="conduct-a-failure-mode-analysis"></a><span data-ttu-id="f135e-106">執行失敗模式分析</span><span class="sxs-lookup"><span data-stu-id="f135e-106">Conduct a failure mode analysis</span></span>

<span data-ttu-id="f135e-107">*失敗模式分析*(FMA) 系統中內建復原功能，透過識別可能的失敗點，並定義應用程式如何回應這些失敗。</span><span class="sxs-lookup"><span data-stu-id="f135e-107">*Failure mode analysis* (FMA) builds resiliency into a system by identifying possible failure points and defining how the application responds to those failures.</span></span> <span data-ttu-id="f135e-108">FMA 應該是架構和設計階段中的一部分，因此從一開始在系統內建失敗復原。</span><span class="sxs-lookup"><span data-stu-id="f135e-108">The FMA should be part of the architecture and design phases, so failure recovery is built into the system from the beginning.</span></span> <span data-ttu-id="f135e-109">FMA 的目標是：</span><span class="sxs-lookup"><span data-stu-id="f135e-109">The goals of an FMA are to:</span></span>

- <span data-ttu-id="f135e-110">決定應用程式可能遭遇哪些失敗類型，以及如何應用程式會偵測這些失敗。</span><span class="sxs-lookup"><span data-stu-id="f135e-110">Determine what types of failures an application might experience and how the application detects those failures.</span></span>
- <span data-ttu-id="f135e-111">擷取每種失敗的潛在影響，並決定應用程式的回應方式。</span><span class="sxs-lookup"><span data-stu-id="f135e-111">Capture the potential effects of each type of failure and determine how the app responds.</span></span>
- <span data-ttu-id="f135e-112">規劃記錄和監視失敗，並找出復原策略。</span><span class="sxs-lookup"><span data-stu-id="f135e-112">Plan for logging and monitoring the failure and identify recovery strategies.</span></span>

<span data-ttu-id="f135e-113">以下是一些範例的失敗模式和特定的失敗點的偵測策略&mdash;呼叫外部 web 服務：</span><span class="sxs-lookup"><span data-stu-id="f135e-113">Here are some examples of failure modes and detection strategies for a specific failure point &mdash; a call to an external web service:</span></span>

| <span data-ttu-id="f135e-114">失敗模式</span><span class="sxs-lookup"><span data-stu-id="f135e-114">Failure mode</span></span>           | <span data-ttu-id="f135e-115">偵測策略</span><span class="sxs-lookup"><span data-stu-id="f135e-115">Detection strategy</span></span>           |
|------------------------|------------------------------|
| <span data-ttu-id="f135e-116">服務停用</span><span class="sxs-lookup"><span data-stu-id="f135e-116">Service is unavailable</span></span> | <span data-ttu-id="f135e-117">HTTP 5xx</span><span class="sxs-lookup"><span data-stu-id="f135e-117">HTTP 5xx</span></span>                     |
| <span data-ttu-id="f135e-118">節流</span><span class="sxs-lookup"><span data-stu-id="f135e-118">Throttling</span></span>             | <span data-ttu-id="f135e-119">HTTP 429 (太多要求)</span><span class="sxs-lookup"><span data-stu-id="f135e-119">HTTP 429 (Too Many Requests)</span></span> |
| <span data-ttu-id="f135e-120">Authentication</span><span class="sxs-lookup"><span data-stu-id="f135e-120">Authentication</span></span>         | <span data-ttu-id="f135e-121">HTTP 401 (未經授權)</span><span class="sxs-lookup"><span data-stu-id="f135e-121">HTTP 401 (Unauthorized)</span></span>      |
| <span data-ttu-id="f135e-122">回應變慢</span><span class="sxs-lookup"><span data-stu-id="f135e-122">Slow response</span></span>          | <span data-ttu-id="f135e-123">要求逾時</span><span class="sxs-lookup"><span data-stu-id="f135e-123">Request times out</span></span>            |

<span data-ttu-id="f135e-124">如需有關 Azure 中的特定建議事項的 FMA 程序，請參閱[失敗模式分析](../resiliency/failure-mode-analysis.md)。</span><span class="sxs-lookup"><span data-stu-id="f135e-124">For more information about the FMA process, with specific recommendations for Azure, see [Failure mode analysis](../resiliency/failure-mode-analysis.md).</span></span>

## <a name="plan-for-redundancy"></a><span data-ttu-id="f135e-125">如需備援的計劃</span><span class="sxs-lookup"><span data-stu-id="f135e-125">Plan for redundancy</span></span>

<span data-ttu-id="f135e-126">失敗會在範圍內的影響而有所不同。</span><span class="sxs-lookup"><span data-stu-id="f135e-126">Failures vary in scope of impact.</span></span> <span data-ttu-id="f135e-127">有些硬體失敗，例如失敗的磁碟，會影響單一主機電腦。</span><span class="sxs-lookup"><span data-stu-id="f135e-127">Some hardware failures, such as a failed disk, affect a single host machine.</span></span> <span data-ttu-id="f135e-128">失敗的網路交換器則可能影響整個伺服器機架。</span><span class="sxs-lookup"><span data-stu-id="f135e-128">A failed network switch could affect an entire server rack.</span></span> <span data-ttu-id="f135e-129">較不常見的失敗，例如失去電源，會中斷整個資料中心。</span><span class="sxs-lookup"><span data-stu-id="f135e-129">Less common failures, such as loss of power, disrupt a whole datacenter.</span></span> <span data-ttu-id="f135e-130">很少，整個區域變得無法使用。</span><span class="sxs-lookup"><span data-stu-id="f135e-130">Rarely, an entire region becomes unavailable.</span></span>

<span data-ttu-id="f135e-131">備援是一種方式讓應用程式具有恢復功能。</span><span class="sxs-lookup"><span data-stu-id="f135e-131">Redundancy is one way to make an application resilient.</span></span> <span data-ttu-id="f135e-132">備援層級取決於您的業務需求&mdash;並非每個應用程式需要備援，跨區域，以防範區域性中斷。</span><span class="sxs-lookup"><span data-stu-id="f135e-132">The level of redundancy depends on your business requirements &mdash; not every application needs redundancy across regions to guard against a regional outage.</span></span> <span data-ttu-id="f135e-133">一般情況下，沒有更高的備援性和可靠性與更高的成本和複雜性之間權衡取捨。</span><span class="sxs-lookup"><span data-stu-id="f135e-133">In general, there's a tradeoff between greater redundancy and reliability versus higher costs and complexity.</span></span>

### <a name="review-azure-redundancy-features"></a><span data-ttu-id="f135e-134">檢閱 Azure 備援功能</span><span class="sxs-lookup"><span data-stu-id="f135e-134">Review Azure redundancy features</span></span>

<span data-ttu-id="f135e-135">Azure 會有多重備援功能失敗，整個區域個別虛擬機器 (VM) 的每個層級。</span><span class="sxs-lookup"><span data-stu-id="f135e-135">Azure has a number of redundancy features at every level of failure, from an individual virtual machine (VM) to an entire region.</span></span>

- <span data-ttu-id="f135e-136">**單一 Vm 也**有[的執行時間服務等級協定 (SLA)](https://azure.microsoft.com/support/legal/sla/virtual-machines) Azure 所提供。</span><span class="sxs-lookup"><span data-stu-id="f135e-136">**Single VMs** have an [uptime service level agreement (SLA)](https://azure.microsoft.com/support/legal/sla/virtual-machines) provided by Azure.</span></span> <span data-ttu-id="f135e-137">（VM 必須使用進階儲存體的所有作業系統磁碟和資料磁碟）。雖然您可以透過執行兩個以上的 VM 來獲得更高的 SLA，但對於某些工作負載來說，單一 VM 或許就已足夠。</span><span class="sxs-lookup"><span data-stu-id="f135e-137">(The VM must use premium storage for all operating system disks and data disks.) Although you can get a higher SLA by running two or more VMs, a single VM may be reliable enough for some workloads.</span></span> <span data-ttu-id="f135e-138">至於生產工作負載，我們建議使用兩個以上的 VM 來作為備援。</span><span class="sxs-lookup"><span data-stu-id="f135e-138">For production workloads, however, we recommend using two or more VMs for redundancy.</span></span>
- <span data-ttu-id="f135e-139">**可用性設定組**防範當地語系化的硬體失敗，例如磁碟或網路交換器失敗。</span><span class="sxs-lookup"><span data-stu-id="f135e-139">**Availability sets** protect against localized hardware failures, such as a disk or network switch failing.</span></span> <span data-ttu-id="f135e-140">在可用性設定組中的 Vm 會分散到最多三個*容錯網域*。</span><span class="sxs-lookup"><span data-stu-id="f135e-140">VMs in an availability set are distributed across up to three *fault domains*.</span></span> <span data-ttu-id="f135e-141">容錯網域定義一組共用通用電源和網路交換器的 Vm。</span><span class="sxs-lookup"><span data-stu-id="f135e-141">A fault domains defines a group of VMs that share a common power source and network switch.</span></span> <span data-ttu-id="f135e-142">如果硬體故障會影響一個容錯網域，網路流量會路由到其他容錯網域中的 Vm。</span><span class="sxs-lookup"><span data-stu-id="f135e-142">If a hardware failure affects one fault domain, network traffic is routed to VMs in the other fault domains.</span></span> <span data-ttu-id="f135e-143">如需有關可用性設定組的詳細資訊，請參閱[管理 Azure 中 Windows 虛擬機器的可用性](/azure/virtual-machines/windows/manage-availability)。</span><span class="sxs-lookup"><span data-stu-id="f135e-143">For more information about availability sets, see [Manage the availability of Windows virtual machines in Azure](/azure/virtual-machines/windows/manage-availability).</span></span>
- <span data-ttu-id="f135e-144">**可用性區域**是 Azure 區域內實際分開的區域。</span><span class="sxs-lookup"><span data-stu-id="f135e-144">**Availability Zones** are physically separate zones within an Azure region.</span></span> <span data-ttu-id="f135e-145">每個可用性區域各有不同的電力來源、網路和冷卻系統。</span><span class="sxs-lookup"><span data-stu-id="f135e-145">Each Availability Zone has a distinct power source, network, and cooling.</span></span> <span data-ttu-id="f135e-146">將 Vm 部署在可用性區域可協助保護應用程式防範全資料中心失敗。</span><span class="sxs-lookup"><span data-stu-id="f135e-146">Deploying VMs across Availability Zones helps to protect an application against datacenter-wide failures.</span></span> <span data-ttu-id="f135e-147">並非所有區域都支援可用性區域。</span><span class="sxs-lookup"><span data-stu-id="f135e-147">Not all regions support Availability Zones.</span></span> <span data-ttu-id="f135e-148">如需支援的區域和服務清單，請參閱[什麼是 Azure 中的可用性區域？](/azure/availability-zones/az-overview)。</span><span class="sxs-lookup"><span data-stu-id="f135e-148">For a list of supported regions and services, see [What are Availability Zones in Azure?](/azure/availability-zones/az-overview).</span></span>

    <span data-ttu-id="f135e-149">如果您打算使用可用性區域，您的部署中，先驗證您的應用程式架構和程式碼基底支援此設定。</span><span class="sxs-lookup"><span data-stu-id="f135e-149">If you plan to use Availability Zones in your deployment, first validate that your application architecture and codebase support this configuration.</span></span> <span data-ttu-id="f135e-150">如果您部署商業軟體，請洽詢軟體廠商，並部署到生產環境之前適當地測試。</span><span class="sxs-lookup"><span data-stu-id="f135e-150">If you deploy commercial software, consult with the software vendor and test adequately before deploying into production.</span></span> <span data-ttu-id="f135e-151">應用程式必須維護狀態，並已設定的區域內中斷期間避免資料遺失。</span><span class="sxs-lookup"><span data-stu-id="f135e-151">An application must maintain state and prevent loss of data during an outage within the configured zone.</span></span> <span data-ttu-id="f135e-152">應用程式必須支援在沒有任何硬式編碼的基礎結構元件的彈性和分散式基礎結構中執行。</span><span class="sxs-lookup"><span data-stu-id="f135e-152">The application must support running in an elastic and distributed infrastructure with no hard-coded infrastructure components.</span></span>
- <span data-ttu-id="f135e-153">**Azure Site Recovery**複寫 Azure 虛擬機器到另一個 Azure 區域 (BC) 的業務續航力和災害復原 (DR) 需求。</span><span class="sxs-lookup"><span data-stu-id="f135e-153">**Azure Site Recovery** replicates Azure Virtual Machines to another Azure region for business continuity (BC) and disaster recovery (DR) needs.</span></span> <span data-ttu-id="f135e-154">您可以進行定期 DR 切入，以確保您符合合規性需求。</span><span class="sxs-lookup"><span data-stu-id="f135e-154">You can conduct periodic DR drills to ensure that you meet the compliance needs.</span></span> <span data-ttu-id="f135e-155">VM 會複寫使用指定的設定到選取的區域中，因此您可以復原您的應用程式發生來源區域中的中斷事件時。</span><span class="sxs-lookup"><span data-stu-id="f135e-155">The VM is replicated with the specified settings to the selected region so you can recover your applications in the event of outages in the source region.</span></span> <span data-ttu-id="f135e-156">如需詳細資訊，請參閱 <<c0> [ 設定為 Azure 虛擬機器的災害復原至次要 Azure 區域](/azure/site-recovery/azure-to-azure-quickstart/)。</span><span class="sxs-lookup"><span data-stu-id="f135e-156">For more information, see [Set up disaster recovery to a secondary Azure region for an Azure VM](/azure/site-recovery/azure-to-azure-quickstart/).</span></span>

    <span data-ttu-id="f135e-157">在測試期間，確認*復原時間目標*(RTO) 和*復原點目標*(RPO) 符合您的需求。</span><span class="sxs-lookup"><span data-stu-id="f135e-157">During testing, verify that the *recovery time objective* (RTO) and *recovery point objective* (RPO) meet your needs.</span></span> <span data-ttu-id="f135e-158">RTO 是應用程式之後的事件，即無法使用的時間上限，RPO 的最大資料遺失時間長度在災害期間。</span><span class="sxs-lookup"><span data-stu-id="f135e-158">RTO is the maximum time an application is unavailable after an incident, and RPO is the maximum duration of data loss during a disaster.</span></span>
- <span data-ttu-id="f135e-159">**配對的區域**會建立使用 Azure 流量管理員將網際網路流量分散到不同的區域，保護應用程式防範區域性中斷。</span><span class="sxs-lookup"><span data-stu-id="f135e-159">**Paired regions** are created using Azure Traffic Manager to distribute Internet traffic to different regions, protecting an application against a regional outage.</span></span> <span data-ttu-id="f135e-160">每個 Azure 區域都會與另一個區域配對。</span><span class="sxs-lookup"><span data-stu-id="f135e-160">Each Azure region is paired with another region.</span></span> <span data-ttu-id="f135e-161">在一起，這些區域會構成[*區域配對*](/azure/best-practices-availability-paired-regions)。</span><span class="sxs-lookup"><span data-stu-id="f135e-161">Together, these regions form a [*regional pair*](/azure/best-practices-availability-paired-regions).</span></span> <span data-ttu-id="f135e-162">為了符合資料常駐地之稅務和執法強制管轄，區域性配對會位於相同的地理位置 （巴西南部除外）。</span><span class="sxs-lookup"><span data-stu-id="f135e-162">To meet data residency requirements for tax and law enforcement jurisdiction purposes, regional pairs are located within the same geography (with the exception of Brazil South).</span></span>

    <span data-ttu-id="f135e-163">若要改善應用程式恢復功能，Azure 會將平台更新 （計劃性維護） 序列化跨每個區域配對，因此只有一個配對的區域會更新一次。</span><span class="sxs-lookup"><span data-stu-id="f135e-163">To improve application resiliency, Azure serializes platform updates (planned maintenance) across each region pair, so only one paired region is updated at a time.</span></span>
- <span data-ttu-id="f135e-164">當您設計的多區域應用程式時，請考慮跨區域的網路延遲會高於單一區域內的帳戶。</span><span class="sxs-lookup"><span data-stu-id="f135e-164">When you design a multiregion application, take into account that network latency across regions is higher than within a region.</span></span> <span data-ttu-id="f135e-165">比方說，如果您要複寫的資料庫，啟用容錯移轉，使用單一區域內的同步資料複寫，但非同步資料複寫跨區域。</span><span class="sxs-lookup"><span data-stu-id="f135e-165">For example, if you replicate a database to enable failover, use synchronous data replication within a region but asynchronous data replication across regions.</span></span>

<span data-ttu-id="f135e-166">下表比較跨數個復原策略的冗餘因素：</span><span class="sxs-lookup"><span data-stu-id="f135e-166">The following table compares the redundancy factors across several resiliency strategies:</span></span>

| &nbsp; | <span data-ttu-id="f135e-167">可用性設定組</span><span class="sxs-lookup"><span data-stu-id="f135e-167">Availability set</span></span> | <span data-ttu-id="f135e-168">可用性區域</span><span class="sxs-lookup"><span data-stu-id="f135e-168">Availability Zone</span></span> | <span data-ttu-id="f135e-169">Azure Site Recovery/配對的區域</span><span class="sxs-lookup"><span data-stu-id="f135e-169">Azure Site Recovery/Paired region</span></span> |
|--------|------------------|-------------------|-----------------------------------|
| <span data-ttu-id="f135e-170">失敗原因</span><span class="sxs-lookup"><span data-stu-id="f135e-170">Scope of failure</span></span> | <span data-ttu-id="f135e-171">機架</span><span class="sxs-lookup"><span data-stu-id="f135e-171">Rack</span></span>                  | <span data-ttu-id="f135e-172">資料中心</span><span class="sxs-lookup"><span data-stu-id="f135e-172">Datacenter</span></span>               | <span data-ttu-id="f135e-173">區域</span><span class="sxs-lookup"><span data-stu-id="f135e-173">Region</span></span>                               |
| <span data-ttu-id="f135e-174">要求路由</span><span class="sxs-lookup"><span data-stu-id="f135e-174">Request routing</span></span>  | <span data-ttu-id="f135e-175">Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="f135e-175">Azure Load Balancer</span></span>   | <span data-ttu-id="f135e-176">跨區域負載平衡器</span><span class="sxs-lookup"><span data-stu-id="f135e-176">Cross-zone Load Balancer</span></span> | <span data-ttu-id="f135e-177">Azure 流量管理員</span><span class="sxs-lookup"><span data-stu-id="f135e-177">Azure Traffic Manager</span></span>                |
| <span data-ttu-id="f135e-178">網路延遲</span><span class="sxs-lookup"><span data-stu-id="f135e-178">Network latency</span></span>  | <span data-ttu-id="f135e-179">非常低</span><span class="sxs-lookup"><span data-stu-id="f135e-179">Very low</span></span>              | <span data-ttu-id="f135e-180">低</span><span class="sxs-lookup"><span data-stu-id="f135e-180">Low</span></span>                      | <span data-ttu-id="f135e-181">中到高</span><span class="sxs-lookup"><span data-stu-id="f135e-181">Mid to high</span></span>                          |
| <span data-ttu-id="f135e-182">虛擬網路</span><span class="sxs-lookup"><span data-stu-id="f135e-182">Virtual network</span></span>  | <span data-ttu-id="f135e-183">Azure 虛擬網路</span><span class="sxs-lookup"><span data-stu-id="f135e-183">Azure Virtual Network</span></span> | <span data-ttu-id="f135e-184">Azure 虛擬網路</span><span class="sxs-lookup"><span data-stu-id="f135e-184">Azure Virtual Network</span></span>          | <span data-ttu-id="f135e-185">跨區域虛擬網路對等互連</span><span class="sxs-lookup"><span data-stu-id="f135e-185">Cross-region Virtual Network peering</span></span> |

### <a name="complete-azure-redundancy-tasks"></a><span data-ttu-id="f135e-186">完整的 Azure 複本建立工作</span><span class="sxs-lookup"><span data-stu-id="f135e-186">Complete Azure redundancy tasks</span></span>

<span data-ttu-id="f135e-187">備援的需求，使用下列工作：</span><span class="sxs-lookup"><span data-stu-id="f135e-187">Use the following tasks to meet redundancy requirements:</span></span>

- <span data-ttu-id="f135e-188">**部署多個服務執行個體。**</span><span class="sxs-lookup"><span data-stu-id="f135e-188">**Deploy multiple instances of services.**</span></span> <span data-ttu-id="f135e-189">如果您的應用程式相依於服務的單一執行個體，它會建立單一失敗點。</span><span class="sxs-lookup"><span data-stu-id="f135e-189">If your application depends on a single instance of a service, it creates a single point of failure.</span></span> <span data-ttu-id="f135e-190">佈建多個執行個體，可改善復原能力和延展性。</span><span class="sxs-lookup"><span data-stu-id="f135e-190">Provisioning multiple instances improves both resiliency and scalability.</span></span> <span data-ttu-id="f135e-191">對於 [Azure App Service](/azure/app-service/app-service-value-prop-what-is/)，請選擇可提供多個執行個體的 [App Service 方案](/azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview/)。</span><span class="sxs-lookup"><span data-stu-id="f135e-191">For [Azure App Service](/azure/app-service/app-service-value-prop-what-is/), select an [App Service plan](/azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview/) that offers multiple instances.</span></span> <span data-ttu-id="f135e-192">針對[Azure 虛擬機器](/azure/virtual-machines/virtual-machines-windows-about/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)，請確定您的架構有多個 VM，並中包含的每個 VM[可用性設定組](/azure/virtual-machines/virtual-machines-windows-manage-availability/)。</span><span class="sxs-lookup"><span data-stu-id="f135e-192">For [Azure Virtual Machines](/azure/virtual-machines/virtual-machines-windows-about/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json), ensure that your architecture has more than one VM and that each VM is included in an [availability set](/azure/virtual-machines/virtual-machines-windows-manage-availability/).</span></span>

- <span data-ttu-id="f135e-193">**使用 Azure Site Recovery 複寫 VM。**</span><span class="sxs-lookup"><span data-stu-id="f135e-193">**Replicate VMs using Azure Site Recovery.**</span></span> <span data-ttu-id="f135e-194">使用 Azure Vm 的複寫時[Site Recovery](/azure/site-recovery/)，所有 VM 磁碟持續會以非同步方式都複寫到目標區域。</span><span class="sxs-lookup"><span data-stu-id="f135e-194">When you replicate Azure VMs using [Site Recovery](/azure/site-recovery/), all the VM disks are continuously replicated to the target region asynchronously.</span></span> <span data-ttu-id="f135e-195">建立復原點會每隔幾分鐘，讓大約幾分鐘的 RPO。</span><span class="sxs-lookup"><span data-stu-id="f135e-195">The recovery points are created every few minutes, giving an RPO on the order of minutes.</span></span>

- <span data-ttu-id="f135e-196">**請考慮在多個區域中部署您的應用程式。**</span><span class="sxs-lookup"><span data-stu-id="f135e-196">**Consider deploying your application across multiple regions.**</span></span> <span data-ttu-id="f135e-197">如果您的應用程式部署到單一區域中，而且區域變成無法使用，也會無法使用您的應用程式。</span><span class="sxs-lookup"><span data-stu-id="f135e-197">If your application is deployed to a single region, and the region becomes unavailable, your application will also be unavailable.</span></span> <span data-ttu-id="f135e-198">您應用程式的 SLA 條款可能無法接受這種情況。</span><span class="sxs-lookup"><span data-stu-id="f135e-198">This may be unacceptable under the terms of your application's SLA.</span></span> <span data-ttu-id="f135e-199">若是如此，請考慮在多個區域中部署您的應用程式及其服務。</span><span class="sxs-lookup"><span data-stu-id="f135e-199">If so, consider deploying your application and its services across multiple regions.</span></span> <span data-ttu-id="f135e-200">多區域部署可以使用*主動-主動*或是*主動-被動*組態。</span><span class="sxs-lookup"><span data-stu-id="f135e-200">A multiregion deployment can use an *active-active* or *active-passive* configuration.</span></span> <span data-ttu-id="f135e-201">主動-主動組態會將要求分散到多個使用中的區域。</span><span class="sxs-lookup"><span data-stu-id="f135e-201">An active-active configuration distributes requests across multiple active regions.</span></span> <span data-ttu-id="f135e-202">主動-被動組態在次要區域中，保留熱的執行個體，但不會傳送流量那里除非主要區域失敗。</span><span class="sxs-lookup"><span data-stu-id="f135e-202">An active-passive configuration keeps warm instances in the secondary region, but doesn't send traffic there unless the primary region fails.</span></span> <span data-ttu-id="f135e-203">多區域部署中，我們建議您部署至配對的區域，上面所述。</span><span class="sxs-lookup"><span data-stu-id="f135e-203">For multiregion deployments, we recommend deploying to paired regions, described above.</span></span> <span data-ttu-id="f135e-204">如需詳細資訊，請參閱[商務持續性和災害復原 (BCDR)：Azure 配對的區域](/azure/best-practices-availability-paired-regions)。</span><span class="sxs-lookup"><span data-stu-id="f135e-204">For more information, see [Business continuity and disaster recovery (BCDR): Azure Paired Regions](/azure/best-practices-availability-paired-regions).</span></span>

- <span data-ttu-id="f135e-205">**使用 Azure 流量管理員將應用程式的流量傳送到不同的區域。**</span><span class="sxs-lookup"><span data-stu-id="f135e-205">**Use Azure Traffic Manager to route your application's traffic to different regions.**</span></span> <span data-ttu-id="f135e-206">[Azure 流量管理員](/azure/traffic-manager/traffic-manager-overview/)執行 DNS 層級的 負載平衡，並將流量路由至不同的區域，視[流量路由](/azure/traffic-manager/traffic-manager-routing-methods/)方法和您的應用程式端點的健全狀況。</span><span class="sxs-lookup"><span data-stu-id="f135e-206">[Azure Traffic Manager](/azure/traffic-manager/traffic-manager-overview/) performs load-balancing at the DNS level and routes traffic to different regions based on the [traffic routing](/azure/traffic-manager/traffic-manager-routing-methods/) method and the health of your application's endpoints.</span></span> <span data-ttu-id="f135e-207">不使用流量管理員，您受限於單一區域部署，它會限制規模、 會增加延遲某些使用者，並會導致應用程式的停機時間，在全區域服務中斷的情況下。</span><span class="sxs-lookup"><span data-stu-id="f135e-207">Without Traffic Manager, you are limited to a single region for your deployment, which constrains scale, increases latency for some users, and causes application downtime, in the case of a region-wide service disruption.</span></span>

- <span data-ttu-id="f135e-208">**Azure 應用程式閘道設定為使用多個執行個體。**</span><span class="sxs-lookup"><span data-stu-id="f135e-208">**Configure Azure Application Gateway to use multiple instances.**</span></span> <span data-ttu-id="f135e-209">根據您應用程式的需求，[Azure 應用程式閘道](/azure/application-gateway/application-gateway-introduction/)可能更適合用於將要求分配至您應用程式的服務。</span><span class="sxs-lookup"><span data-stu-id="f135e-209">Depending on your application's requirements, an [Azure Application Gateway](/azure/application-gateway/application-gateway-introduction/) may be better suited to distributing requests to your application's services.</span></span> <span data-ttu-id="f135e-210">不過，單一執行個體的應用程式閘道服務不保證 sla，因此很可能您的應用程式可能會失敗，如果應用程式閘道執行個體失敗。</span><span class="sxs-lookup"><span data-stu-id="f135e-210">However, single instances of the Application Gateway service are not guaranteed by an SLA, so it's possible that your application could fail if the Application Gateway instance fails.</span></span> <span data-ttu-id="f135e-211">佈建一個以上中型或大型執行個體，以確保可用性的服務條款[應用程式閘道的 SLA](https://azure.microsoft.com/support/legal/sla/application-gateway/)。</span><span class="sxs-lookup"><span data-stu-id="f135e-211">Provision more than one medium or larger instance to guarantee availability of the service under the terms of the [Application Gateway SLA](https://azure.microsoft.com/support/legal/sla/application-gateway/).</span></span>

## <a name="design-for-scalability"></a><span data-ttu-id="f135e-212">延展性設計</span><span class="sxs-lookup"><span data-stu-id="f135e-212">Design for scalability</span></span>

<span data-ttu-id="f135e-213">*延展性*是系統能夠處理增加的負載，而且其中一個[軟體品質要素](../guide/pillars.md)。</span><span class="sxs-lookup"><span data-stu-id="f135e-213">*Scalability* is the ability of a system to handle increased load and is one of the [pillars of software quality](../guide/pillars.md).</span></span> <span data-ttu-id="f135e-214">擴充性架構的階段期間的工作包括：</span><span class="sxs-lookup"><span data-stu-id="f135e-214">Scalability tasks during the architecting phase include:</span></span>

- <span data-ttu-id="f135e-215">**資料分割的工作負載。**</span><span class="sxs-lookup"><span data-stu-id="f135e-215">**Partition workloads.**</span></span> <span data-ttu-id="f135e-216">將程序的組件設計為離散與可分解狀態。</span><span class="sxs-lookup"><span data-stu-id="f135e-216">Design parts of the process to be discrete and decomposable.</span></span> <span data-ttu-id="f135e-217">每個部分的大小降到最低。</span><span class="sxs-lookup"><span data-stu-id="f135e-217">Minimize the size of each part.</span></span> <span data-ttu-id="f135e-218">這可讓元件組件，以最大化每個計算單位使用的方式散發。</span><span class="sxs-lookup"><span data-stu-id="f135e-218">This allows the component parts to be distributed in a way that maximizes use of each compute unit.</span></span> <span data-ttu-id="f135e-219">它也能藉由新增特定資源的執行個體，更輕鬆地調整應用程式。</span><span class="sxs-lookup"><span data-stu-id="f135e-219">It also makes it easier to scale the application by adding instances of specific resources.</span></span> <span data-ttu-id="f135e-220">針對複雜的網域，請考慮採用[微服務架構](../guide/architecture-styles/microservices.md)。</span><span class="sxs-lookup"><span data-stu-id="f135e-220">For complex domains, consider adopting a [microservices architecture](../guide/architecture-styles/microservices.md).</span></span>
- <span data-ttu-id="f135e-221">**調整設計。**</span><span class="sxs-lookup"><span data-stu-id="f135e-221">**Design for scaling.**</span></span> <span data-ttu-id="f135e-222">調整可讓應用程式，以回應多變的負載增加和減少的角色、 佇列和其他服務的執行個體數目。</span><span class="sxs-lookup"><span data-stu-id="f135e-222">Scaling allows applications to react to variable load by increasing and decreasing the number of instances of roles, queues, and other services.</span></span> <span data-ttu-id="f135e-223">不過，設計應用程式時也必須考量到這一點。</span><span class="sxs-lookup"><span data-stu-id="f135e-223">However, the application must be designed with this in mind.</span></span> <span data-ttu-id="f135e-224">例如，應用程式和它所使用的服務必須是無狀態，以允許將要求路由傳送到任何執行個體。</span><span class="sxs-lookup"><span data-stu-id="f135e-224">For example, the application and the services it uses must be stateless to allow requests to be routed to any instance.</span></span> <span data-ttu-id="f135e-225">具有無狀態服務，也表示，新增或移除執行個體不會造成不良影響目前的使用者。</span><span class="sxs-lookup"><span data-stu-id="f135e-225">Having stateless services also means that adding or removing an instance does not adversely impact current users.</span></span>
- <span data-ttu-id="f135e-226">**規劃成長的縮放單位。**</span><span class="sxs-lookup"><span data-stu-id="f135e-226">**Plan for growth with scale units.**</span></span> <span data-ttu-id="f135e-227">針對每個資源，了解調整上限，並使用分區化或分解超出這些限制。</span><span class="sxs-lookup"><span data-stu-id="f135e-227">For each resource, know the upper scaling limits, and use sharding or decomposition to go beyond those limits.</span></span> <span data-ttu-id="f135e-228">應用程式應設計為能藉由新增一或多個縮放單位來輕鬆調整。</span><span class="sxs-lookup"><span data-stu-id="f135e-228">Design the application so that it's easily scaled by adding one or more scale units.</span></span> <span data-ttu-id="f135e-229">根據定義完善的資源組決定系統縮放單位。</span><span class="sxs-lookup"><span data-stu-id="f135e-229">Determine the scale units for the system in terms of well-defined sets of resources.</span></span> <span data-ttu-id="f135e-230">這可讓套用的向外延展作業更容易且較不容易出錯的整體系統某部分缺乏資源所造成的負面影響。</span><span class="sxs-lookup"><span data-stu-id="f135e-230">This makes applying scale-out operations easier and less prone to negative impact caused by a lack of resources in some part of the overall system.</span></span> <span data-ttu-id="f135e-231">比方說，新增*X*前端 Vm 數目可能會需要*Y*數目更多佇列並*Z*數目來處理額外的工作負載的儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="f135e-231">For example, adding *X* number of front-end VMs might require *Y* number of additional queues and *Z* number of storage accounts to handle the additional workload.</span></span> <span data-ttu-id="f135e-232">讓縮放單位可以組成*X* VM 執行個體， *Y*佇列，並*Z*儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="f135e-232">So a scale unit could consist of *X* VM instances, *Y* queues, and *Z* storage accounts.</span></span>
- <span data-ttu-id="f135e-233">**避免用戶端親和性。**</span><span class="sxs-lookup"><span data-stu-id="f135e-233">**Avoid client affinity.**</span></span> <span data-ttu-id="f135e-234">可能的話，請確定應用程式不需要親和性。</span><span class="sxs-lookup"><span data-stu-id="f135e-234">Where possible, ensure that the application doesn't require affinity.</span></span> <span data-ttu-id="f135e-235">要求便會路由至任何執行個體，並執行個體數目無關。</span><span class="sxs-lookup"><span data-stu-id="f135e-235">Requests can then be routed to any instance, and the number of instances is irrelevant.</span></span> <span data-ttu-id="f135e-236">這也可避免進行儲存、擷取與維護每位使用者狀態資訊所產生的額外負荷。</span><span class="sxs-lookup"><span data-stu-id="f135e-236">This also avoids the overhead of storing, retrieving, and maintaining state information for each user.</span></span>
- <span data-ttu-id="f135e-237">**善用平台自動調整功能。**</span><span class="sxs-lookup"><span data-stu-id="f135e-237">**Take advantage of platform autoscaling features.**</span></span> <span data-ttu-id="f135e-238">使用內建自動調整功能，如果可能的話，而不是自訂或協力廠商的機制。</span><span class="sxs-lookup"><span data-stu-id="f135e-238">Use built-in autoscaling features when possible, rather than custom or third-party mechanisms.</span></span> <span data-ttu-id="f135e-239">使用排程的調整規則，可能的話，以確保資源沒有啟動延遲時間，也可以使用，但新增被動式自動調整規則，在適當，來應付非預期的變更的需求。</span><span class="sxs-lookup"><span data-stu-id="f135e-239">Use scheduled scaling rules, where possible, to ensure that resources are available without a startup delay, but add reactive autoscaling to the rules, where appropriate, to cope with unexpected changes in demand.</span></span> <span data-ttu-id="f135e-240">如需詳細資訊，請參閱 <<c0> [ 自動調整指引](../best-practices/auto-scaling.md)。</span><span class="sxs-lookup"><span data-stu-id="f135e-240">For more information, see [Autoscaling guidance](../best-practices/auto-scaling.md).</span></span>  

  <span data-ttu-id="f135e-241">如果您的應用程式未設定為隨著負載增加自動相應放大，很可能您的應用程式服務，將會失敗，如果它們充斥著使用者要求。</span><span class="sxs-lookup"><span data-stu-id="f135e-241">If your application isn't configured to scale out automatically as load increases, it's possible that your application's services will fail if they become saturated with user requests.</span></span> <span data-ttu-id="f135e-242">如需詳細資訊，請參閱下列文章：</span><span class="sxs-lookup"><span data-stu-id="f135e-242">For more information, see the following articles:</span></span>

  - <span data-ttu-id="f135e-243">一般：[延展性檢查清單](../checklist/scalability.md)</span><span class="sxs-lookup"><span data-stu-id="f135e-243">General: [Scalability checklist](../checklist/scalability.md)</span></span>
  - <span data-ttu-id="f135e-244">Azure App Service：[手動或自動調整執行個體計數](/azure/monitoring-and-diagnostics/insights-how-to-scale/)</span><span class="sxs-lookup"><span data-stu-id="f135e-244">Azure App Service: [Scale instance count manually or automatically](/azure/monitoring-and-diagnostics/insights-how-to-scale/)</span></span>
  - <span data-ttu-id="f135e-245">雲端服務：[如何自動調整雲端服務](/azure/cloud-services/cloud-services-how-to-scale/)</span><span class="sxs-lookup"><span data-stu-id="f135e-245">Cloud Services: [How to autoscale a Cloud Service](/azure/cloud-services/cloud-services-how-to-scale/)</span></span>
  - <span data-ttu-id="f135e-246">虛擬機器：[自動調整與虛擬機器擴展集](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-autoscale-overview/)</span><span class="sxs-lookup"><span data-stu-id="f135e-246">Virtual machines: [Automatic scaling and virtual machine scale sets](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-autoscale-overview/)</span></span>

- <span data-ttu-id="f135e-247">**卸載密集 CPU/IO 工作作為背景工作。**</span><span class="sxs-lookup"><span data-stu-id="f135e-247">**Offload intensive CPU/IO tasks as background tasks.**</span></span> <span data-ttu-id="f135e-248">如果預計需要很長的時間來執行服務的要求，或可能吸收大量資源，處理卸載至個別的工作。</span><span class="sxs-lookup"><span data-stu-id="f135e-248">If a request to a service is expected to take a long time to run or may absorb considerable resources, offload the processing to a separate task.</span></span> <span data-ttu-id="f135e-249">您可以使用背景工作來執行這些工作。</span><span class="sxs-lookup"><span data-stu-id="f135e-249">Use background jobs to execute these tasks.</span></span> <span data-ttu-id="f135e-250">這項策略可讓服務繼續接收更多的要求，並仍能繼續回應。</span><span class="sxs-lookup"><span data-stu-id="f135e-250">This strategy enables the service to continue receiving further requests and to remain responsive.</span></span> <span data-ttu-id="f135e-251">如需詳細資訊，請參閱「 [背景工作指引](../best-practices/background-jobs.md)」(英文)。</span><span class="sxs-lookup"><span data-stu-id="f135e-251">For more information, see [Background jobs guidance](../best-practices/background-jobs.md).</span></span>
- <span data-ttu-id="f135e-252">**將背景工作的工作負載。**</span><span class="sxs-lookup"><span data-stu-id="f135e-252">**Distribute the workload for background tasks.**</span></span> <span data-ttu-id="f135e-253">如果有許多的背景工作或工作需要相當長的時間或資源，請將工作分散多個計算單位。</span><span class="sxs-lookup"><span data-stu-id="f135e-253">If there are many background tasks or if the tasks require considerable time or resources, spread the work across multiple compute units.</span></span> <span data-ttu-id="f135e-254">[Competing Consumers Pattern (競爭取用者模式)](../patterns/competing-consumers.md)提供了一個可能的解決方案。</span><span class="sxs-lookup"><span data-stu-id="f135e-254">For one possible solution, see the [Competing Consumers pattern](../patterns/competing-consumers.md).</span></span>
- <span data-ttu-id="f135e-255">**請考慮朝向*無共用*架構。**</span><span class="sxs-lookup"><span data-stu-id="f135e-255">**Consider moving toward a *shared-nothing* architecture.**</span></span> <span data-ttu-id="f135e-256">此架構使用獨立且自給自足的節點具有單點的 （例如共用的服務或儲存體） 的爭用。</span><span class="sxs-lookup"><span data-stu-id="f135e-256">This architecture uses independent, self-sufficient nodes that have no single point of contention (such as shared services or storage).</span></span> <span data-ttu-id="f135e-257">理論上，這類系統幾乎可以無限期地調整。</span><span class="sxs-lookup"><span data-stu-id="f135e-257">In theory, such a system can scale almost indefinitely.</span></span> <span data-ttu-id="f135e-258">雖然以完全無共用架構的方法通常不實用，它可能會提供機會設計更好的延展性。</span><span class="sxs-lookup"><span data-stu-id="f135e-258">Although a fully shared-nothing approach is usually not practical, it may provide opportunities to design for better scalability.</span></span> <span data-ttu-id="f135e-259">邁向無共用架構的好例子包括資料分割，並避免使用伺服器端工作階段狀態和用戶端親和性。</span><span class="sxs-lookup"><span data-stu-id="f135e-259">Good examples of moving toward a shared-nothing architecture include partitioning data and avoiding the use of server-side session state and client affinity.</span></span>
- <span data-ttu-id="f135e-260">**設計您的應用程式儲存體需求，使其落在 Azure 儲存體延展性和效能目標。**</span><span class="sxs-lookup"><span data-stu-id="f135e-260">**Design your application's storage requirements to fall within Azure Storage scalability and performance targets.**</span></span> <span data-ttu-id="f135e-261">Azure 儲存體被設計來預先定義的延展性和效能目標內運作，所以設計您的應用程式使用這些目標內的儲存體。</span><span class="sxs-lookup"><span data-stu-id="f135e-261">Azure Storage is designed to function within predefined scalability and performance targets, so design your application to use storage within those targets.</span></span> <span data-ttu-id="f135e-262">如果您超過這些目標，您的應用程式就會發生儲存體節流。</span><span class="sxs-lookup"><span data-stu-id="f135e-262">If you exceed these targets, your application will experience storage throttling.</span></span> <span data-ttu-id="f135e-263">若要避免節流，佈建額外的儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="f135e-263">To avoid throttling, provision additional storage accounts.</span></span> <span data-ttu-id="f135e-264">如果您遭遇儲存體帳戶限制時，佈建額外的 Azure 訂用帳戶，然後佈建額外的儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="f135e-264">If you run up against the storage account limit, provision additional Azure subscriptions and then provision additional storage accounts there.</span></span> <span data-ttu-id="f135e-265">如需詳細資訊，請參閱 [Azure 儲存體延展性和效能目標](/azure/storage/storage-scalability-targets/)。</span><span class="sxs-lookup"><span data-stu-id="f135e-265">For more information, see [Azure Storage scalability and performance targets](/azure/storage/storage-scalability-targets/).</span></span>
- <span data-ttu-id="f135e-266">**為您的應用程式選取適當的 VM 大小。**</span><span class="sxs-lookup"><span data-stu-id="f135e-266">**Select the right VM size for your application.**</span></span> <span data-ttu-id="f135e-267">測量實際的 CPU、 記憶體、 磁碟和 I/O 生產環境中的 Vm，並確認您已選取 VM 大小就已足夠。</span><span class="sxs-lookup"><span data-stu-id="f135e-267">Measure the actual CPU, memory, disk, and I/O of your VMs in production, and verify that the VM size you've selected is sufficient.</span></span> <span data-ttu-id="f135e-268">如果未這麼做，您的應用程式可能會在 VM 接近其限制時遇到容量問題。</span><span class="sxs-lookup"><span data-stu-id="f135e-268">If not, your application may experience capacity issues as the VMs approach their limits.</span></span> <span data-ttu-id="f135e-269">[Azure 中的虛擬機器大小](/azure/virtual-machines/virtual-machines-windows-sizes/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)會詳細說明 VM 大小。</span><span class="sxs-lookup"><span data-stu-id="f135e-269">VM sizes are described in detail in [Sizes for virtual machines in Azure](/azure/virtual-machines/virtual-machines-windows-sizes/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span></span>

## <a name="determine-subscription-and-service-requirements"></a><span data-ttu-id="f135e-270">判斷訂用帳戶和服務的需求</span><span class="sxs-lookup"><span data-stu-id="f135e-270">Determine subscription and service requirements</span></span>

<span data-ttu-id="f135e-271">透過這些工作選擇正確的訂用帳戶和服務應用程式的功能：</span><span class="sxs-lookup"><span data-stu-id="f135e-271">Choose the right subscription and service features for your app by working through these tasks:</span></span>

- <span data-ttu-id="f135e-272">**評估需求，針對[Azure 訂用帳戶和服務限制](/azure/azure-subscription-service-limits/)。**</span><span class="sxs-lookup"><span data-stu-id="f135e-272">**Evaluate requirements against [Azure subscription and service limits](/azure/azure-subscription-service-limits/).**</span></span> <span data-ttu-id="f135e-273">*Azure 訂用帳戶*限制對特定資源類型，例如資源群組、 核心和儲存體帳戶的數目。</span><span class="sxs-lookup"><span data-stu-id="f135e-273">*Azure subscriptions* have limits on certain resource types, such as number of resource groups, cores, and storage accounts.</span></span> <span data-ttu-id="f135e-274">如果應用程式需求超過 Azure 訂用帳戶限制，請建立另一個 Azure 訂用帳戶並在其中佈建足夠的資源。</span><span class="sxs-lookup"><span data-stu-id="f135e-274">If your application requirements exceed Azure subscription limits, create another Azure subscription and provision sufficient resources there.</span></span> <span data-ttu-id="f135e-275">個別的 Azure 服務都有取用量限制&mdash;，例如儲存體、輸送量、連線數目、每秒要求數和其他計量的限制。</span><span class="sxs-lookup"><span data-stu-id="f135e-275">Individual Azure services have consumption limits &mdash; for example, limits on storage, throughput, number of connections, requests per second, and other metrics.</span></span> <span data-ttu-id="f135e-276">如果它嘗試使用超出這些限制，導致受影響的使用者的服務節流和可能停機的資源，您的應用程式將會失敗。</span><span class="sxs-lookup"><span data-stu-id="f135e-276">Your application will fail if it attempts to use resources beyond these limits, resulting in service throttling and possible downtime for affected users.</span></span> <span data-ttu-id="f135e-277">根據特定的服務和應用程式的需求，您通常可以避免這些限制 （例如，選擇另一個定價層） 向上或向外延展 （例如新增新的執行個體）。</span><span class="sxs-lookup"><span data-stu-id="f135e-277">Depending on the specific service and your application requirements, you can often avoid these limits by scaling up (for example, choosing another pricing tier) or scaling out (such as adding new instances).</span></span>
- <span data-ttu-id="f135e-278">**判斷您需要多少儲存體帳戶。**</span><span class="sxs-lookup"><span data-stu-id="f135e-278">**Determine how many storage accounts you need.**</span></span> <span data-ttu-id="f135e-279">Azure 可讓特定數目的每個訂用帳戶的儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="f135e-279">Azure allows a specific number of storage accounts per subscription.</span></span> <span data-ttu-id="f135e-280">如需詳細資訊，請參閱 [Azure 訂用帳戶和服務限制、配額與條件約束](/azure/azure-subscription-service-limits/#storage-limits)。</span><span class="sxs-lookup"><span data-stu-id="f135e-280">For more information, see [Azure subscription and service limits, quotas, and constraints](/azure/azure-subscription-service-limits/#storage-limits).</span></span>
- <span data-ttu-id="f135e-281">**選取 Azure SQL Database 適用的服務層。**</span><span class="sxs-lookup"><span data-stu-id="f135e-281">**Select the right service tier for Azure SQL Database.**</span></span> <span data-ttu-id="f135e-282">如果您的應用程式使用 Azure SQL Database，請選取適當的服務層。</span><span class="sxs-lookup"><span data-stu-id="f135e-282">If your application uses Azure SQL Database, select the appropriate service tier.</span></span> <span data-ttu-id="f135e-283">如果層無法處理您的應用程式資料庫交易單位 (DTU) 需求，將會節流您的資料使用。</span><span class="sxs-lookup"><span data-stu-id="f135e-283">If the tier cannot handle your application's database transaction unit (DTU) requirements, your data use will be throttled.</span></span> <span data-ttu-id="f135e-284">如需選取正確服務方案的詳細資訊，請參閱 [SQL Database 選項和效能：了解每個服務層中可用的項目](/azure/sql-database/sql-database-service-tiers/)。</span><span class="sxs-lookup"><span data-stu-id="f135e-284">For more information on selecting the correct service plan, see [SQL Database options and performance: Understand what's available in each service tier](/azure/sql-database/sql-database-service-tiers/).</span></span>
- <span data-ttu-id="f135e-285">**佈建 Azure Cosmos DB 中足夠的要求單位 (Ru)**。</span><span class="sxs-lookup"><span data-stu-id="f135e-285">**Provision sufficient request units (RUs) in Azure Cosmos DB**.</span></span> <span data-ttu-id="f135e-286">使用 Azure Cosmos DB，您需要按小時支付所佈建的輸送量及所取用的儲存體。</span><span class="sxs-lookup"><span data-stu-id="f135e-286">With Azure Cosmos DB, you pay for the throughput you provision and the storage you consume on an hourly basis.</span></span> <span data-ttu-id="f135e-287">所有資料庫作業的成本會標準化 Ru，為其擷取的系統資源，例如 CPU、 IOPS 和記憶體。</span><span class="sxs-lookup"><span data-stu-id="f135e-287">The cost of all database operations is normalized as RUs, which abstracts the system resources such as CPU, IOPS, and memory.</span></span> <span data-ttu-id="f135e-288">如需詳細資訊，請參閱 [Azure Cosmos DB 中的要求單位](/azure/cosmos-db/request-units)。</span><span class="sxs-lookup"><span data-stu-id="f135e-288">For more information, see [Request Units in Azure Cosmos DB](/azure/cosmos-db/request-units).</span></span>

## <a name="load-balance-as-needed"></a><span data-ttu-id="f135e-289">負載平衡所需</span><span class="sxs-lookup"><span data-stu-id="f135e-289">Load-balance as needed</span></span>

<span data-ttu-id="f135e-290">適當的負載平衡，可讓您符合可用性需求，以及可用性相關聯的成本降至最低。</span><span class="sxs-lookup"><span data-stu-id="f135e-290">Proper load-balancing allows you to meet availability requirements and to minimize costs associated with availability.</span></span>

- <span data-ttu-id="f135e-291">**使用負載平衡來分散要求。**</span><span class="sxs-lookup"><span data-stu-id="f135e-291">**Use load-balancing to distribute requests.**</span></span> <span data-ttu-id="f135e-292">負載平衡時，會將您的應用程式要求至狀況良好的服務執行個體散發藉由從循環中移除狀況不良的執行個體。</span><span class="sxs-lookup"><span data-stu-id="f135e-292">Load-balancing distributes your application's requests to healthy service instances by removing unhealthy instances from rotation.</span></span> <span data-ttu-id="f135e-293">如果您的服務使用 Azure App Service 或 Azure 雲端服務，它已經為您進行負載平衡。</span><span class="sxs-lookup"><span data-stu-id="f135e-293">If your service uses Azure App Service or Azure Cloud Services, it's already load-balanced for you.</span></span> <span data-ttu-id="f135e-294">不過，如果您的應用程式使用 Azure Vm，您需要佈建負載平衡器。</span><span class="sxs-lookup"><span data-stu-id="f135e-294">However, if your application uses Azure VMs, you need to provision a load-balancer.</span></span> <span data-ttu-id="f135e-295">如需詳細資訊，請參閱[什麼是 Azure Load Balancer？](/azure/load-balancer/load-balancer-overview/)</span><span class="sxs-lookup"><span data-stu-id="f135e-295">For more information, see [What is Azure Load Balancer?](/azure/load-balancer/load-balancer-overview/)</span></span>

  <span data-ttu-id="f135e-296">您可以使用 Azure Load Balancer：</span><span class="sxs-lookup"><span data-stu-id="f135e-296">You can use Azure Load Balancer to:</span></span>

  - <span data-ttu-id="f135e-297">負載平衡連入網際網路流量到 Vm。</span><span class="sxs-lookup"><span data-stu-id="f135e-297">Load-balance incoming Internet traffic to your VMs.</span></span> <span data-ttu-id="f135e-298">此組態稱為[*公用 Load Balancer*](/azure/load-balancer/load-balancer-overview#publicloadbalancer)。</span><span class="sxs-lookup"><span data-stu-id="f135e-298">This configuration is known as a [*public Load Balancer*](/azure/load-balancer/load-balancer-overview#publicloadbalancer).</span></span>
  - <span data-ttu-id="f135e-299">對虛擬網路內 VM 之間的流量進行負載平衡。</span><span class="sxs-lookup"><span data-stu-id="f135e-299">Load-balance traffic across VMs inside a virtual network.</span></span> <span data-ttu-id="f135e-300">在混合式的案例中，您也可以從內部部署網路連線到 Load Balancer 前端。</span><span class="sxs-lookup"><span data-stu-id="f135e-300">You can also reach a Load Balancer front end from an on-premises network in a hybrid scenario.</span></span> <span data-ttu-id="f135e-301">這兩種案例使用的設定，就所謂[*內部 Load Balancer*](/azure/load-balancer/load-balancer-overview#internalloadbalancer)。</span><span class="sxs-lookup"><span data-stu-id="f135e-301">Both scenarios use a configuration that is known as an [*internal Load Balancer*](/azure/load-balancer/load-balancer-overview#internalloadbalancer).</span></span>
  - <span data-ttu-id="f135e-302">連接埠流量轉送至具有輸入的網路位址轉譯 (NAT) 規則的特定 Vm 上的分項連接埠。</span><span class="sxs-lookup"><span data-stu-id="f135e-302">Port forward traffic to an itemized port on specific VMs with inbound network address translation (NAT) rules.</span></span>
  - <span data-ttu-id="f135e-303">藉由使用公用 Load Balancer，為虛擬網路內的 VM 提供[輸出連線能力](/azure/load-balancer/load-balancer-outbound-connections)。</span><span class="sxs-lookup"><span data-stu-id="f135e-303">Provide [outbound connectivity](/azure/load-balancer/load-balancer-outbound-connections) for VMs inside your virtual network by using a public Load Balancer.</span></span>

- <span data-ttu-id="f135e-304">**使用流量管理員，在 「 Azure 流量管理員 」 等的區域之間，平衡負載。**</span><span class="sxs-lookup"><span data-stu-id="f135e-304">**Balance loads across regions with a traffic manager, such as Azure Traffic Manager.**</span></span> <span data-ttu-id="f135e-305">進行負載平衡跨區域流量需要流量管理解決方案，而 Azure 提供[Traffic Manager](https://azure.microsoft.com/services/traffic-manager/)。</span><span class="sxs-lookup"><span data-stu-id="f135e-305">To load-balance traffic across regions requires a traffic management solution, and Azure provides [Traffic Manager](https://azure.microsoft.com/services/traffic-manager/).</span></span> <span data-ttu-id="f135e-306">也可以利用提供類似流量管理功能的第三方服務。</span><span class="sxs-lookup"><span data-stu-id="f135e-306">You can also take advantage of third-party services that provide similar traffic-management capabilities.</span></span>

## <a name="implement-resiliency-strategies"></a><span data-ttu-id="f135e-307">實作復原策略</span><span class="sxs-lookup"><span data-stu-id="f135e-307">Implement resiliency strategies</span></span>

<span data-ttu-id="f135e-308">本章節描述一些常見復原策略。</span><span class="sxs-lookup"><span data-stu-id="f135e-308">This section describes some common resiliency strategies.</span></span> <span data-ttu-id="f135e-309">大部分的這些策略並不限於特定技術。</span><span class="sxs-lookup"><span data-stu-id="f135e-309">Most of these strategies are not limited to a particular technology.</span></span> <span data-ttu-id="f135e-310">描述摘要說明每套方法背後的基本概念，而且包含進一步的讀取連結。</span><span class="sxs-lookup"><span data-stu-id="f135e-310">The descriptions summarize the general idea behind each technique and include links to further reading.</span></span>

- <span data-ttu-id="f135e-311">**實作復原模式**遠端作業，在適當時。</span><span class="sxs-lookup"><span data-stu-id="f135e-311">**Implement resiliency patterns** for remote operations, where appropriate.</span></span> <span data-ttu-id="f135e-312">如果您的應用程式相依於遠端服務之間的通訊，請遵循[設計模式](../patterns/category/resiliency.md)來處理暫時性失敗。</span><span class="sxs-lookup"><span data-stu-id="f135e-312">If your application depends on communication between remote services, follow [design patterns](../patterns/category/resiliency.md) for dealing with transient failures.</span></span>

- <span data-ttu-id="f135e-313">**重試暫時性失敗。**</span><span class="sxs-lookup"><span data-stu-id="f135e-313">**Retry transient failures.**</span></span> <span data-ttu-id="f135e-314">這些可能被因暫時遺失網路連線、 卸除的資料庫連線或逾時當服務忙碌中。</span><span class="sxs-lookup"><span data-stu-id="f135e-314">These can be caused by momentary loss of network connectivity, a dropped database connection, or a timeout when a service is busy.</span></span> <span data-ttu-id="f135e-315">通常，可以解決暫時性失敗重試要求。</span><span class="sxs-lookup"><span data-stu-id="f135e-315">Often, a transient failure can be resolved by retrying the request.</span></span>

  - <span data-ttu-id="f135e-316">對於許多 Azure 服務，用戶端軟體開發套件 (SDK) 會對呼叫端而言是透明的方式來實作自動重試。</span><span class="sxs-lookup"><span data-stu-id="f135e-316">For many Azure services, the client software development kit (SDK) implements automatic retries in a way that is transparent to the caller.</span></span> <span data-ttu-id="f135e-317">請參閱[重試的特定服務的指引](../best-practices/retry-service-specific.md)。</span><span class="sxs-lookup"><span data-stu-id="f135e-317">See [Retry guidance for specific services](../best-practices/retry-service-specific.md).</span></span>
  - <span data-ttu-id="f135e-318">或實作[重試模式](../patterns/retry.md)協助應用程式以透明的方式處理預期的暫時性失敗，嘗試連線到服務或網路資源時。</span><span class="sxs-lookup"><span data-stu-id="f135e-318">Or implement the [Retry pattern](../patterns/retry.md) to help the application handle anticipated, temporary failures transparently when it tries to connect to a service or network resource.</span></span>

- <span data-ttu-id="f135e-319">**使用斷路器**處理可能需要在變數的一段時間，若要修正錯誤。</span><span class="sxs-lookup"><span data-stu-id="f135e-319">**Use a circuit breaker** to handle faults that might take a variable amount of time to fix.</span></span> <span data-ttu-id="f135e-320">[斷路器模式](../patterns/circuit-breaker.md)可以防止應用程式重複嘗試可能失敗的作業。</span><span class="sxs-lookup"><span data-stu-id="f135e-320">The [Circuit Breaker pattern](../patterns/circuit-breaker.md) can prevent an application from repeatedly trying an operation that is likely to fail.</span></span> <span data-ttu-id="f135e-321">斷路器會包裝對服務呼叫，並會追蹤最近的失敗數目。</span><span class="sxs-lookup"><span data-stu-id="f135e-321">The circuit breaker wraps calls to a service and tracks the number of recent failures.</span></span> <span data-ttu-id="f135e-322">如果失敗計數超過臨界值，則斷路器會開始傳回錯誤碼而不呼叫服務。</span><span class="sxs-lookup"><span data-stu-id="f135e-322">If the failure count exceeds a threshold, the circuit breaker starts returning an error code without calling the service.</span></span> <span data-ttu-id="f135e-323">這可讓服務有時間復原，有助於避免發生連鎖性失敗。</span><span class="sxs-lookup"><span data-stu-id="f135e-323">This gives the service time to recover and helps avoid cascading failures.</span></span>
- <span data-ttu-id="f135e-324">**隔離重要的資源。**</span><span class="sxs-lookup"><span data-stu-id="f135e-324">**Isolate critical resources.**</span></span> <span data-ttu-id="f135e-325">在某個子系統中的失敗有時候可能會重疊，導致失敗的應用程式其他部分。</span><span class="sxs-lookup"><span data-stu-id="f135e-325">Failures in one subsystem can sometimes cascade, resulting in failures in other parts of the application.</span></span> <span data-ttu-id="f135e-326">就可能發生此失敗可防止資源，例如執行緒或通訊端釋放，導致資源耗盡。</span><span class="sxs-lookup"><span data-stu-id="f135e-326">This can happen if a failure prevents resources such as threads or sockets from being freed, leading to resource exhaustion.</span></span> <span data-ttu-id="f135e-327">若要避免這個問題，您可以系統分割為隔離群組，讓一個分割區中的失敗不會使整個系統當機。</span><span class="sxs-lookup"><span data-stu-id="f135e-327">To avoid this, you can partition a system into isolated groups so that a failure in one partition does not bring down the entire system.</span></span>

    <span data-ttu-id="f135e-328">以下是一些範例，這項技術，這有時稱為[隔艙模式](../patterns/bulkhead.md):</span><span class="sxs-lookup"><span data-stu-id="f135e-328">Here are some examples of this technique, which is sometimes called the [Bulkhead pattern](../patterns/bulkhead.md):</span></span>

  - <span data-ttu-id="f135e-329">資料分割 （例如，藉由租用戶） 資料庫，並指派不同的集區的每個資料分割的 web 伺服器執行個體。</span><span class="sxs-lookup"><span data-stu-id="f135e-329">Partition a database (for example, by tenant), and assign a separate pool of web server instances for each partition.</span></span>
  - <span data-ttu-id="f135e-330">使用個別執行緒集區將呼叫隔離至不同的服務。</span><span class="sxs-lookup"><span data-stu-id="f135e-330">Use separate thread pools to isolate calls to different services.</span></span> <span data-ttu-id="f135e-331">如果其中一個服務失敗，這有助於防止階層式失敗。</span><span class="sxs-lookup"><span data-stu-id="f135e-331">This helps to prevent cascading failures if one of the services fails.</span></span> <span data-ttu-id="f135e-332">如需範例，請參閱 Netflix [hystrix 文件庫](https://medium.com/netflix-techblog/introducing-hystrix-for-resiliency-engineering-13531c1ab362)。</span><span class="sxs-lookup"><span data-stu-id="f135e-332">For an example, see the Netflix [Hystrix library](https://medium.com/netflix-techblog/introducing-hystrix-for-resiliency-engineering-13531c1ab362).</span></span>
  - <span data-ttu-id="f135e-333">使用[容器](https://en.wikipedia.org/wiki/Operating-system-level_virtualization)來限制特定子系統的可用資源。</span><span class="sxs-lookup"><span data-stu-id="f135e-333">Use [containers](https://en.wikipedia.org/wiki/Operating-system-level_virtualization) to limit the resources available to a particular subsystem.</span></span>

      ![隔艙模式的圖表](_images/bulkhead.png)

- <span data-ttu-id="f135e-335">**適用於[*補償交易*](../patterns/compensating-transaction.md)**。</span><span class="sxs-lookup"><span data-stu-id="f135e-335">**Apply [*compensating transactions*](../patterns/compensating-transaction.md)**.</span></span> <span data-ttu-id="f135e-336">補償交易是將另一個已完成交易的影響復原的交易。</span><span class="sxs-lookup"><span data-stu-id="f135e-336">A compensating transaction is a transaction that undoes the effects of another completed transaction.</span></span> <span data-ttu-id="f135e-337">在分散式系統中，很難達到強式交易一致性。</span><span class="sxs-lookup"><span data-stu-id="f135e-337">In a distributed system, it can be difficult to achieve strong transactional consistency.</span></span> <span data-ttu-id="f135e-338">補償交易以協助使用一系列的較小型的個別交易可以復原在每個步驟來達成一致性。</span><span class="sxs-lookup"><span data-stu-id="f135e-338">Compensating transactions help to achieve consistency by using a series of smaller, individual transactions that can be undone at each step.</span></span> <span data-ttu-id="f135e-339">例如，若要預訂旅程，客戶可能要預約汽車、旅館房間和班機。</span><span class="sxs-lookup"><span data-stu-id="f135e-339">For example, to book a trip, a customer might reserve a car, a hotel room, and a flight.</span></span> <span data-ttu-id="f135e-340">如果其中一個步驟失敗，整個作業就會失敗。</span><span class="sxs-lookup"><span data-stu-id="f135e-340">If one of these steps fails, the entire operation fails.</span></span> <span data-ttu-id="f135e-341">您並非在整個作業中嘗試使用單一的分散式交易，而是可以定義每個步驟的補償交易。</span><span class="sxs-lookup"><span data-stu-id="f135e-341">Instead of trying to use a single distributed transaction for the entire operation, you can define a compensating transaction for each step.</span></span>
- <span data-ttu-id="f135e-342">**實作非同步作業，可能的話。**</span><span class="sxs-lookup"><span data-stu-id="f135e-342">**Implement asynchronous operations, whenever possible.**</span></span> <span data-ttu-id="f135e-343">同步作業會獨佔資源，而且在呼叫端等候程序完成時，封鎖其他作業。</span><span class="sxs-lookup"><span data-stu-id="f135e-343">Synchronous operations can monopolize resources and block other operations while the caller waits for the process to complete.</span></span> <span data-ttu-id="f135e-344">設計您的應用程式，以便盡可能的非同步作業的每個部分。</span><span class="sxs-lookup"><span data-stu-id="f135e-344">Design each part of your application to allow for asynchronous operations, whenever possible.</span></span> <span data-ttu-id="f135e-345">如需有關如何在 C 中實作非同步程式設計\#，請參閱 <<c2> [ 非同步程式設計](/dotnet/articles/csharp/async)。</span><span class="sxs-lookup"><span data-stu-id="f135e-345">For more information on how to implement asynchronous programming in C\#, see [Asynchronous Programming](/dotnet/articles/csharp/async).</span></span>

## <a name="ensure-that-availability-meets-slas"></a><span data-ttu-id="f135e-346">請確認可用性符合 Sla</span><span class="sxs-lookup"><span data-stu-id="f135e-346">Ensure that availability meets SLAs</span></span>

<span data-ttu-id="f135e-347">*可用性*比例的時間，系統可正常運作，而且其中一個[軟體品質要素](../guide/pillars.md)。</span><span class="sxs-lookup"><span data-stu-id="f135e-347">*Availability* is the proportion of time that a system is functional and working, and it is one of the [pillars of software quality](../guide/pillars.md).</span></span> <span data-ttu-id="f135e-348">在本節中使用的工作，以檢閱您的應用程式架構，從可用性的觀點，確定您的可用性會符合您的 Sla。</span><span class="sxs-lookup"><span data-stu-id="f135e-348">Use the tasks in this section to review your application architecture from an availability standpoint to make sure that your availability meets your SLAs.</span></span>

- <span data-ttu-id="f135e-349">**請避免單一失敗點。**</span><span class="sxs-lookup"><span data-stu-id="f135e-349">**Avoid any single point of failure.**</span></span> <span data-ttu-id="f135e-350"> 為避免單一失敗點影響可用性，應該將所有的元件、服務、資源和計算執行個體部署為多個執行個體。</span><span class="sxs-lookup"><span data-stu-id="f135e-350">All components, services, resources, and compute instances should be deployed as multiple instances to prevent a single point of failure from affecting availability.</span></span> <span data-ttu-id="f135e-351">驗證機制也可以是單一失敗點。</span><span class="sxs-lookup"><span data-stu-id="f135e-351">Authentication mechanisms can also be a single point of failure.</span></span> <span data-ttu-id="f135e-352">應用程式設計為可進行設定，若要使用多個執行個體，以便自動偵測失敗，並要求重新導向至非失敗的執行個體，如果平台不會自動執行此動作。</span><span class="sxs-lookup"><span data-stu-id="f135e-352">Design the application to be configurable to use multiple instances and to automatically detect failures and redirect requests to non-failed instances, if the platform doesn't do this automatically.</span></span>
- <span data-ttu-id="f135e-353">**根據服務層級目標來分解工作負載。**</span><span class="sxs-lookup"><span data-stu-id="f135e-353">**Decompose workloads by service-level objective.**</span></span> <span data-ttu-id="f135e-354"> 如果服務由重要和比較不重要的工作負載組成，請以不同的方式加以管理，並指定服務功能及執行個體數目，以符合其可用性需求。</span><span class="sxs-lookup"><span data-stu-id="f135e-354">If a service is composed of critical and less-critical workloads, manage them differently and specify the service features and number of instances to meet their availability requirements.</span></span>
- <span data-ttu-id="f135e-355">**最小化和了解服務相依性。**</span><span class="sxs-lookup"><span data-stu-id="f135e-355">**Minimize and understand service dependencies.**</span></span> <span data-ttu-id="f135e-356">盡可能使用不同的服務數目降至最低。</span><span class="sxs-lookup"><span data-stu-id="f135e-356">Minimize the number of different services used, where possible.</span></span> <span data-ttu-id="f135e-357">請確定您已了解所有功能和服務相依性，存在於系統中。</span><span class="sxs-lookup"><span data-stu-id="f135e-357">Ensure that you understand all the feature and service dependencies that exist in the system.</span></span> <span data-ttu-id="f135e-358">特別是，了解失敗或在每個相依性的效能降低的整體影響。</span><span class="sxs-lookup"><span data-stu-id="f135e-358">In particular, understand the overall impact of failure or reduced performance in each dependency.</span></span>
- <span data-ttu-id="f135e-359">**將工作和訊息設計*具有等冪性*，其中可能。**</span><span class="sxs-lookup"><span data-stu-id="f135e-359">**Design tasks and messages to be *idempotent*, where possible.**</span></span> <span data-ttu-id="f135e-360">若作業可以多次重複並產生相同的結果，則作業具有等冪性。</span><span class="sxs-lookup"><span data-stu-id="f135e-360">An operation is idempotent if it can be repeated multiple times and produce the same result.</span></span> <span data-ttu-id="f135e-361">這可以確保重複的要求不會造成問題。</span><span class="sxs-lookup"><span data-stu-id="f135e-361">This can ensure that duplicated requests don't cause problems.</span></span> <span data-ttu-id="f135e-362">訊息取用者與其執行的作業應該具有等冪性，這樣重複先前執行過的作業才不會使結果無效。</span><span class="sxs-lookup"><span data-stu-id="f135e-362">Message consumers and the operations they carry out should be idempotent so that repeating a previously executed operation does not render the results invalid.</span></span> <span data-ttu-id="f135e-363">這可能表示偵測重複訊息，或使用開放式的方法來處理衝突，以確保一致性。</span><span class="sxs-lookup"><span data-stu-id="f135e-363">This may mean detecting duplicated messages or ensuring consistency by using an optimistic approach to handling conflicts.</span></span>
- <span data-ttu-id="f135e-364">**設定要求逾時。**</span><span class="sxs-lookup"><span data-stu-id="f135e-364">**Configure request timeouts.**</span></span> <span data-ttu-id="f135e-365"> 服務和資源可能會變成無法使用，導致要求失敗。</span><span class="sxs-lookup"><span data-stu-id="f135e-365">Services and resources may become unavailable, causing requests to fail.</span></span> <span data-ttu-id="f135e-366">請確認您所套用的逾時值是適用於每個服務或資源，然後用戶端可存取它們。</span><span class="sxs-lookup"><span data-stu-id="f135e-366">Ensure that the timeouts you apply are appropriate for each service or resource and for the client that is accessing them.</span></span> <span data-ttu-id="f135e-367">在某些情況下，您可能會允許用戶端的特定執行個體有較長的逾時，取決於用戶端所執行的內容和其他動作。</span><span class="sxs-lookup"><span data-stu-id="f135e-367">In some cases, you might allow a longer timeout for a particular instance of a client, depending on the context and other actions that the client is performing.</span></span> <span data-ttu-id="f135e-368">短的逾時可能會導致過多的重試作業的服務和具有大量延遲的資源。</span><span class="sxs-lookup"><span data-stu-id="f135e-368">Short timeouts may cause excessive retry operations for services and resources that have considerable latency.</span></span> <span data-ttu-id="f135e-369">長的逾時可能會導致封鎖，如果大量的要求會排入佇列，等待服務或資源回應。</span><span class="sxs-lookup"><span data-stu-id="f135e-369">Long timeouts can cause blocking, if a large number of requests are queued, waiting for a service or resource to respond.</span></span>
- <span data-ttu-id="f135e-370">**使用可實作重要交易之高可用性的訊息代理人。**</span><span class="sxs-lookup"><span data-stu-id="f135e-370">**Use a message broker that implements high availability for critical transactions.**</span></span> <span data-ttu-id="f135e-371">許多雲端應用程式會使用傳訊來觸發程序的非同步工作。</span><span class="sxs-lookup"><span data-stu-id="f135e-371">Many cloud applications use messaging to trigger asynchronous tasks.</span></span> <span data-ttu-id="f135e-372">若要保證訊息的傳遞，傳訊系統應該提供高可用性。</span><span class="sxs-lookup"><span data-stu-id="f135e-372">To guarantee delivery of messages, the messaging system should provide high availability.</span></span> <span data-ttu-id="f135e-373">[Azure 服務匯流排傳訊](/azure/service-bus-messaging)會實作*至少一次*語意，這表示保證訊息會傳遞至少一次。</span><span class="sxs-lookup"><span data-stu-id="f135e-373">[Azure Service Bus messaging](/azure/service-bus-messaging) implements *at least once* semantics, which means that a message is guaranteed to be delivered at least once.</span></span> <span data-ttu-id="f135e-374">在某些情況下，可能傳送重複的訊息。</span><span class="sxs-lookup"><span data-stu-id="f135e-374">Duplicate messages may be delivered under certain circumstances.</span></span> <span data-ttu-id="f135e-375">如果訊息處理是等冪 (請參閱上一個項目)，重複傳遞應該不是問題。</span><span class="sxs-lookup"><span data-stu-id="f135e-375">If message processing is idempotent (see the previous item), repeated delivery should not be a problem.</span></span>
- <span data-ttu-id="f135e-376">**節流處理大量使用者。**</span><span class="sxs-lookup"><span data-stu-id="f135e-376">**Throttle high-volume users.**</span></span> <span data-ttu-id="f135e-377">有時候，少數的使用者會建立過多的負載。</span><span class="sxs-lookup"><span data-stu-id="f135e-377">Sometimes, a small number of users creates excessive load.</span></span> <span data-ttu-id="f135e-378">這可能會對其他使用者造成影響，並可減少您的應用程式的整體可用性。</span><span class="sxs-lookup"><span data-stu-id="f135e-378">This can have an impact on other users and can reduce the overall availability of your application.</span></span> <span data-ttu-id="f135e-379">當單一用戶端提出的要求數目過多時，應用程式可能會將用戶端節流一段時間。</span><span class="sxs-lookup"><span data-stu-id="f135e-379">When a single client makes an excessive number of requests, the application might throttle the client for a certain period.</span></span> <span data-ttu-id="f135e-380">在節流期間，應用程式會從該用戶端拒絕部分或所有的要求。</span><span class="sxs-lookup"><span data-stu-id="f135e-380">During the throttling period, the application refuses some or all of the requests from that client.</span></span> <span data-ttu-id="f135e-381">節流的臨界值通常取決於客戶的服務層。</span><span class="sxs-lookup"><span data-stu-id="f135e-381">The threshold for throttling often depends on the customer's service tier.</span></span> <span data-ttu-id="f135e-382">如需詳細資訊，請參閱 <<c0> [ 節流模式](../patterns/throttling.md)。</span><span class="sxs-lookup"><span data-stu-id="f135e-382">For more information, see [Throttling pattern](../patterns/throttling.md).</span></span>

    <span data-ttu-id="f135e-383">節流並不表示，用戶端一定有惡意&mdash;僅表示它超過其服務配額。</span><span class="sxs-lookup"><span data-stu-id="f135e-383">Throttling does not imply that the client was necessarily acting maliciously &mdash; only that it exceeded its service quota.</span></span> <span data-ttu-id="f135e-384">在某些情況下，取用者可能會持續超過其配額或是行為不當。</span><span class="sxs-lookup"><span data-stu-id="f135e-384">In some cases, a consumer might consistently exceed their quota or otherwise behave badly.</span></span> <span data-ttu-id="f135e-385">在此情況下，您可能會繼續執行並封鎖使用者。</span><span class="sxs-lookup"><span data-stu-id="f135e-385">In that case, you might go further and block the user.</span></span> <span data-ttu-id="f135e-386">一般而言，這是透過封鎖 API 金鑰或 IP 位址範圍來完成。</span><span class="sxs-lookup"><span data-stu-id="f135e-386">Typically, this is done by blocking an API key or an IP address range.</span></span>
- <span data-ttu-id="f135e-387">**設計可依正常程序降級的應用程式。**</span><span class="sxs-lookup"><span data-stu-id="f135e-387">**Design applications to gracefully degrade.**</span></span> <span data-ttu-id="f135e-388">應用程式上的負載可能會超出其中一或多個組件的容量，而導致可用性降低和連線失敗。</span><span class="sxs-lookup"><span data-stu-id="f135e-388">The load on an application may exceed the capacity of one or more parts, causing reduced availability and failed connections.</span></span> <span data-ttu-id="f135e-389">調整可以減輕這個問題，但它可能會到達資源可用性或成本等其他因素所加諸的限制。</span><span class="sxs-lookup"><span data-stu-id="f135e-389">Scaling can mitigate this problem, but it may reach a limit imposed by other factors, such as resource availability or cost.</span></span> <span data-ttu-id="f135e-390">應用程式達到資源限制時，應該採取適當的動作，將對於使用者的影響降到最低。</span><span class="sxs-lookup"><span data-stu-id="f135e-390">When an application reaches a resource limit, it should take appropriate action to minimize the impact for the user.</span></span> <span data-ttu-id="f135e-391">例如，在電子商務系統中，如果訂單處理子系統處於疲勞或失敗，它可以是暫時停用同時允許其他功能，例如瀏覽產品目錄。</span><span class="sxs-lookup"><span data-stu-id="f135e-391">For example, in an e-commerce system, if the order-processing subsystem is under strain or fails, it can be temporarily disabled while allowing other functionality, such as browsing the product catalog.</span></span> <span data-ttu-id="f135e-392">它可能會延後對失敗子系統的要求適當&mdash;比方說，仍可讓客戶可以提交訂單，但儲存以供稍後處理，「 訂單 」 子系統再次可用時。</span><span class="sxs-lookup"><span data-stu-id="f135e-392">It might be appropriate to postpone requests to a failing subsystem &mdash; for example, still enabling customers to submit orders but saving them for later processing, when the orders subsystem is available again.</span></span>
- <span data-ttu-id="f135e-393">**適當處理急促高載事件。**</span><span class="sxs-lookup"><span data-stu-id="f135e-393">**Gracefully handle rapid burst events.**</span></span> <span data-ttu-id="f135e-394">大部分的應用程式所需要處理的工作負載，會隨著時間而有所不同。</span><span class="sxs-lookup"><span data-stu-id="f135e-394">Most applications need to handle varying workloads over time.</span></span> <span data-ttu-id="f135e-395">自動調整有助於處理負載，但是可能需要一些時間讓其他執行個體上線並處理要求。</span><span class="sxs-lookup"><span data-stu-id="f135e-395">Autoscaling can help to handle the load, but it may take some time for additional instances to come online and handle requests.</span></span> <span data-ttu-id="f135e-396">若要防止暴增的活動而吃不消應用程式，請使用的服務，並佇列接近容量時適當降級的佇列要求設計。</span><span class="sxs-lookup"><span data-stu-id="f135e-396">To prevent bursts of activity from overwhelming the application, design it to queue requests to the services it uses and to degrade gracefully when queues are near capacity.</span></span> <span data-ttu-id="f135e-397">請確認有足夠的效能和容量可在非高載條件清空佇列並處理未處理的要求。</span><span class="sxs-lookup"><span data-stu-id="f135e-397">Ensure there is sufficient performance and capacity available under non-burst conditions to drain the queues and handle outstanding requests.</span></span> <span data-ttu-id="f135e-398">如需詳細資訊，請參閱[佇列型負載調節模式](../patterns/queue-based-load-leveling.md)。</span><span class="sxs-lookup"><span data-stu-id="f135e-398">For more information, see the [Queue-Based Load Leveling pattern](../patterns/queue-based-load-leveling.md).</span></span>
- <span data-ttu-id="f135e-399">**撰寫或容錯回復到多個元件。**</span><span class="sxs-lookup"><span data-stu-id="f135e-399">**Compose or fail back to multiple components.**</span></span> <span data-ttu-id="f135e-400">應用程式設計成儘可能使用多個執行個體，而不影響作業和現有的連線。</span><span class="sxs-lookup"><span data-stu-id="f135e-400">Design applications to use multiple instances without affecting operation and existing connections, where possible.</span></span> <span data-ttu-id="f135e-401">若要將可用性最大化、 使用多個執行個體並分散它們之間的要求和偵測並避免傳送要求給失敗的執行個體。</span><span class="sxs-lookup"><span data-stu-id="f135e-401">To maximize availability, use multiple instances and distribute requests between them, and detect and avoid sending requests to failed instances.</span></span>
- <span data-ttu-id="f135e-402">**容錯回復至不同的服務或工作流程。**</span><span class="sxs-lookup"><span data-stu-id="f135e-402">**Fail back to a different service or workflow.**</span></span> <span data-ttu-id="f135e-403">例如，如果寫入至 SQL Database 失敗，暫時將資料儲存在 Blob 儲存體或 Redis 快取中。</span><span class="sxs-lookup"><span data-stu-id="f135e-403">For example, if writing to SQL Database fails, temporarily store data in Blob storage or Redis Cache.</span></span> <span data-ttu-id="f135e-404">服務可供使用時，請提供重新執行寫入至 SQL Database 的功能。</span><span class="sxs-lookup"><span data-stu-id="f135e-404">Provide a way to replay the writes to SQL Database when the service becomes available.</span></span> <span data-ttu-id="f135e-405">在某些情況下，失敗的作業可能會有替代動作，讓應用程式繼續運作，即使當元件或服務失敗。</span><span class="sxs-lookup"><span data-stu-id="f135e-405">In some cases, a failed operation may have an alternative action that allows the application to continue to work, even when a component or service fails.</span></span> <span data-ttu-id="f135e-406">可能的話，請偵測失敗，並在主要服務離線時，將要求重新導向至其他服務。</span><span class="sxs-lookup"><span data-stu-id="f135e-406">If possible, detect failures and redirect requests to other services while the primary service is offline.</span></span>
- <span data-ttu-id="f135e-407">**使用負載均衡來緩和突然增加的流量。**</span><span class="sxs-lookup"><span data-stu-id="f135e-407">**Use load leveling to smooth out spikes in traffic.**</span></span> <span data-ttu-id="f135e-408">應用程式可能會突然出現尖峰流量，可能會淹沒後端服務。</span><span class="sxs-lookup"><span data-stu-id="f135e-408">Applications may experience sudden spikes in traffic, which can overwhelm services on the back end.</span></span> <span data-ttu-id="f135e-409">如果後端服務無法回應要求速度不夠快，待決的要求可能會累積，或服務可節流應用程式。</span><span class="sxs-lookup"><span data-stu-id="f135e-409">If a back-end service cannot respond to requests quickly enough, the pending requests may accumulate or the service may throttle the application.</span></span> <span data-ttu-id="f135e-410">若要避免這個問題，您可以使用佇列作為緩衝區。</span><span class="sxs-lookup"><span data-stu-id="f135e-410">To avoid this, you can use a queue as a buffer.</span></span> <span data-ttu-id="f135e-411">當沒有新的工作項目，而不是立即呼叫後端服務時，應用程式排入佇列以非同步方式執行的工作項目。</span><span class="sxs-lookup"><span data-stu-id="f135e-411">When there is a new work item, instead of calling the back-end service immediately, the application queues a work item to run asynchronously.</span></span> <span data-ttu-id="f135e-412">佇列會作為消除負載尖峰的緩衝區。</span><span class="sxs-lookup"><span data-stu-id="f135e-412">The queue acts as a buffer that smooths out peaks in the load.</span></span> <span data-ttu-id="f135e-413">如需詳細資訊，請參閱 <<c0> [ 佇列型負載調節模式](../patterns/queue-based-load-leveling.md)。</span><span class="sxs-lookup"><span data-stu-id="f135e-413">For more information, see [Queue-Based Load Leveling pattern](../patterns/queue-based-load-leveling.md).</span></span>

## <a name="manage-your-data"></a><span data-ttu-id="f135e-414">管理您的資料</span><span class="sxs-lookup"><span data-stu-id="f135e-414">Manage your data</span></span>

<span data-ttu-id="f135e-415">您如何管理您的資料會直接將您的應用程式的可用性播放。</span><span class="sxs-lookup"><span data-stu-id="f135e-415">How you manage your data plays directly into the availability of your application.</span></span> <span data-ttu-id="f135e-416">在本節中的工作可協助您建立管理計畫，以協助確保可用性。</span><span class="sxs-lookup"><span data-stu-id="f135e-416">The tasks in this section can help you create a management plan to help ensure availability.</span></span>

- <span data-ttu-id="f135e-417">**複寫資料，並了解您的應用程式資料存放區的複寫方法。**</span><span class="sxs-lookup"><span data-stu-id="f135e-417">**Replicate data and understand the replication methods for your application's data stores.**</span></span> <span data-ttu-id="f135e-418">複寫資料是處理資料存放區中非暫時性失敗的一般策略。</span><span class="sxs-lookup"><span data-stu-id="f135e-418">Replicating data is a general strategy for handling non-transient failures in a data store.</span></span> <span data-ttu-id="f135e-419">請考慮讀取和寫入的路徑。</span><span class="sxs-lookup"><span data-stu-id="f135e-419">Consider both the read and write paths.</span></span> <span data-ttu-id="f135e-420">根據儲存體技術中，您可能會有多個可寫入的複本，或您可能會有單一的可寫入複本及多個唯讀複本。</span><span class="sxs-lookup"><span data-stu-id="f135e-420">Depending on the storage technology, you might have multiple writable replicas or you might have a single writable replica and multiple read-only replicas.</span></span> <span data-ttu-id="f135e-421">若要將可用性最大化，可將複本放在多個區域。</span><span class="sxs-lookup"><span data-stu-id="f135e-421">To maximize availability, replicas can be placed in multiple regions.</span></span> <span data-ttu-id="f135e-422">不過，這種方法會將複寫資料時增加延遲。</span><span class="sxs-lookup"><span data-stu-id="f135e-422">However, this approach increases the latency when replicating the data.</span></span> <span data-ttu-id="f135e-423">一般而言，跨區域複寫會以非同步方式進行，這表示複本失敗時，會有最終一致性模型和資料遺失。</span><span class="sxs-lookup"><span data-stu-id="f135e-423">Typically, replicating across regions is done asynchronously, which implies an eventual consistency model and potential data loss if a replica fails.</span></span>  

  <span data-ttu-id="f135e-424">您可以使用[Azure Site Recovery](/azure/site-recovery/azure-to-azure-quickstart/)從一個區域複寫 Azure 虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="f135e-424">You can use [Azure Site Recovery](/azure/site-recovery/azure-to-azure-quickstart/) to replicate Azure Virtual Machines from one region to another.</span></span> <span data-ttu-id="f135e-425">Site Recovery 持續將資料複寫至目標區域。</span><span class="sxs-lookup"><span data-stu-id="f135e-425">Site Recovery replicates data continuously to the target region.</span></span> <span data-ttu-id="f135e-426">如果您的主要站台發生中斷，您容錯移轉到次要位置。</span><span class="sxs-lookup"><span data-stu-id="f135e-426">When an outage occurs at your primary site, you fail over to a secondary location.</span></span>

- <span data-ttu-id="f135e-427">**確保所有單一使用者帳戶均無法同時存取生產和備份資料。**</span><span class="sxs-lookup"><span data-stu-id="f135e-427">**Ensure that no single user account has access to both production and backup data.**</span></span> <span data-ttu-id="f135e-428">如果有單一使用者帳戶同時具有寫入生產與備份來源的權限，您的資料備份就會受到危害。</span><span class="sxs-lookup"><span data-stu-id="f135e-428">Your data backups are compromised if one single user account has permission to write to both production and backup sources.</span></span> <span data-ttu-id="f135e-429">惡意使用者可能會刻意刪除您所有的資料，並以一般使用者可能不小心刪除它。</span><span class="sxs-lookup"><span data-stu-id="f135e-429">A malicious user could purposely delete all your data, and a regular user could accidentally delete it.</span></span> <span data-ttu-id="f135e-430">設計您的應用程式，以限制每個使用者帳戶的權限。</span><span class="sxs-lookup"><span data-stu-id="f135e-430">Design your application to limit the permissions of each user account.</span></span> <span data-ttu-id="f135e-431">只授與寫入存取權，需要使用者，並授與存取生產或備份，但非兩者。</span><span class="sxs-lookup"><span data-stu-id="f135e-431">Only grant write access to users who require it, and grant access to either production or backup, but not both.</span></span>
- <span data-ttu-id="f135e-432">**文件和測試資料存放區容錯移轉和容錯回復程序。**</span><span class="sxs-lookup"><span data-stu-id="f135e-432">**Document and test your data store failover and failback process.**</span></span> <span data-ttu-id="f135e-433">如果發生災難性失敗的資料存放區，操作人員必須遵循一組書面指示來容錯移轉至新的資料存放區。</span><span class="sxs-lookup"><span data-stu-id="f135e-433">If a data store fails catastrophically, a human operator must follow a set of documented instructions to fail over to a new data store.</span></span> <span data-ttu-id="f135e-434">如果記錄的步驟中遇到錯誤，操作員將無法成功地遵循它們，並容錯移轉的資源。</span><span class="sxs-lookup"><span data-stu-id="f135e-434">If the documented steps have errors, an operator won't be able to successfully follow them and to fail over the resource.</span></span> <span data-ttu-id="f135e-435">定期測試指示步驟，以驗證遵循文件的操作員可以成功地容錯移轉和容錯回復。</span><span class="sxs-lookup"><span data-stu-id="f135e-435">Regularly test the instruction steps to verify that an operator who follows the documentation can successfully fail over and fail back.</span></span>
- <span data-ttu-id="f135e-436">**備份資料，並驗證您的資料備份。**</span><span class="sxs-lookup"><span data-stu-id="f135e-436">**Back up your data and validate your data backups.**</span></span> <span data-ttu-id="f135e-437">定期執行的指令碼，以驗證資料完整性、 結構描述和查詢，以確保備份資料是您的預期。</span><span class="sxs-lookup"><span data-stu-id="f135e-437">Regularly run a script to validate data integrity, schema, and queries to ensure that backup data is what you expect.</span></span> <span data-ttu-id="f135e-438">記錄和報告不一致情形，以便修復備份服務。</span><span class="sxs-lookup"><span data-stu-id="f135e-438">Log and report any inconsistencies so the backup service can be repaired.</span></span>
- <span data-ttu-id="f135e-439">**使用定期備份和還原時間點。**</span><span class="sxs-lookup"><span data-stu-id="f135e-439">**Use periodic backup and point-in-time restore.**</span></span> <span data-ttu-id="f135e-440">定期並自動備份不會保留其他位置的資料。</span><span class="sxs-lookup"><span data-stu-id="f135e-440">Regularly and automatically back up data that is not preserved elsewhere.</span></span> <span data-ttu-id="f135e-441">請確認您可以可靠地還原資料和應用程式本身發生錯誤。</span><span class="sxs-lookup"><span data-stu-id="f135e-441">Verify that you can reliably restore both the data and the application itself if failure occurs.</span></span> <span data-ttu-id="f135e-442">請確定備份符合您的 RPO。</span><span class="sxs-lookup"><span data-stu-id="f135e-442">Ensure that backups meet your RPO.</span></span> <span data-ttu-id="f135e-443">資料複寫並不是備份功能，因為人為錯誤或惡意作業可能會損毀的資料在所有複本上。</span><span class="sxs-lookup"><span data-stu-id="f135e-443">Data replication isn't a backup feature, because human error or malicious operations can corrupt data across all the replicas.</span></span> <span data-ttu-id="f135e-444">備份程序必須是安全的，才能保護傳輸和儲存體中的資料。</span><span class="sxs-lookup"><span data-stu-id="f135e-444">The backup process must be secure to protect the data in transit and in storage.</span></span> <span data-ttu-id="f135e-445">資料庫通常可以復原到前一個點的時間使用交易記錄檔。</span><span class="sxs-lookup"><span data-stu-id="f135e-445">Databases can usually be recovered to a previous point in time by using transaction logs.</span></span> <span data-ttu-id="f135e-446">如需詳細資訊，請參閱 <<c0> [ 從資料損毀或意外刪除復原](../resiliency/recovery-data-corruption.md)。</span><span class="sxs-lookup"><span data-stu-id="f135e-446">For more information, see [Recover from data corruption or accidental deletion](../resiliency/recovery-data-corruption.md).</span></span>
- <span data-ttu-id="f135e-447">**請考慮使用異地備援儲存體帳戶。**</span><span class="sxs-lookup"><span data-stu-id="f135e-447">**Consider using a geo-redundant storage account.**</span></span> <span data-ttu-id="f135e-448">儲存於 Azure 儲存體帳戶的資料一律會在本機複寫。</span><span class="sxs-lookup"><span data-stu-id="f135e-448">Data stored in an Azure Storage account is always replicated locally.</span></span> <span data-ttu-id="f135e-449">不過，有多個複寫策略，可供佈建儲存體帳戶時從中選擇。</span><span class="sxs-lookup"><span data-stu-id="f135e-449">However, there are multiple replication strategies to choose from when a storage account is provisioned.</span></span> <span data-ttu-id="f135e-450">若要保護您的應用程式資料免於少數的情況下，當整個區域無法使用時，選取[Azure 讀取權限異地備援儲存體 (RA-GRS)](/azure/storage/storage-redundancy/#read-access-geo-redundant-storage)。</span><span class="sxs-lookup"><span data-stu-id="f135e-450">To protect your application data against the rare case when an entire region becomes unavailable, select [Azure Read-Access Geo-Redundant Storage (RA-GRS)](/azure/storage/storage-redundancy/#read-access-geo-redundant-storage).</span></span>  

    > [!NOTE]
    > <span data-ttu-id="f135e-451">若為 VM，請勿依賴 RA-GRS 複寫來還原 VM 磁碟 (VHD 檔案)。</span><span class="sxs-lookup"><span data-stu-id="f135e-451">For VMs, do not rely on RA-GRS replication to restore the VM disks (VHD files).</span></span> <span data-ttu-id="f135e-452">請改用 [Azure 備份](/azure/backup)。</span><span class="sxs-lookup"><span data-stu-id="f135e-452">Instead, use [Azure Backup](/azure/backup).</span></span>

- <span data-ttu-id="f135e-453">**請考慮將參考資料部署到多個區域。**</span><span class="sxs-lookup"><span data-stu-id="f135e-453">**Consider deploying reference data to multiple regions.**</span></span> <span data-ttu-id="f135e-454">參考資料是可支援應用程式功能的唯讀資料。</span><span class="sxs-lookup"><span data-stu-id="f135e-454">Reference data is read-only data that supports application functionality.</span></span> <span data-ttu-id="f135e-455">它通常不常變更。</span><span class="sxs-lookup"><span data-stu-id="f135e-455">It typically doesn't change often.</span></span> <span data-ttu-id="f135e-456">雖然從備份還原是一種方式處理全區域服務中斷，RTO 是較長。</span><span class="sxs-lookup"><span data-stu-id="f135e-456">Although restoring from backup is one way to handle region-wide service disruptions, the RTO is relatively long.</span></span> <span data-ttu-id="f135e-457">當您將應用程式部署到次要地區時，有些策略可改善參考資料的 RTO。</span><span class="sxs-lookup"><span data-stu-id="f135e-457">When you deploy the application to a secondary region, some strategies can improve the RTO for reference data.</span></span>

    <span data-ttu-id="f135e-458">因為參考的資料變更很少，您可以改善 RTO，藉由維護永久複本在次要區域中的。</span><span class="sxs-lookup"><span data-stu-id="f135e-458">Because reference data changes infrequently, you can improve the RTO by maintaining a permanent copy in the secondary region.</span></span> <span data-ttu-id="f135e-459">這會排除在災害後還原備份所需的時間。</span><span class="sxs-lookup"><span data-stu-id="f135e-459">This eliminates the time required to restore backups after a disaster.</span></span> <span data-ttu-id="f135e-460">為了符合多重區域的災害復原需求，您必須在多個區域上一起部署應用程式和參考資料。</span><span class="sxs-lookup"><span data-stu-id="f135e-460">To meet the multiple-region disaster recovery requirements, you must deploy the application and the reference data together in multiple regions.</span></span>

- <span data-ttu-id="f135e-461">**使用開放式並行存取和最終一致性。**</span><span class="sxs-lookup"><span data-stu-id="f135e-461">**Use optimistic concurrency and eventual consistency.**</span></span> <span data-ttu-id="f135e-462">透過鎖定資源的交易封鎖存取 (*封閉式並行存取*) 可能會導致效能不佳，並降低可用性。</span><span class="sxs-lookup"><span data-stu-id="f135e-462">Transactions that block access to resources through locking (*pessimistic concurrency*) can cause poor performance and reduce availability.</span></span> <span data-ttu-id="f135e-463">這些問題在分散式系統中可能會變得特別嚴重。</span><span class="sxs-lookup"><span data-stu-id="f135e-463">These problems can become especially acute in distributed systems.</span></span> <span data-ttu-id="f135e-464">在許多情況下，謹慎設計和技術，例如資料分割，可以減少發生更新衝突的機會。</span><span class="sxs-lookup"><span data-stu-id="f135e-464">In many cases, careful design and techniques, such as partitioning, can minimize the chances of conflicting updates occurring.</span></span> <span data-ttu-id="f135e-465">如果資料已複寫，或從個別更新存放區讀取，才會最終一致的資料。</span><span class="sxs-lookup"><span data-stu-id="f135e-465">If data is replicated or read from a separately updated store, the data will only be eventually consistent.</span></span> <span data-ttu-id="f135e-466">但優點通常遠大於對使用交易來確保立即一致性的可用性的影響。</span><span class="sxs-lookup"><span data-stu-id="f135e-466">But the advantages usually outweigh the impact on availability of using transactions to ensure immediate consistency.</span></span>
- <span data-ttu-id="f135e-467">**若要將變更複寫到次要資料庫使用 SQL database 的主動式異地複寫。**</span><span class="sxs-lookup"><span data-stu-id="f135e-467">**Use active geo-replication for SQL Database to replicate changes to a secondary database.**</span></span> <span data-ttu-id="f135e-468">SQL database 的主動式異地複寫會自動將資料庫變更複寫至次要資料庫位於相同區域或不同區域中。</span><span class="sxs-lookup"><span data-stu-id="f135e-468">Active geo-replication for SQL Database automatically replicates database changes to secondary databases in the same region or a different region.</span></span> <span data-ttu-id="f135e-469">如需詳細資訊，請參閱 <<c0> [ 建立和使用主動式異地複寫](/azure/sql-database/sql-database-active-geo-replication)。</span><span class="sxs-lookup"><span data-stu-id="f135e-469">For more information, see [Creating and using active geo-replication](/azure/sql-database/sql-database-active-geo-replication).</span></span>

  <span data-ttu-id="f135e-470">或者，您可以採取較為手動的方式，利用**資料庫複製**命令來建立資料庫的備份副本，具有交易一致性。</span><span class="sxs-lookup"><span data-stu-id="f135e-470">Alternatively, you can take a more manual approach by using the **DATABASE COPY** command to create a backup copy of the database with transactional consistency.</span></span> <span data-ttu-id="f135e-471">您也可以使用 Azure SQL Database 的匯入/匯出服務，其支援將資料庫匯出到 BACPAC 檔案 (此為包含資料庫結構描述和相關聯資料的壓縮檔案)，並儲存在 Azure Blob 儲存體中。</span><span class="sxs-lookup"><span data-stu-id="f135e-471">You can also use the import/export service of Azure SQL Database, which supports exporting databases to BACPAC files (compressed files containing your database schema and associated data) that are stored in Azure Blob storage.</span></span> <span data-ttu-id="f135e-472">Azure 儲存體相同的區域中建立的備份檔案的兩個複本。</span><span class="sxs-lookup"><span data-stu-id="f135e-472">Azure Storage creates two replicas of the backup file in the same region.</span></span> <span data-ttu-id="f135e-473">不過，備份程序的頻率會決定您的 RPO，這是您可能會遺失在災害案例中的資料量。</span><span class="sxs-lookup"><span data-stu-id="f135e-473">However, the frequency of the backup process determines your RPO, which is the amount of data you might lose in disaster scenarios.</span></span> <span data-ttu-id="f135e-474">例如，如果您備份資料每隔一小時，而災害發生在備份之前的兩分鐘，將會遺失的 58 分鐘資料。</span><span class="sxs-lookup"><span data-stu-id="f135e-474">For example, if you back up data every hour, and a disaster occurs two minutes before the backup, you will lose 58 minutes of data.</span></span> <span data-ttu-id="f135e-475">此外，若要防止全區域的服務中斷，您應該將 BACPAC 檔案複製到替代區域。</span><span class="sxs-lookup"><span data-stu-id="f135e-475">Also, to protect against a region-wide service disruption, you should copy the BACPAC files to an alternate region.</span></span> <span data-ttu-id="f135e-476">如需詳細資訊，請參閱 <<c0> [ 使用 Azure SQL Database 的業務續航力概觀](/azure/sql-database/sql-database-business-continuity)。</span><span class="sxs-lookup"><span data-stu-id="f135e-476">For more information, see [Overview of business continuity with Azure SQL Database](/azure/sql-database/sql-database-business-continuity).</span></span>

- <span data-ttu-id="f135e-477">**用於 SQL 資料倉儲中的異地備份。**</span><span class="sxs-lookup"><span data-stu-id="f135e-477">**Use geo-backups for SQL Data Warehouse.**</span></span> <span data-ttu-id="f135e-478">對於 SQL 資料倉儲，請使用[異地備份](/azure/sql-data-warehouse/backup-and-restore)還原至配對區域以進行災害復原。</span><span class="sxs-lookup"><span data-stu-id="f135e-478">For SQL Data Warehouse, use [geo-backups](/azure/sql-data-warehouse/backup-and-restore) to restore to a paired region for disaster recovery.</span></span> <span data-ttu-id="f135e-479">這些備份會每隔 24 小時，且可以在 20 分鐘內還原在配對的區域中。</span><span class="sxs-lookup"><span data-stu-id="f135e-479">These backups are taken every 24 hours and can be restored within 20 minutes in the paired region.</span></span> <span data-ttu-id="f135e-480">所有的 SQL 資料倉儲執行個體的預設為開啟這項功能。</span><span class="sxs-lookup"><span data-stu-id="f135e-480">This feature is on by default for all SQL Data Warehouse instances.</span></span> <span data-ttu-id="f135e-481">如需有關如何還原您的資料倉儲的詳細資訊，請參閱[Azure 地理區域使用 PowerShell 從還原。](/azure/sql-data-warehouse/sql-data-warehouse-restore)</span><span class="sxs-lookup"><span data-stu-id="f135e-481">For more information on how to restore your data warehouse, see [Restore from an Azure geographical region using PowerShell.](/azure/sql-data-warehouse/sql-data-warehouse-restore)</span></span>

- <span data-ttu-id="f135e-482">**使用 Azure Site Recovery 複寫 VM 磁碟。**</span><span class="sxs-lookup"><span data-stu-id="f135e-482">**Replicate VM disks using Azure Site Recovery.**</span></span> <span data-ttu-id="f135e-483">使用 Azure Vm 的複寫時[Site Recovery](/azure/site-recovery/)，所有 VM 磁碟持續會以非同步方式都複寫到目標區域。</span><span class="sxs-lookup"><span data-stu-id="f135e-483">When you replicate Azure VMs using [Site Recovery](/azure/site-recovery/), all the VM disks are continuously replicated to the target region asynchronously.</span></span> <span data-ttu-id="f135e-484">每隔幾分鐘就會建立一次復原點。</span><span class="sxs-lookup"><span data-stu-id="f135e-484">The recovery points are created every few minutes.</span></span> <span data-ttu-id="f135e-485">這可讓您為大約幾分鐘的 RPO。</span><span class="sxs-lookup"><span data-stu-id="f135e-485">This gives you an RPO on the order of minutes.</span></span>
- <span data-ttu-id="f135e-486">**在 Vm 上執行的 SQL Server 備份或記錄傳送工作階段設定。**</span><span class="sxs-lookup"><span data-stu-id="f135e-486">**Back up SQL Server running on VMs or configure a log-shipping session.**</span></span> <span data-ttu-id="f135e-487">對於在虛擬機器上執行的 SQL Server，有兩種選項：傳統備份和記錄傳送。</span><span class="sxs-lookup"><span data-stu-id="f135e-487">For SQL Server running on VMs, there are two options: traditional backups and log shipping.</span></span> <span data-ttu-id="f135e-488">傳統備份可讓您還原至特定點的時間，但復原程序緩慢。</span><span class="sxs-lookup"><span data-stu-id="f135e-488">Traditional backups enable you to restore to a specific point in time, but the recovery process is slow.</span></span> <span data-ttu-id="f135e-489">還原傳統備份需要初始完整備份開始，然後套用之後所建立的任何備份。</span><span class="sxs-lookup"><span data-stu-id="f135e-489">Restoring traditional backups requires that you start with an initial full backup and then apply any backups taken after that.</span></span> <span data-ttu-id="f135e-490">第二個選項是設定記錄傳送工作階段 （例如，藉由兩個小時為單位） 的記錄備份還原延遲。</span><span class="sxs-lookup"><span data-stu-id="f135e-490">The second option is to configure a log-shipping session to delay the restore of log backups (for example, by two hours).</span></span> <span data-ttu-id="f135e-491">這會提供從在主要伺服器上所造成的錯誤復原的時間。</span><span class="sxs-lookup"><span data-stu-id="f135e-491">This provides a window to recover from errors made on the primary.</span></span>
- <span data-ttu-id="f135e-492">**Azure 儲存體備份使用自訂的處理序或協力廠商工具。**</span><span class="sxs-lookup"><span data-stu-id="f135e-492">**Use a custom process or third-party tool for Azure Storage backup.**</span></span> <span data-ttu-id="f135e-493">Azure 儲存體，您可以開發自訂備份程序，或使用協力廠商備份工具。</span><span class="sxs-lookup"><span data-stu-id="f135e-493">For Azure Storage, you can develop a custom backup process or use a third-party backup tool.</span></span> <span data-ttu-id="f135e-494">大部分的應用程式設計有額外的複雜性，其中的儲存體資源相互參考。</span><span class="sxs-lookup"><span data-stu-id="f135e-494">Most application designs have additional complexities, in which storage resources reference each other.</span></span> <span data-ttu-id="f135e-495">例如，假設 SQL database 具有資料行連結至 Azure 儲存體中的 blob。</span><span class="sxs-lookup"><span data-stu-id="f135e-495">For example, consider a SQL database with a column that links to a blob in Azure Storage.</span></span> <span data-ttu-id="f135e-496">如果備份未同時進行，則資料庫可能有失敗前未備份 Blob 的指標。</span><span class="sxs-lookup"><span data-stu-id="f135e-496">If the backups do not happen simultaneously, the database might have a pointer to a blob that was not backed up before the failure.</span></span> <span data-ttu-id="f135e-497">應用程式或災害復原計畫必須實作相關程序來處理復原後的此種不一致情況。</span><span class="sxs-lookup"><span data-stu-id="f135e-497">The application or disaster recovery plan must implement processes to handle this inconsistency after a recovery.</span></span>
- <span data-ttu-id="f135e-498">**用於在 Vm 上裝載的其他資料平台的原生複寫或快照集功能。**</span><span class="sxs-lookup"><span data-stu-id="f135e-498">**Use the native replication or snapshot capabilities for other data platforms hosted on VMs.**</span></span> <span data-ttu-id="f135e-499">其他資料平台，例如 Elasticsearch 或 MongoDB，有其自己的功能和考量時建立的整合式的備份和還原程序。</span><span class="sxs-lookup"><span data-stu-id="f135e-499">Other data platforms, such as Elasticsearch or MongoDB, have their own capabilities and considerations when creating an integrated backup and restore process.</span></span> <span data-ttu-id="f135e-500">對於這些資料平台，一般建議是使用任何原生或可用整合為基礎的複寫或快照集功能。</span><span class="sxs-lookup"><span data-stu-id="f135e-500">For these data platforms, the general recommendation is to use any native or available integration-based replication or snapshot capabilities.</span></span> <span data-ttu-id="f135e-501">如果這些功能不存在，或者不合適，請考慮使用 Azure 備份或磁碟的快照集建立的應用程式資料的時間點複本。</span><span class="sxs-lookup"><span data-stu-id="f135e-501">If those capabilities don't exist or aren't suitable, consider using Azure Backup or disk snapshots to create a point-in-time copy of application data.</span></span> <span data-ttu-id="f135e-502">在所有情況下，請務必判斷如何達到一致的備份，尤其是當應用程式資料橫跨多個檔案系統或多個磁碟機組合成單一檔案系統。</span><span class="sxs-lookup"><span data-stu-id="f135e-502">In all cases, it's important to determine how to achieve consistent backups, especially when application data spans multiple files systems or multiple drives are combined into a single file system.</span></span>
- <span data-ttu-id="f135e-503">**了解您的應用程式資料來源的複寫方法。**</span><span class="sxs-lookup"><span data-stu-id="f135e-503">**Understand the replication methods for your application's data sources.**</span></span> <span data-ttu-id="f135e-504">您的應用程式資料會儲存在不同的資料來源，並將具有不同可用性需求。</span><span class="sxs-lookup"><span data-stu-id="f135e-504">Your application data will be stored in different data sources and will have varied availability requirements.</span></span> <span data-ttu-id="f135e-505">評估的資料儲存在 Azure 中，每種類型的複寫方法包括[Azure 儲存體備援](/azure/storage/storage-redundancy/)並[SQL Database 作用中異地複寫](/azure/sql-database/sql-database-geo-replication-overview/)，確保您的應用程式資料已滿足需求。</span><span class="sxs-lookup"><span data-stu-id="f135e-505">Evaluate the replication methods for each type of data storage in Azure, including [Azure Storage redundancy](/azure/storage/storage-redundancy/) and [SQL Database active geo-replication](/azure/sql-database/sql-database-geo-replication-overview/) to ensure that your application's data requirements are satisfied.</span></span> <span data-ttu-id="f135e-506">如果您將使用的 Azure Vm 複寫[Site Recovery](/azure/site-recovery/)，所有 VM 磁碟持續會以非同步方式都複寫到目標區域。</span><span class="sxs-lookup"><span data-stu-id="f135e-506">If you replicate Azure VMs using [Site Recovery](/azure/site-recovery/), all the VM disks are continuously replicated to the target region asynchronously.</span></span> <span data-ttu-id="f135e-507">每隔幾分鐘就會建立一次復原點。</span><span class="sxs-lookup"><span data-stu-id="f135e-507">The recovery points are created every few minutes.</span></span>
- <span data-ttu-id="f135e-508">**建立災害復原的資料策略。**</span><span class="sxs-lookup"><span data-stu-id="f135e-508">**Establish data strategies for disaster recovery.**</span></span> <span data-ttu-id="f135e-509">適當處理資料是任何災害復原計劃的一項麻煩。</span><span class="sxs-lookup"><span data-stu-id="f135e-509">Proper data handling is a challenging aspect of any disaster recovery plan.</span></span> <span data-ttu-id="f135e-510">在復原過程中，通常會花最多時間在還原資料。</span><span class="sxs-lookup"><span data-stu-id="f135e-510">During the recovery process, data restoration typically takes the most time.</span></span> <span data-ttu-id="f135e-511">不同的降低功能選擇會導致資料修復和一致性的困難挑戰。</span><span class="sxs-lookup"><span data-stu-id="f135e-511">Different choices for reducing functionality result in difficult challenges for data recovery and consistency.</span></span>

## <a name="next-steps"></a><span data-ttu-id="f135e-512">後續步驟</span><span class="sxs-lookup"><span data-stu-id="f135e-512">Next steps</span></span>

> [!div class="nextstepaction"]
> [<span data-ttu-id="f135e-513">針對復原能力和可用性測試</span><span class="sxs-lookup"><span data-stu-id="f135e-513">Test for resiliency and availability</span></span>](./testing.md)
