---
title: 自動調整指引
titleSuffix: Best practices for cloud applications
description: 如何自動調整以動態方式配置應用程式所需資源的指引。
author: dragon119
ms.date: 05/17/2017
ms.topic: best-practice
ms.service: architecture-center
ms.subservice: cloud-fundamentals
ms.custom: seodec18
ms.openlocfilehash: 8b1d614460b8c0bd9655d7b75cd971767e34ee3f
ms.sourcegitcommit: c053e6edb429299a0ad9b327888d596c48859d4a
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/20/2019
ms.locfileid: "58243429"
---
# <a name="autoscaling"></a><span data-ttu-id="84519-103">自動調整</span><span class="sxs-lookup"><span data-stu-id="84519-103">Autoscaling</span></span>

<span data-ttu-id="84519-104">自動調整是以動態方式配置資源以符合效能需求的程序。</span><span class="sxs-lookup"><span data-stu-id="84519-104">Autoscaling is the process of dynamically allocating resources to match performance requirements.</span></span> <span data-ttu-id="84519-105">隨著工作量的成長，應用程式可能需要額外的資源來保有所需的效能層級及滿足服務等級協定 (SLA)。</span><span class="sxs-lookup"><span data-stu-id="84519-105">As the volume of work grows, an application may need additional resources to maintain the desired performance levels and satisfy service-level agreements (SLAs).</span></span> <span data-ttu-id="84519-106">當需要降低而不再需要其他資源，可以將它們解除配置以將成本降至最低。</span><span class="sxs-lookup"><span data-stu-id="84519-106">As demand slackens and the additional resources are no longer needed, they can be de-allocated to minimize costs.</span></span>

<span data-ttu-id="84519-107">自動調整會充分利用雲端裝載環境的彈性，以降低管理負擔。</span><span class="sxs-lookup"><span data-stu-id="84519-107">Autoscaling takes advantage of the elasticity of cloud-hosted environments while easing management overhead.</span></span> <span data-ttu-id="84519-108">它可減少操作員持續監視系統效能的需求，並做出有關新增或移除資源的決策。</span><span class="sxs-lookup"><span data-stu-id="84519-108">It reduces the need for an operator to continually monitor the performance of a system and make decisions about adding or removing resources.</span></span>

<span data-ttu-id="84519-109">應用程式有兩種主要方式可調整：</span><span class="sxs-lookup"><span data-stu-id="84519-109">There are two main ways that an application can scale:</span></span>

- <span data-ttu-id="84519-110">**垂直縮放比例**，也稱為相應增加和相應減少，表示變更資源的容量。</span><span class="sxs-lookup"><span data-stu-id="84519-110">**Vertical scaling**, also called scaling up and down, means changing the capacity of a resource.</span></span> <span data-ttu-id="84519-111">例如，您可以將應用程式移動為較大的 VM 大小。</span><span class="sxs-lookup"><span data-stu-id="84519-111">For example, you could move an application to a larger VM size.</span></span> <span data-ttu-id="84519-112">垂直調整通常要求在重新部署時系統必須暫時無法使用。</span><span class="sxs-lookup"><span data-stu-id="84519-112">Vertical scaling often requires making the system temporarily unavailable while it is being redeployed.</span></span> <span data-ttu-id="84519-113">因此，將垂直調整自動化較不常見。</span><span class="sxs-lookup"><span data-stu-id="84519-113">Therefore, it's less common to automate vertical scaling.</span></span>

- <span data-ttu-id="84519-114">**水平調整**，也稱為向外和向內調整，表示新增或移除資源的執行個體。</span><span class="sxs-lookup"><span data-stu-id="84519-114">**Horizontal scaling**, also called scaling out and in, means adding or removing instances of a resource.</span></span> <span data-ttu-id="84519-115">在佈建這些新資源時，應用程式會繼續執行而不中斷。</span><span class="sxs-lookup"><span data-stu-id="84519-115">The application continues running without interruption as new resources are provisioned.</span></span> <span data-ttu-id="84519-116">佈建程序完成時，解決方案即會部署在這些額外的資源上。</span><span class="sxs-lookup"><span data-stu-id="84519-116">When the provisioning process is complete, the solution is deployed on these additional resources.</span></span> <span data-ttu-id="84519-117">如果要求降低，則可以完全關閉及取消配置這些額外的資源。</span><span class="sxs-lookup"><span data-stu-id="84519-117">If demand drops, the additional resources can be shut down cleanly and deallocated.</span></span>

<span data-ttu-id="84519-118">許多雲端系統 (包括 Microsoft Azure) 都支援自動的垂直調整。</span><span class="sxs-lookup"><span data-stu-id="84519-118">Many cloud-based systems, including Microsoft Azure, support automatic horizontal scaling.</span></span> <span data-ttu-id="84519-119">本文的其餘部分著重於水平調整。</span><span class="sxs-lookup"><span data-stu-id="84519-119">The rest of this article focuses on horizontal scaling.</span></span>

> [!NOTE]
> <span data-ttu-id="84519-120">自動調整大多適用於計算資源。</span><span class="sxs-lookup"><span data-stu-id="84519-120">Autoscaling mostly applies to compute resources.</span></span> <span data-ttu-id="84519-121">雖然可以水平調整資料庫或訊息佇列，這通常牽涉到一般不會自動化的[資料分割](./data-partitioning.md)。</span><span class="sxs-lookup"><span data-stu-id="84519-121">While it's possible to horizontally scale a database or message queue, this usually involves [data partitioning](./data-partitioning.md), which is generally not automated.</span></span>

## <a name="overview"></a><span data-ttu-id="84519-122">概觀</span><span class="sxs-lookup"><span data-stu-id="84519-122">Overview</span></span>

<span data-ttu-id="84519-123">自動調整策略通常牽涉到下列部分：</span><span class="sxs-lookup"><span data-stu-id="84519-123">An autoscaling strategy typically involves the following pieces:</span></span>

- <span data-ttu-id="84519-124">檢測和監視應用程式、服務和基礎結構層級上的系統。</span><span class="sxs-lookup"><span data-stu-id="84519-124">Instrumentation and monitoring systems at the application, service, and infrastructure levels.</span></span> <span data-ttu-id="84519-125">這些系統會擷取關鍵計量，例如回應時間、佇列長度、CPU 使用率及記憶體使用量。</span><span class="sxs-lookup"><span data-stu-id="84519-125">These systems capture key metrics, such as response times, queue lengths, CPU utilization, and memory usage.</span></span>
- <span data-ttu-id="84519-126">針對預先定義的臨界值或排程評估這些計量，並決定是否要調整的決策制訂邏輯。</span><span class="sxs-lookup"><span data-stu-id="84519-126">Decision-making logic that evaluates these metrics against predefined thresholds or schedules, and decides whether to scale.</span></span>
- <span data-ttu-id="84519-127">調整系統的元件。</span><span class="sxs-lookup"><span data-stu-id="84519-127">Components that scale the system.</span></span>
- <span data-ttu-id="84519-128">測試、監視和微調自動調整策略，以確保它能正常運作。</span><span class="sxs-lookup"><span data-stu-id="84519-128">Testing, monitoring, and tuning of the autoscaling strategy to ensure that it functions as expected.</span></span>

<span data-ttu-id="84519-129">Azure 提供可處理常見情節的內建自動調整機制。</span><span class="sxs-lookup"><span data-stu-id="84519-129">Azure provides built-in autoscaling mechanisms that address common scenarios.</span></span> <span data-ttu-id="84519-130">如果特定服務或技術並沒有內建的自動調整功能，或如果您有功能之外的特定自動調整需求，則可以考慮自訂實作。</span><span class="sxs-lookup"><span data-stu-id="84519-130">If a particular service or technology does not have built-in autoscaling functionality, or if you have specific autoscaling requirements beyond its capabilities, you might consider a custom implementation.</span></span> <span data-ttu-id="84519-131">自訂實作會收集作業和系統計量、分析計量資訊，然後據以調整資源。</span><span class="sxs-lookup"><span data-stu-id="84519-131">A custom implementation would collect operational and system metrics, analyze the metrics, and then scale resources accordingly.</span></span>

## <a name="configure-autoscaling-for-an-azure-solution"></a><span data-ttu-id="84519-132">為 Azure 解決方案設定自動調整</span><span class="sxs-lookup"><span data-stu-id="84519-132">Configure autoscaling for an Azure solution</span></span>

<span data-ttu-id="84519-133">Azure 針對多數運算選項提供內建的自動調整。</span><span class="sxs-lookup"><span data-stu-id="84519-133">Azure provides built-in autoscaling for most compute options.</span></span>

- <span data-ttu-id="84519-134">**虛擬機器**透過使用 [VM 擴展集][vm-scale-sets] (以群組的形式來管理一組 Azure 虛擬機器的方法) 來支援自動調整。</span><span class="sxs-lookup"><span data-stu-id="84519-134">**Virtual Machines** support autoscaling through the use of [VM Scale Sets][vm-scale-sets], which are a way to manage a set of Azure virtual machines as a group.</span></span> <span data-ttu-id="84519-135">請參閱[如何使用自動調整與虛擬機器擴展集][vm-scale-sets-autoscale]。</span><span class="sxs-lookup"><span data-stu-id="84519-135">See [How to use automatic scaling and Virtual Machine Scale Sets][vm-scale-sets-autoscale].</span></span>

- <span data-ttu-id="84519-136">**Service Fabric** 也透過 VM 擴展集來支援自動調整。</span><span class="sxs-lookup"><span data-stu-id="84519-136">**Service Fabric** also supports auto-scaling through VM Scale Sets.</span></span> <span data-ttu-id="84519-137">Service Fabric 叢集中的每個節點類型都會設定為個別的 VM 擴展集。</span><span class="sxs-lookup"><span data-stu-id="84519-137">Every node type in a Service Fabric cluster is set up as a separate VM scale set.</span></span> <span data-ttu-id="84519-138">這樣一來，每個節點類型可獨立相應縮小或相應放大。</span><span class="sxs-lookup"><span data-stu-id="84519-138">That way, each node type can be scaled in or out independently.</span></span> <span data-ttu-id="84519-139">請參閱[使用自動調整規則相應縮小或放大 Service Fabric 叢集][service-fabric-autoscale]。</span><span class="sxs-lookup"><span data-stu-id="84519-139">See [Scale a Service Fabric cluster in or out using auto-scale rules][service-fabric-autoscale].</span></span>

- <span data-ttu-id="84519-140">**Azure App Service** 具有內建的自動調整。</span><span class="sxs-lookup"><span data-stu-id="84519-140">**Azure App Service** has built-in autoscaling.</span></span> <span data-ttu-id="84519-141">自動調整設定會套用到 App Service 內的所有應用程式。</span><span class="sxs-lookup"><span data-stu-id="84519-141">Autoscale settings apply to all of the apps within an App Service.</span></span> <span data-ttu-id="84519-142">請參閱[手動或自動調整執行個體計數][app-service-autoscale]。</span><span class="sxs-lookup"><span data-stu-id="84519-142">See [Scale instance count manually or automatically][app-service-autoscale].</span></span>

- <span data-ttu-id="84519-143">**Azure 雲端服務**在角色層級有內建的自動調整。</span><span class="sxs-lookup"><span data-stu-id="84519-143">**Azure Cloud Services** has built-in autoscaling at the role level.</span></span> <span data-ttu-id="84519-144">請參閱[如何在入口網站中設定雲端服務的自動調整][cloud-services-autoscale]。</span><span class="sxs-lookup"><span data-stu-id="84519-144">See [How to configure auto scaling for a Cloud Service in the portal][cloud-services-autoscale].</span></span>

<span data-ttu-id="84519-145">這些計算選項全都使用 [Azure 監視器自動調整][monitoring]來提供一組常用的自動調整功能。</span><span class="sxs-lookup"><span data-stu-id="84519-145">These compute options all use [Azure Monitor autoscale][monitoring] to provide a common set of autoscaling functionality.</span></span>

- <span data-ttu-id="84519-146">**Azure Functions** 與先前的計算選項不同，因為您不需要設定任何自動調整規則。</span><span class="sxs-lookup"><span data-stu-id="84519-146">**Azure Functions** differs from the previous compute options, because you don't need to configure any autoscale rules.</span></span> <span data-ttu-id="84519-147">相反地，Azure Functions 會自動配置您的程式碼時執行的運算能力，視需要向外擴充以處理負載。</span><span class="sxs-lookup"><span data-stu-id="84519-147">Instead, Azure Functions automatically allocates compute power when your code is running, scaling out as necessary to handle load.</span></span> <span data-ttu-id="84519-148">如需詳細資訊，請參閱[選擇正確的 Azure Functions 裝載方案][functions-scale]。</span><span class="sxs-lookup"><span data-stu-id="84519-148">For more information, see [Choose the correct hosting plan for Azure Functions][functions-scale].</span></span>

<span data-ttu-id="84519-149">最後，自訂的自動調整解決方案有時會很實用。</span><span class="sxs-lookup"><span data-stu-id="84519-149">Finally, a custom autoscaling solution can sometimes be useful.</span></span> <span data-ttu-id="84519-150">例如，您可以使用 Azure 診斷和以應用程式為基礎的計量，以及自訂程式碼來監視和匯出應用程式計量。</span><span class="sxs-lookup"><span data-stu-id="84519-150">For example, you could use Azure diagnostics and application-based metrics, along with custom code to monitor and export the application metrics.</span></span> <span data-ttu-id="84519-151">然後您可以根據這些計量定義自訂規則，並使用 Resource Manager REST API 來觸發自動調整。</span><span class="sxs-lookup"><span data-stu-id="84519-151">Then you could define custom rules based on these metrics, and use Resource Manager REST APIs to trigger autoscaling.</span></span> <span data-ttu-id="84519-152">不過，自訂解決方案並不容易實作，只應在前述方法都無法滿足您的需求時才加以考慮。</span><span class="sxs-lookup"><span data-stu-id="84519-152">However, a custom solution is not simple to implement, and should be considered only if none of the previous approaches can fulfill your requirements.</span></span>

<span data-ttu-id="84519-153">如果平台的內建自動調整功能可符合您的需求，就使用它們。</span><span class="sxs-lookup"><span data-stu-id="84519-153">Use the built-in autoscaling features of the platform, if they meet your requirements.</span></span> <span data-ttu-id="84519-154">如果沒有，請仔細考量您是否需要更複雜的縮放功能。</span><span class="sxs-lookup"><span data-stu-id="84519-154">If not, carefully consider whether you really need more complex scaling features.</span></span> <span data-ttu-id="84519-155">需求的部分範例包括更細微的控制程度、偵測觸發事件進行調整的其他方式、跨訂用帳戶進行調整，以及調整其他資源類型。</span><span class="sxs-lookup"><span data-stu-id="84519-155">Examples of additional requirements may include more granularity of control, different ways to detect trigger events for scaling, scaling across subscriptions, and scaling other types of resources.</span></span>

## <a name="use-azure-monitor-autoscale"></a><span data-ttu-id="84519-156">使用 Azure 監視器自動調整</span><span class="sxs-lookup"><span data-stu-id="84519-156">Use Azure Monitor autoscale</span></span>

<span data-ttu-id="84519-157">[Azure 監視器自動調整][monitoring]為 VM 擴展集、Azure App Service，以及 Azure 雲端服務提供一組常用的自動調整功能。</span><span class="sxs-lookup"><span data-stu-id="84519-157">[Azure Monitor autoscale][monitoring] provide a common set of autoscaling functionality for VM Scale Sets, Azure App Service, and Azure Cloud Service.</span></span> <span data-ttu-id="84519-158">調整可以根據排程執行或根據執行階段計量 (例如 CPU 或記憶體使用量) 執行。</span><span class="sxs-lookup"><span data-stu-id="84519-158">Scaling can be performed on a schedule, or based on a runtime metric, such as CPU or memory usage.</span></span> <span data-ttu-id="84519-159">範例：</span><span class="sxs-lookup"><span data-stu-id="84519-159">Examples:</span></span>

- <span data-ttu-id="84519-160">在工作日相應放大為 10 個執行個體，以及在星期六和星期日相應縮小為 4 個執行個體。</span><span class="sxs-lookup"><span data-stu-id="84519-160">Scale out to 10 instances on weekdays, and scale in to 4 instances on Saturday and Sunday.</span></span>
- <span data-ttu-id="84519-161">如果平均 CPU 使用量超過 70%，則相應放大一個執行個體，而如果 CPU 使用量低於 50%，則相應縮小一個執行個體。</span><span class="sxs-lookup"><span data-stu-id="84519-161">Scale out by one instance if average CPU usage is above 70%, and scale in by one instance if CPU usage falls below 50%.</span></span>
- <span data-ttu-id="84519-162">如果佇列中的訊息數目超過某個臨界值，則相應放大一個執行個體。</span><span class="sxs-lookup"><span data-stu-id="84519-162">Scale out by one instance if the number of messages in a queue exceeds a certain threshold.</span></span>

<span data-ttu-id="84519-163">如需內建計量的清單，請參閱 [Azure 監視器的自動調整常見計量][autoscale-metrics]。</span><span class="sxs-lookup"><span data-stu-id="84519-163">For a list of built-in metrics, see [Azure Monitor autoscaling common metrics][autoscale-metrics].</span></span> <span data-ttu-id="84519-164">您也可以使用 Application Insights 來實作自訂的計量。</span><span class="sxs-lookup"><span data-stu-id="84519-164">You can also implement custom metrics by using Application Insights.</span></span>

<span data-ttu-id="84519-165">您可以使用 PowerShell、Azure CLI、Azure Resource Manager 範本或 Azure 入口網站來設定自動調整。</span><span class="sxs-lookup"><span data-stu-id="84519-165">You can configure autoscaling by using PowerShell, the Azure CLI, an Azure Resource Manager template, or the Azure portal.</span></span> <span data-ttu-id="84519-166">如需更詳細的控制，請使用 [Azure Resource Manager REST API](https://msdn.microsoft.com//library/azure/dn790568.aspx)。</span><span class="sxs-lookup"><span data-stu-id="84519-166">For more detailed control, use the [Azure Resource Manager REST API](https://msdn.microsoft.com//library/azure/dn790568.aspx).</span></span> <span data-ttu-id="84519-167">[Azure 監視服務管理程式庫](https://www.nuget.org/packages/Microsoft.WindowsAzure.Management.Monitoring)和 [Microsoft Insights 程式庫](https://www.nuget.org/packages/Microsoft.Azure.Insights/) (預覽版) 是可讓您從不同的資源收集計量以及利用 REST API 執行自動調整的 SDK。</span><span class="sxs-lookup"><span data-stu-id="84519-167">The [Azure Monitoring Service Management Library](https://www.nuget.org/packages/Microsoft.WindowsAzure.Management.Monitoring) and the [Microsoft Insights Library](https://www.nuget.org/packages/Microsoft.Azure.Insights/) (in preview) are SDKs that allow collecting metrics from different resources, and perform autoscaling by making use of the REST APIs.</span></span> <span data-ttu-id="84519-168">對於不支援 Azure Resource Manager 的資源，或是當您使用 Azure 雲端服務時，都可以使用服務管理 REST API 進行自動調整。</span><span class="sxs-lookup"><span data-stu-id="84519-168">For resources where Azure Resource Manager support isn't available, or if you are using Azure Cloud Services, the Service Management REST API can be used for autoscaling.</span></span> <span data-ttu-id="84519-169">在所有其他情況下，請使用 Azure Resource Manager。</span><span class="sxs-lookup"><span data-stu-id="84519-169">In all other cases, use Azure Resource Manager.</span></span>

<span data-ttu-id="84519-170">使用 Azure 自動調整時，請考慮下列幾點：</span><span class="sxs-lookup"><span data-stu-id="84519-170">Consider the following points when using Azure autoscale:</span></span>

- <span data-ttu-id="84519-171">請考慮您是否可以善加預測應用程式負載，以便只依賴排程自動調整，新增和移除執行個體以滿足要求的預期尖峰期。</span><span class="sxs-lookup"><span data-stu-id="84519-171">Consider whether you can predict the load on the application well enough to use scheduled autoscaling, adding and removing instances to meet anticipated peaks in demand.</span></span> <span data-ttu-id="84519-172">如果不可行，請使用基於執行階段計量的反應式自動調整，以便處理無法預期的需求變更。</span><span class="sxs-lookup"><span data-stu-id="84519-172">If this isn't possible, use reactive autoscaling based on runtime metrics, in order to handle unpredictable changes in demand.</span></span> <span data-ttu-id="84519-173">一般而言，您可以結合這些方法。</span><span class="sxs-lookup"><span data-stu-id="84519-173">Typically, you can combine these approaches.</span></span> <span data-ttu-id="84519-174">例如，建立會根據應用程式何時最忙碌的排程新增資源的策略。</span><span class="sxs-lookup"><span data-stu-id="84519-174">For example, create a strategy that adds resources based on a schedule of the times when you know the application is most busy.</span></span> <span data-ttu-id="84519-175">這有助於確保容量在需要時可供使用，不會因啟動新執行個體發生任何延遲。</span><span class="sxs-lookup"><span data-stu-id="84519-175">This helps to ensure that capacity is available when required, without any delay from starting new instances.</span></span> <span data-ttu-id="84519-176">針對每個排程的規則，定義在該期間內允許被動式自動調整的計量，以確保應用程式能夠處理持續但無法預期的要求尖峰期。</span><span class="sxs-lookup"><span data-stu-id="84519-176">For each scheduled rule, define metrics that allow reactive autoscaling during that period to ensure that the application can handle sustained but unpredictable peaks in demand.</span></span>

- <span data-ttu-id="84519-177">通常很難了解計量和容量需求之間的關聯性，尤其是在最初部署應用程式的時候。</span><span class="sxs-lookup"><span data-stu-id="84519-177">It's often difficult to understand the relationship between metrics and capacity requirements, especially when an application is initially deployed.</span></span> <span data-ttu-id="84519-178">一開始多佈建一些額外的容量，然後加以監視並調整自動調整規則，使容量更接近實際負載。</span><span class="sxs-lookup"><span data-stu-id="84519-178">Provision a little extra capacity at the beginning, and then monitor and tune the autoscaling rules to bring the capacity closer to the actual load.</span></span>

- <span data-ttu-id="84519-179">設定自動調整規則，然後監視經過一段時間的應用程式效能。</span><span class="sxs-lookup"><span data-stu-id="84519-179">Configure the autoscaling rules, and then monitor the performance of your application over time.</span></span> <span data-ttu-id="84519-180">如有必要，使用此監視結果來調整系統的調整方式。</span><span class="sxs-lookup"><span data-stu-id="84519-180">Use the results of this monitoring to adjust the way in which the system scales if necessary.</span></span> <span data-ttu-id="84519-181">不過，請記住，自動調整不是即時生效的程序</span><span class="sxs-lookup"><span data-stu-id="84519-181">However, keep in mind that autoscaling is not an instantaneous process.</span></span> <span data-ttu-id="84519-182">它需要時間來回應計量，例如平均 CPU 使用率超過 (或低於) 指定的臨界值。</span><span class="sxs-lookup"><span data-stu-id="84519-182">It takes time to react to a metric such as average CPU utilization exceeding (or falling below) a specified threshold.</span></span>

- <span data-ttu-id="84519-183">根據測量的觸發程序屬性 (例如 CPU 使用量或佇列長度) 使用偵測機制的自動調整規則，會使用經過一段時間的彙總值 (而不是瞬間值) 來觸發自動調整動作。</span><span class="sxs-lookup"><span data-stu-id="84519-183">Autoscaling rules that use a detection mechanism based on a measured trigger attribute (such as CPU usage or queue length) use an aggregated value over time, rather than instantaneous values, to trigger an autoscaling action.</span></span> <span data-ttu-id="84519-184">根據預設，彙總是值的平均。</span><span class="sxs-lookup"><span data-stu-id="84519-184">By default, the aggregate is an average of the values.</span></span> <span data-ttu-id="84519-185">這可防止系統反應太快，或造成快速震盪。</span><span class="sxs-lookup"><span data-stu-id="84519-185">This prevents the system from reacting too quickly, or causing rapid oscillation.</span></span> <span data-ttu-id="84519-186">這也可以讓自動啟動的新執行個體順利進入執行模式，避免新執行個體正在啟動時，又發生其他自動調整動作。</span><span class="sxs-lookup"><span data-stu-id="84519-186">It also allows time for new instances that are auto-started to settle into running mode, preventing additional autoscaling actions from occurring while the new instances are starting up.</span></span> <span data-ttu-id="84519-187">若是 Azure 雲端服務和 Azure 虛擬機器，彙總的預設期間為 45 分鐘，因此，計量需要經過這段時間後再觸發自動調整以回應尖峰需求量。</span><span class="sxs-lookup"><span data-stu-id="84519-187">For Azure Cloud Services and Azure Virtual Machines, the default period for the aggregation is 45 minutes, so it can take up to this period of time for the metric to trigger autoscaling in response to spikes in demand.</span></span> <span data-ttu-id="84519-188">您可以使用 SDK 來變更彙總期間，但請注意，若其間低於 25 分鐘，可能會造成無法預期的結果。</span><span class="sxs-lookup"><span data-stu-id="84519-188">You can change the aggregation period by using the SDK, but be aware that periods of fewer than 25 minutes may cause unpredictable results.</span></span> <span data-ttu-id="84519-189">若是 Web Apps，平均期間較短，允許在平均觸發量值變更約五分鐘後提供新執行個體。</span><span class="sxs-lookup"><span data-stu-id="84519-189">For Web Apps, the averaging period is much shorter, allowing new instances to be available in about five minutes after a change to the average trigger measure.</span></span>

- <span data-ttu-id="84519-190">如果您使用 SDK 設定自動調整，而不是使用入口網站，您可以指定更詳細的作用中規則排程期間。</span><span class="sxs-lookup"><span data-stu-id="84519-190">If you configure autoscaling using the SDK rather than the portal, you can specify a more detailed schedule during which the rules are active.</span></span> <span data-ttu-id="84519-191">您也可以建立您自己的度量，並在自動調整規則中與現有度量一起使用。</span><span class="sxs-lookup"><span data-stu-id="84519-191">You can also create your own metrics and use them with or without any of the existing ones in your autoscaling rules.</span></span> <span data-ttu-id="84519-192">例如，您可能想要使用替代計數器 (例如，每秒要求數或平均記憶體可用性)，或使用自訂計數器來測量特定商務程序。</span><span class="sxs-lookup"><span data-stu-id="84519-192">For example, you may wish to use alternative counters, such as the number of requests per second or the average memory availability, or use custom counters that measure specific business processes.</span></span>

- <span data-ttu-id="84519-193">自動調整 Service Fabric 時，節點類型是由後端的 VM 擴展集建立，所以您必須為每個節點類型設定自動調整規則。</span><span class="sxs-lookup"><span data-stu-id="84519-193">When autoscaling Service Fabric, the node types in your cluster are made of VM scale sets at the backend, so you need to set up auto-scale rules for each node type.</span></span> <span data-ttu-id="84519-194">請先考慮一定要有的節點數目，再設定自動調整規模。</span><span class="sxs-lookup"><span data-stu-id="84519-194">Take into account the number of nodes that you must have before you set up auto-scaling.</span></span> <span data-ttu-id="84519-195">主要節點類型一定要有的節點數目下限是由您已選擇的可靠性層級決定。</span><span class="sxs-lookup"><span data-stu-id="84519-195">The minimum number of nodes that you must have for the primary node type is driven by the reliability level you have chosen.</span></span> <span data-ttu-id="84519-196">如需詳細資訊，請參閱[使用自動調整規則相應縮小或放大 Service Fabric 叢集](/azure/service-fabric/service-fabric-cluster-scale-up-down)。</span><span class="sxs-lookup"><span data-stu-id="84519-196">For more info, see [scale a Service Fabric cluster in or out using auto-scale rules](/azure/service-fabric/service-fabric-cluster-scale-up-down).</span></span>

- <span data-ttu-id="84519-197">您可以使用入口網站，將 SQL Database 執行個體和佇列之類的資源連結至雲端服務執行個體。</span><span class="sxs-lookup"><span data-stu-id="84519-197">You can use the portal to link resources such as SQL Database instances and queues to a Cloud Service instance.</span></span> <span data-ttu-id="84519-198">這可讓您更輕鬆地存取每個連結資源的個別手動和自動調整設定選項。</span><span class="sxs-lookup"><span data-stu-id="84519-198">This allows you to more easily access the separate manual and automatic scaling configuration options for each of the linked resources.</span></span> <span data-ttu-id="84519-199">如需詳細資訊，請參閱[操作說明：將資源連結至雲端服務](/azure/cloud-services/cloud-services-how-to-manage)。</span><span class="sxs-lookup"><span data-stu-id="84519-199">For more information, see [How to: Link a resource to a cloud service](/azure/cloud-services/cloud-services-how-to-manage).</span></span>

- <span data-ttu-id="84519-200">當您設定多個原則和規則時，它們有可能互相衝突。</span><span class="sxs-lookup"><span data-stu-id="84519-200">When you configure multiple policies and rules, they could conflict with each other.</span></span> <span data-ttu-id="84519-201">自動調整會使用下列衝突解決規則，來確保一定有足量的執行中執行個體：</span><span class="sxs-lookup"><span data-stu-id="84519-201">Autoscale uses the following conflict resolution rules to ensure that there is always a sufficient number of instances running:</span></span>
  - <span data-ttu-id="84519-202">相應放大作業一律優先於相應縮小作業。</span><span class="sxs-lookup"><span data-stu-id="84519-202">Scale out operations always take precedence over scale in operations.</span></span>
  - <span data-ttu-id="84519-203">當相應放大作業發生衝突時，起始執行個體數目增幅最多的規則優先。</span><span class="sxs-lookup"><span data-stu-id="84519-203">When scale out operations conflict, the rule that initiates the largest increase in the number of instances takes precedence.</span></span>
  - <span data-ttu-id="84519-204">當相應縮小作業發生衝突時，起始執行個體數目降幅最少的規則優先。</span><span class="sxs-lookup"><span data-stu-id="84519-204">When scale in operations conflict, the rule that initiates the smallest decrease in the number of instances takes precedence.</span></span>

- <span data-ttu-id="84519-205">在 App Service 環境中，任何背景工作集區或前端計量均可用來定義自動調整規則。</span><span class="sxs-lookup"><span data-stu-id="84519-205">In an App Service Environment any worker pool or front-end metrics can be used to define autoscale rules.</span></span> <span data-ttu-id="84519-206">如需詳細資訊，請參閱[自動調整和 App Service 環境](/azure/app-service/app-service-environment-auto-scale)。</span><span class="sxs-lookup"><span data-stu-id="84519-206">For more information, see [Autoscaling and App Service Environment](/azure/app-service/app-service-environment-auto-scale).</span></span>

## <a name="application-design-considerations"></a><span data-ttu-id="84519-207">應用程式設計考量</span><span class="sxs-lookup"><span data-stu-id="84519-207">Application design considerations</span></span>

<span data-ttu-id="84519-208">自動調整不是立即見效的解決方案。</span><span class="sxs-lookup"><span data-stu-id="84519-208">Autoscaling isn't an instant solution.</span></span> <span data-ttu-id="84519-209">只是將資源加入至系統或執行更多處理程序執行個體，並不保證能改善系統效能。</span><span class="sxs-lookup"><span data-stu-id="84519-209">Simply adding resources to a system or running more instances of a process doesn't guarantee that the performance of the system will improve.</span></span> <span data-ttu-id="84519-210">設計自動調整策略時，請考慮下列幾點：</span><span class="sxs-lookup"><span data-stu-id="84519-210">Consider the following points when designing an autoscaling strategy:</span></span>

- <span data-ttu-id="84519-211">系統必須設計為可以水平調整。</span><span class="sxs-lookup"><span data-stu-id="84519-211">The system must be designed to be horizontally scalable.</span></span> <span data-ttu-id="84519-212">不要假設執行個體具有同質性；不要設計出程式碼一律在特定的處理程序執行個體中執行的解決方案。</span><span class="sxs-lookup"><span data-stu-id="84519-212">Avoid making assumptions about instance affinity; do not design solutions that require that the code is always running in a specific instance of a process.</span></span> <span data-ttu-id="84519-213">水平調整雲端服務或網站時，不要假設一系列來自相同來源的要求一律會路由傳送至相同的執行個體。</span><span class="sxs-lookup"><span data-stu-id="84519-213">When scaling a cloud service or web site horizontally, don't assume that a series of requests from the same source will always be routed to the same instance.</span></span> <span data-ttu-id="84519-214">基於相同理由，請將服務設計成無狀態，以避免需將一連串來自應用程式的要求一律路由傳送至相同的服務執行個體。</span><span class="sxs-lookup"><span data-stu-id="84519-214">For the same reason, design services to be stateless to avoid requiring a series of requests from an application to always be routed to the same instance of a service.</span></span> <span data-ttu-id="84519-215">在設計從佇列讀取訊息並處理它們的服務時，不要假設哪個服務的執行個體會處理特定訊息。</span><span class="sxs-lookup"><span data-stu-id="84519-215">When designing a service that reads messages from a queue and processes them, don't make any assumptions about which instance of the service handles a specific message.</span></span> <span data-ttu-id="84519-216">自動調整會在佇列長度增長時，啟動其他的服務執行個體。</span><span class="sxs-lookup"><span data-stu-id="84519-216">Autoscaling could start additional instances of a service as the queue length grows.</span></span> <span data-ttu-id="84519-217">[競爭取用者模式](../patterns/competing-consumers.md)說明如何解決這種情況。</span><span class="sxs-lookup"><span data-stu-id="84519-217">The [Competing Consumers pattern](../patterns/competing-consumers.md) describes how to handle this scenario.</span></span>

- <span data-ttu-id="84519-218">如果解決方案會實作長時間執行的工作，請將此工作設計為同時支援相應縮小和相應放大。</span><span class="sxs-lookup"><span data-stu-id="84519-218">If the solution implements a long-running task, design this task to support both scaling out and scaling in.</span></span> <span data-ttu-id="84519-219">如果不小心，這類工作會在系統相應放大時阻止處理程序執行個體完全關閉，或者，如果處理程序被強制終止，則可能會遺失資料。</span><span class="sxs-lookup"><span data-stu-id="84519-219">Without due care, such a task could prevent an instance of a process from being shut down cleanly when the system scales in, or it could lose data if the process is forcibly terminated.</span></span> <span data-ttu-id="84519-220">理想的情況是，重整長時間執行工作並分解處理，讓其以較小且不連續的區塊執行。</span><span class="sxs-lookup"><span data-stu-id="84519-220">Ideally, refactor a long-running task and break up the processing that it performs into smaller, discrete chunks.</span></span> <span data-ttu-id="84519-221">[管道與篩選模式](../patterns/pipes-and-filters.md)提供如何達成的範例。</span><span class="sxs-lookup"><span data-stu-id="84519-221">The [Pipes and Filters pattern](../patterns/pipes-and-filters.md) provides an example of how you can achieve this.</span></span>

- <span data-ttu-id="84519-222">或者，您可以實作檢查點機制，定期記錄工作的狀態資訊，並將此狀態儲存在執行工作之任何處理程序執行個體可以存取的耐久性儲存體中。</span><span class="sxs-lookup"><span data-stu-id="84519-222">Alternatively, you can implement a checkpoint mechanism that records state information about the task at regular intervals, and save this state in durable storage that can be accessed by any instance of the process running the task.</span></span> <span data-ttu-id="84519-223">如此一來，如果處理程序關閉，它所執行的工作可以使用另一個執行個體，從最後一個檢查點繼續進行。</span><span class="sxs-lookup"><span data-stu-id="84519-223">In this way, if the process is shutdown, the work that it was performing can be resumed from the last checkpoint by using another instance.</span></span>

- <span data-ttu-id="84519-224">當背景工作在不同的計算執行個體上執行 (例如已裝載雲端服務之應用程式的背景工作角色)，您可能需要使用不同的調整原則來調整應用程式的不同部分。</span><span class="sxs-lookup"><span data-stu-id="84519-224">When background tasks run on separate compute instances, such as in worker roles of a cloud services hosted application, you may need to scale different parts of the application using different scaling policies.</span></span> <span data-ttu-id="84519-225">例如，您可能需要部署其他使用者介面 (UI) 來計算執行個體，而不增加背景計算執行個體數目，或是相反。</span><span class="sxs-lookup"><span data-stu-id="84519-225">For example, you may need to deploy additional user interface (UI) compute instances without increasing the number of background compute instances, or the opposite of this.</span></span> <span data-ttu-id="84519-226">如果您提供不同層級的服務 (例如基本和進階服務套件) 時，相較於基本服務套件，您可能需要更積極相應放大進階服務套件的計算資源，才能符合 SLA。</span><span class="sxs-lookup"><span data-stu-id="84519-226">If you offer different levels of service (such as basic and premium service packages), you may need to scale out the compute resources for premium service packages more aggressively than those for basic service packages in order to meet SLAs.</span></span>

- <span data-ttu-id="84519-227">請考慮使用 UI 和背景計算執行個體通訊的佇列長度，作為自動調整策略的準則。</span><span class="sxs-lookup"><span data-stu-id="84519-227">Consider using the length of the queue over which UI and background compute instances communicate as a criterion for your autoscaling strategy.</span></span> <span data-ttu-id="84519-228">這是不平衡狀態或目前負載和背景工作處理能力之間差異的最佳指標。</span><span class="sxs-lookup"><span data-stu-id="84519-228">This is the best indicator of an imbalance or difference between the current load and the processing capacity of the background task.</span></span>

- <span data-ttu-id="84519-229">如果您的自動調整策略是根據測量商務程序 (例如每小時訂單數或複雜交易的平均執行時間) 的計數器，請確定您完全了解這些計數器類型的結果與實際計算容量需求之間的關係。</span><span class="sxs-lookup"><span data-stu-id="84519-229">If you base your autoscaling strategy on counters that measure business processes, such as the number of orders placed per hour or the average execution time of a complex transaction, ensure that you fully understand the relationship between the results from these types of counters and the actual compute capacity requirements.</span></span> <span data-ttu-id="84519-230">您可能需要調整多個元件或計算單位，以因應商務程序計數器的變更。</span><span class="sxs-lookup"><span data-stu-id="84519-230">It may be necessary to scale more than one component or compute unit in response to changes in business process counters.</span></span>

- <span data-ttu-id="84519-231">若要防止系統過度相應放大，並避免執行數千個執行個體的相關聯成本，請考慮限制可以自動加入的執行個體數目上限。</span><span class="sxs-lookup"><span data-stu-id="84519-231">To prevent a system from attempting to scale out excessively, and to avoid the costs associated with running many thousands of instances, consider limiting the maximum number of instances that can be automatically added.</span></span> <span data-ttu-id="84519-232">大部分動調整機制可讓您指定規則的執行個體數目上下限。</span><span class="sxs-lookup"><span data-stu-id="84519-232">Most autoscaling mechanisms allow you to specify the minimum and maximum number of instances for a rule.</span></span> <span data-ttu-id="84519-233">此外，如果部署的執行個體數目已達上限而系統仍然超載，請考慮適當地降低系統提供的功能。</span><span class="sxs-lookup"><span data-stu-id="84519-233">In addition, consider gracefully degrading the functionality that the system provides if the maximum number of instances have been deployed, and the system is still overloaded.</span></span>

- <span data-ttu-id="84519-234">請記住，自動調整可能不是處理工作負載中突發高載狀況的最適當機制。</span><span class="sxs-lookup"><span data-stu-id="84519-234">Keep in mind that autoscaling might not be the most appropriate mechanism to handle a sudden burst in workload.</span></span> <span data-ttu-id="84519-235">佈建並啟動新服務執行個體或將資源新增到系統都需要花時間，而當這些額外資源可供使用時，尖峰需求可能已過。</span><span class="sxs-lookup"><span data-stu-id="84519-235">It takes time to provision and start new instances of a service or add resources to a system, and the peak demand may have passed by the time these additional resources have been made available.</span></span> <span data-ttu-id="84519-236">在這種情況下，節流服務可能比較適合。</span><span class="sxs-lookup"><span data-stu-id="84519-236">In this scenario, it may be better to throttle the service.</span></span> <span data-ttu-id="84519-237">如需詳細資訊，請參閱[節流模式](../patterns/throttling.md)。</span><span class="sxs-lookup"><span data-stu-id="84519-237">For more information, see the [Throttling pattern](../patterns/throttling.md).</span></span>

- <span data-ttu-id="84519-238">相反地，如果您需要在交易量快速波動時足以處理所有要求的能力，而且成本不是主要考量因素，那麼請考慮使用積極的自動調整策略，以更快速啟動額外的執行個體。</span><span class="sxs-lookup"><span data-stu-id="84519-238">Conversely, if you do need the capacity to process all requests when the volume fluctuates rapidly, and cost isn't a major contributing factor, consider using an aggressive autoscaling strategy that starts additional instances more quickly.</span></span> <span data-ttu-id="84519-239">您也可以使用排程原則，在最大負載來臨前預先啟動足量的執行個體。</span><span class="sxs-lookup"><span data-stu-id="84519-239">You can also use a scheduled policy that starts a sufficient number of instances to meet the maximum load before that load is expected.</span></span>

- <span data-ttu-id="84519-240">自動調整機制應該監視自動調整程序，並記錄每個自動調整事件的詳細資料 (觸發的事件、加入或移除哪些資源，以及發生時間)。</span><span class="sxs-lookup"><span data-stu-id="84519-240">The autoscaling mechanism should monitor the autoscaling process, and log the details of each autoscaling event (what triggered it, what resources were added or removed, and when).</span></span> <span data-ttu-id="84519-241">如果您建立自訂自動調整機制，請確定它包含這項功能。</span><span class="sxs-lookup"><span data-stu-id="84519-241">If you create a custom autoscaling mechanism, ensure that it incorporates this capability.</span></span> <span data-ttu-id="84519-242">分析資訊，以協助測量自動調整策略的有效性，並視需要加以微調。</span><span class="sxs-lookup"><span data-stu-id="84519-242">Analyze the information to help measure the effectiveness of the autoscaling strategy, and tune it if necessary.</span></span> <span data-ttu-id="84519-243">您可以在使用模式變得更明顯時短時間內進行調整，以及在業務量拓展或對應用程式的需求演變時長期進行調整。</span><span class="sxs-lookup"><span data-stu-id="84519-243">You can tune both in the short term, as the usage patterns become more obvious, and over the long term, as the business expands or the requirements of the application evolve.</span></span> <span data-ttu-id="84519-244">如果應用程式達到定義的自動調整上限，機制也可以警告操作員，讓操作員視需要手動啟動其他資源。</span><span class="sxs-lookup"><span data-stu-id="84519-244">If an application reaches the upper limit defined for autoscaling, the mechanism might also alert an operator who could manually start additional resources if necessary.</span></span> <span data-ttu-id="84519-245">請注意，在這種情況下，操作員可能也需在工作負載減輕後，手動移除這些資源。</span><span class="sxs-lookup"><span data-stu-id="84519-245">Note that, under these circumstances, the operator may also be responsible for manually removing these resources after the workload eases.</span></span>

## <a name="related-patterns-and-guidance"></a><span data-ttu-id="84519-246">相關的模式和指導方針</span><span class="sxs-lookup"><span data-stu-id="84519-246">Related patterns and guidance</span></span>

<span data-ttu-id="84519-247">實作自動調整時，下列模式和指引也可能與您的案例相關：</span><span class="sxs-lookup"><span data-stu-id="84519-247">The following patterns and guidance may also be relevant to your scenario when implementing autoscaling:</span></span>

- <span data-ttu-id="84519-248">[節流模式](../patterns/throttling.md)。</span><span class="sxs-lookup"><span data-stu-id="84519-248">[Throttling pattern](../patterns/throttling.md).</span></span> <span data-ttu-id="84519-249">此模式說明當需求增加而對資源產生極大負載時，應用程式如何繼續運作並符合 SLA。</span><span class="sxs-lookup"><span data-stu-id="84519-249">This pattern describes how an application can continue to function and meet SLAs when an increase in demand places an extreme load on resources.</span></span> <span data-ttu-id="84519-250">節流可以搭配自動調整，用來避免系統相應縮小時超過負荷。</span><span class="sxs-lookup"><span data-stu-id="84519-250">Throttling can be used with autoscaling to prevent a system from being overwhelmed while the system scales out.</span></span>

- <span data-ttu-id="84519-251">[競爭取用者模式](../patterns/competing-consumers.md)。</span><span class="sxs-lookup"><span data-stu-id="84519-251">[Competing Consumers pattern](../patterns/competing-consumers.md).</span></span> <span data-ttu-id="84519-252">這個模式說明如何實作服務執行個體集區，以便處理來自任何應用程式執行個體的訊息。</span><span class="sxs-lookup"><span data-stu-id="84519-252">This pattern describes how to implement a pool of service instances that can handle messages from any application instance.</span></span> <span data-ttu-id="84519-253">自動調整可用來啟動和停止服務執行個體，以符合預期的工作負載。</span><span class="sxs-lookup"><span data-stu-id="84519-253">Autoscaling can be used to start and stop service instances to match the anticipated workload.</span></span> <span data-ttu-id="84519-254">此方法可讓系統同時處理多個訊息，以達到最佳輸送量、增進延展性及可用性，以及平衡工作負載。</span><span class="sxs-lookup"><span data-stu-id="84519-254">This approach enables a system to process multiple messages concurrently to optimize throughput, improve scalability and availability, and balance the workload.</span></span>

- <span data-ttu-id="84519-255">[監視和診斷](./monitoring.md)。</span><span class="sxs-lookup"><span data-stu-id="84519-255">[Monitoring and diagnostics](./monitoring.md).</span></span> <span data-ttu-id="84519-256">檢測和遙測對於收集資訊以進行自動調整程序相當重要。</span><span class="sxs-lookup"><span data-stu-id="84519-256">Instrumentation and telemetry are vital for gathering the information that can drive the autoscaling process.</span></span>

<!-- links -->

[monitoring]: /azure/monitoring-and-diagnostics/monitoring-overview-autoscale
[app-service-autoscale]: /azure/monitoring-and-diagnostics/insights-how-to-scale?toc=%2fazure%2fapp-service-web%2ftoc.json#scaling-based-on-a-pre-set-metric
[app-service-plan]: /azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview
[autoscale-metrics]: /azure/monitoring-and-diagnostics/insights-autoscale-common-metrics
[cloud-services-autoscale]: /azure/cloud-services/cloud-services-how-to-scale-portal
[functions-scale]: /azure/azure-functions/functions-scale
[link-resource-to-cloud-service]: /azure/cloud-services/cloud-services-how-to-manage#how-to-link-a-resource-to-a-cloud-service
[service-fabric-autoscale]: /azure/service-fabric/service-fabric-cluster-scale-up-down
[vm-scale-sets]: /azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview
[vm-scale-sets-autoscale]: /azure/virtual-machine-scale-sets/virtual-machine-scale-sets-autoscale-overview
